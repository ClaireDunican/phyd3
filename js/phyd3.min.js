var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(b,d,a){if(a.get||a.set)throw new TypeError("ES3 does not support getters and setters.");b!=Array.prototype&&b!=Object.prototype&&(b[d]=a.value)};$jscomp.getGlobal=function(b){return"undefined"!=typeof window&&window===b?b:"undefined"!=typeof global&&null!=global?global:b};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(b){return $jscomp.SYMBOL_PREFIX+(b||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var b=$jscomp.global.Symbol.iterator;b||(b=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[b]&&$jscomp.defineProperty(Array.prototype,b,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(b){var d=0;return $jscomp.iteratorPrototype(function(){return d<b.length?{done:!1,value:b[d++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(b){$jscomp.initSymbolIterator();b={next:b};b[$jscomp.global.Symbol.iterator]=function(){return this};return b};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(b,d){$jscomp.initSymbolIterator();b instanceof String&&(b+="");var a=0,e={next:function(){if(a<b.length){var g=a++;return{value:d(g,b[g]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(b,d,a,e){if(d){a=$jscomp.global;b=b.split(".");for(e=0;e<b.length-1;e++){var g=b[e];g in a||(a[g]={});a=a[g]}b=b[b.length-1];e=a[b];d=d(e);d!=e&&null!=d&&$jscomp.defineProperty(a,b,{configurable:!0,writable:!0,value:d})}};$jscomp.polyfill("Array.prototype.values",function(b){return b?b:function(){return $jscomp.iteratorFromArray(this,function(b,a){return a})}},"es6","es3");
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.newick={};phyd3.newick.parse=function(b){var d=[],a={};b=b.split(/\s*(;|\(|\)|,|:)\s*/);for(var e=0,g=0;g<b.length;g++){var m=b[g];switch(m){case "(":m={};a.id=e;e++;a.branchset=[m];d.push(a);a=m;break;case ",":m={};d[d.length-1].branchset.push(m);a=m;break;case ")":a=d.pop();break;case ":":break;default:var h=b[g-1];")"==h||"("==h||","==h?a.name=m:":"==h&&(a.branchLength=parseFloat(m));a.id=e;e++}}return a}})();
if(!d3)throw"d3 wasn't included!";window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(b){window.setTimeout(b,1E3/60)}}();
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.phylogram={};phyd3.phylogram.options={};phyd3.phylogram.intenals={};phyd3.phylogram.domains={};phyd3.phylogram.graphs={};phyd3.phylogram.dx=0;phyd3.phylogram.lineAreas=[];phyd3.phylogram.labelAreas=[];phyd3.phylogram.projection=function(b){return[parseInt(b.y),parseInt(b.x)]};phyd3.phylogram.rightAngleDiagonal=function(b,d){d=b.source;b=b.target;d=[d,{x:b.x,y:d.y},b];d=d.map(phyd3.phylogram.projection);phyd3.phylogram.lineAreas.push({start:d[1],
end:d[2]});!b.children&&d[2][0]>phyd3.phylogram.dx&&(phyd3.phylogram.dx=d[2][0]);return"M"+d[0]+" "+d[1]+" "+d[2]};phyd3.phylogram.scaleBranchLengths=function(b,d){function a(b,d){d(b);if(b.children)for(var e=b.children.length-1;0<=e;e--)a(b.children[e],d)}a(b[0],function(a){a.rootDist=(a.parent?a.parent.rootDist:0)+(a.branchLength||0)});var e=b.map(function(a){return a.rootDist}),g=d3.scale.linear().domain([0,d3.max(e)]).range([0,d]);a(b[0],function(a){a.y=parseInt(g(a.rootDist))});return g};phyd3.phylogram.randomColor=
function(){function b(a,b,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(b-a)*d:.5>d?b:d<2/3?a+(b-a)*(2/3-d)*6:a}var d=Math.random();return function(a,d,g){if(0==d)g=d=a=g;else{var e=.5>g?g*(1+d):g+d-g*d,h=2*g-e;g=b(h,e,a+1/3);d=b(h,e,a);a=b(h,e,a-1/3)}return"#"+Math.round(255*g).toString(16)+Math.round(255*d).toString(16)+Math.round(255*a).toString(16)}((d+.618033988749895)%1,.5,.6)};phyd3.phylogram.scaledomainWidths=function(b,d){b=b.map(function(a){return a.sequences&&a.sequences[0]&&a.sequences[0].domainArchitecture&&
a.sequences[0].domainArchitecture.sequenceLength?a.sequences[0].domainArchitecture.sequenceLength:0});return d3.scale.linear().domain([0,d3.max(b)]).range([0,d])};phyd3.phylogram.build=function(b,d,a){function e(){return a.invertColors?a.backgroundColor:a.foregroundColor}function g(){var d=b.replace("#",""),d=document.getElementById(d).querySelector("svg"),e=d.getElementById("main"),f=e.getBBox(),e=e.getAttributeNode("transform"),U=d.getAttributeNode("width"),n=d.getAttributeNode("height"),k=e.value,
l=U.value,g=n.value;e.value="translate("+a.marginX+", "+a.marginY+")";U.value=f.width+a.marginX;n.value=f.height+a.marginY;if("undefined"!=typeof window.XMLSerializer)var x=(new XMLSerializer).serializeToString(d);else"undefined"!=typeof d.xml&&(x=d.xml);e.value=k;U.value=l;n.value=g;return x}function m(){a.showDomains?(F=phyd3.phylogram.scaledomainWidths(A,a.domainWidth),u.append("svg:path").attr("class","domain").attr("stroke",e()).attr("visibility",function(a,d){return a.show?"visibile":"hidden"}),
B=B.data(function(a,d,b){a=a.sequences&&a.sequences[0]&&a.sequences[0].domainArchitecture?a.sequences[0].domainArchitecture.domains:[];for(b=0;b<a.length;b++)a[b].i=d;a.sort(function(a,d){return Math.abs(d.to-d.from)-Math.abs(a.to-a.from)});return a}).enter().append("svg:g").attr("class","domain"),B.append("svg:rect").attr("class","domain hover-visible").attr("stroke",a.foregroundColor).attr("stroke-width",a.outline+"px").append("title").text(function(a){return a.name}),t(),C(),w()):(B.remove(),u.selectAll("path.domain").remove(),
B=u.selectAll("g.domain"))}function h(){a.showDomainNames?(B.append("svg:text").attr("class","domain").attr("dy",-3).attr("fill",e()).attr("font-size","10px").text(function(a){return a.name}),C()):B.selectAll("text.domain").remove()}function t(){var d=u.data();u.selectAll("g.domain").attr("visibility",function(b,f,e){return d[e].show&&b.confidence<=a.domainLevel?"visible":"hidden"});u.selectAll("path.domain").attr("visibility",function(a){return a.show?"visible":"hidden"});d3.select("#domainLevel").attr("value",
a.domainLevel.toPrecision(1))}function w(){B.selectAll("rect.domain").attr("fill",function(b){return a.showDomainColors&&d.domcolors[b.name]?d.domcolors[b.name].color.replace(/0x/,"#"):e()})}function C(){var d=u.data(),b=H+(a.showLabels?I:0)+(a.showGraphs?v:0);F=phyd3.phylogram.scaledomainWidths(A,a.domainWidth);u.selectAll("path.domain").attr("d",function(f,e,q){e=a.lineupNodes?phyd3.phylogram.dx-d[q].y:0;f=f.sequences&&f.sequences[0]&&f.sequences[0].domainArchitecture?f.sequences[0].domainArchitecture.sequenceLength:
0;return"M"+parseInt(b+e)+",0L"+parseInt(b+e+F(f))+",0"});B.selectAll("rect.domain").attr("width",function(a){return parseInt(F(a.to-a.from))}).attr("transform",function(f,e,q){return"translate("+parseInt(b+(a.lineupNodes?phyd3.phylogram.dx-d[f.i].y:0)+F(f.from))+","+parseInt(-1*a.nodeHeight)+")"}).attr("height",2*a.nodeHeight-2);B.selectAll("text.domain").attr("transform",function(f){return"translate("+parseInt(b+(a.lineupNodes?phyd3.phylogram.dx-d[f.i].y:0)+F(f.from))+","+parseInt(-1*a.nodeHeight)+
")"});d3.select("#domainWidth").attr("value",a.domainWidth)}function aa(){a.showSupportValues?(p.selectAll("g.inner.node").append("svg:text").attr("class","supportValue").attr("dx",-2).attr("text-anchor","end").attr("fill",a.supportValuesColor).text(function(a){var d="";if(a.confidences)for(var b in a.confidences)d+=parseFloat(a.confidences[b].value)+" ";return d}),z()):p.selectAll("text.supportValue").remove()}function ba(){a.showLengthValues?(p.selectAll("g.node").append("svg:text").attr("class",
"branchLength").attr("dx",-2).attr("text-anchor","end").attr("fill",a.branchLengthColor).text(function(a){return a.branchLength?parseFloat(a.branchLength).toFixed(5):""}),z()):p.selectAll("text.branchLength").remove()}function V(a,d,b){var f=a.attr("id")+"_"+a.selectAll("div.panel-default").size(),e=a.append("div").attr("class","panel panel-default");e.append("div").attr("class","panel-heading").attr("role","tab").attr("id","heading"+f).append("h4").attr("class","panel-title").append("a").attr("class",
"collapsed").attr("aria-expanded",b?"true":"false").attr("role","button").attr("data-toggle","collapse").attr("data-parent","#"+a.attr("id")).attr("href","#collapse"+f).attr("aria-controls","collapse"+f).html(d);return e.append("div").attr("id","collapse"+f).attr("class","panel-collapse collapse "+(b?"in":"")).attr("role","tabpanel").attr("aria-labelledby","heading"+f).append("div").attr("class","panel-body table-responsive")}function ka(e){var r=d3.event;if(!r.defaultPrevented){var f=r.layerX;y=
r.layerY;var q="popup"+parseInt(Date.now()*Math.random()*1E3),f=d3.select(b).append("div").attr("class","popup").attr("id",q).style("position","absolute").style("top",parseInt(y)+"px").style("left",parseInt(f)+"px").style("width",parseInt(a.popupWidth)+"px").style("color",a.foregroundColor).style("background-color",a.backgroundColor),n=f.append("button").attr("class","btn btn-link").style("position","absolute").style("right","8px");n.append("span").attr("class","glyphicon glyphicon-remove").attr("aria-hidden",
"true");n.on("click",function(){d3.select("#"+q).remove();p.selectAll("g.node.cid_"+e.id).selectAll("rect.pointer").style("opacity","0")});f=f.append("div").attr("class","panel-group").attr("id","accordion_"+parseInt(Date.now()*Math.random()*1E3)).attr("role","tablist").attr("aria-multiselectable","true");n="text"==r.target.nodeName||r.target.classList.contains("pointer")?!0:!1;n=V(f,"Node",n).append("table").attr("class","table table-condensed table-bordered").append("tbody");if(e.name){var k=n.append("tr");
k.append("td").text("Name");k.append("td").text(e.name)}if(e.taxonomies)for(var l in e.taxonomies){var g=e.taxonomies[l],k=n.append("tr");k.append("td").text("Taxononomy");k=k.append("td");d.taxcolors[g.code]&&d.taxcolors[g.code].url&&(k=k.append("a").attr("href",d.taxcolors[g.code].url));var x="",x=x+(d.taxcolors[g.code]&&d.taxcolors[g.code].name?d.taxcolors[g.code].name+" ":""),x=x+" ",x=x+(g.scientificName?"\x3ci\x3e"+g.scientificName+"\x3c/i\x3e":""),x=x+" ",x=x+(g.commonName?g.commonName:""),
x=x+" ",x=x+(g.code?"("+g.code+")":"");k.html(x)}if(e.confidences)for(var la in e.confidences)k=n.append("tr"),k.append("td").text("Confidence"),k.append("td").html(e.confidences[la].value);k=n.append("tr");k.append("td").text("Depth");k.append("td").text(e.depth);k=n.append("tr");k.append("td").text("Branch length");k.append("td").text(e.branchLength?e.branchLength:0);k=n.append("tr");k.append("td").text("Distance from root");k.append("td").text(e.rootDist);for(var h in e.properties)k=e.properties[h],
m=k.ref,l=k.value,l=l.trim(),/^http:\/\//.test(l)&&(l="\x3ca href\x3d'"+l+"' target\x3d'_blank'\x3e"+l+"\x3c/a\x3e\x3cbr /\x3e"),k=n.append("tr"),k.append("td").text(m),k.append("td").html(l);for(var m in e.events)l=e.events[m],k=n.append("tr"),k.append("td").text(m),k.append("td").html(l);if(e.sequences)for(var t in e.sequences)if(e.sequences[t].domainArchitecture&&e.sequences[t].domainArchitecture.domains){n=r.target.parentNode.classList.contains("domain")?!0:!1;n=V(f,"Domains",n).append("table").attr("id",
"dt"+q).attr("class","table table-condensed table-bordered");m=n.append("thead").append("tr");m.append("th").text("#");m.append("th").text("Name");m.append("th").text("Description");m.append("th").text("From");m.append("th").text("To");m.append("th").text("P value");n=n.append("tbody");for(h=0;h<e.sequences[t].domainArchitecture.domains.length;h++)l=e.sequences[t].domainArchitecture.domains[h],k=n.append("tr"),k.append("td").style("background",d.domcolors[l.name]&&d.domcolors[l.name].color?d.domcolors[l.name].color.replace("0x",
"#"):"").text(" "),m=k.append("td"),d.domcolors[l.name]&&d.domcolors[l.name].url&&(m=m.append("a").attr("href",d.domcolors[l.name].url)),m.text(l.name),k.append("td").text(d.domcolors[l.name]?d.domcolors[l.name].description:""),k.append("td").text(l.from),k.append("td").text(l.to),k.append("td").text(l.confidence);$("#dt"+q).dataTable({searching:!1,paging:!1,language:{info:""},order:[[3,"asc"]],columns:[{orderable:!1},null,null,null,null,null]})}if(d.graphs)for(t=0;t<d.graphs.length;t++)if(l=d.graphs[t],
l.data&&l.data[e.id]&&l.data[e.id].length)for(n=r.target.parentNode.classList.contains(l.type)?!0:!1,n=V(f,l.name,n).append("table").attr("class","table table-condensed table-bordered").append("tbody"),h=0;h<l.legend.fields.length;h++)k=n.append("tr"),m=k.append("td"),l.legend.fields[h].url&&(m=m.append("a").attr("href",l.legend.fields[h].url)),m.text(l.legend.fields[h].name),k.append("td").text(l.data[e.id][h]);p.selectAll("g.node.cid_"+e.id).selectAll("rect.pointer").style("opacity","1");r.stopPropagation()}}
function ca(){a.lineupNodes?p.selectAll("g.leaf").append("path").attr("class","support").attr("stroke",e()).attr("stroke-dasharray","2,3").attr("stroke-width","0.5px"):p.selectAll("path.support").remove()}function P(b){if(b.children&&"only leaf"==a.showNodesType||!b.children&&"only inner"==a.showNodesType)return"";var e="";if(a.showTaxonomy&&b.taxonomies)for(var f in b.taxonomies){var q=b.taxonomies[f];a.showFullTaxonomy&&(e+=d.taxcolors[q.code]&&d.taxcolors[q.code].name?d.taxcolors[q.code].name:
"",e+=" ",e+=q.scientificName?q.scientificName:"",e+=" ",e+=q.commonName?q.commonName:"",e+=" ");e+=q.code?q.code:"";e+=" "}e+=(a.showNodeNames&&b.name?b.name:"")+" ";if(a.showSequences&&b.sequences)for(var n in b.sequences)if(f=b.sequences[n],e+=f.symbol?f.symbol:"",e+=" ",e+=f.accession?f.accession.value:"",e+=" ",e+=f.name?f.name:"",e+=" ",e+=f.geneName?f.geneName:"",e+=" ",f.annotations)for(var k in f.annotations)e+=f.annotations[k].desc?f.annotations[k].desc:"",e+=" ";return e}function Q(){var d=
0;u.selectAll("text.name").text(function(a){a=P(a);a.length>d&&(d=a.length);return a});p.selectAll("g.node.inner").selectAll("text.name").text(P);a.showGraphs&&J();a.showDomains&&C()}function G(){u.selectAll("text.name").attr("visibility",function(a){return a.show?"visible":"hidden"});a.lineupNodes&&u.selectAll("path.support").attr("visibility",function(a){return a.show?"visible":"hidden"});a.showLabels&&da();a.showGraphs&&ea();a.showDomains&&t()}function W(){p.selectAll("text.name").attr("stroke",
e()).attr("stroke-width",a.outline+"px").attr("fill",function(b){var q=null;if(a.showTaxonomyColors&&d.taxcolors&&b.taxonomies)for(var f in b.taxonomies){var g=b.taxonomies[f];d.taxcolors[g.code]&&d.taxcolors[g.code].color&&(q=d.taxcolors[g.code].color.replace(/0x/,"#"))}return q?q:e()})}function fa(){u.selectAll("text.name").attr("dx",function(d){return parseInt(a.lineupNodes?phyd3.phylogram.dx-d.y+5:5)});u.selectAll("path.support").attr("d",function(a){return"M0,0 L"+parseInt(phyd3.phylogram.dx-
a.y)+",0"});a.showLabels&&X();a.showGraphs&&J();a.showDomains&&C()}function z(){p.selectAll("text.name").attr("dy",a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");p.selectAll("text.branchLength").attr("dy",-a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");p.selectAll("text.supportValue").attr("dy",a.nodeHeight/2+5).attr("font-size",1.5*a.nodeHeight+"px");H=100*a.nodeHeight/6+10;d3.select("#nodeHeight").attr("value",a.nodeHeight);fa();a.showLabels&&X();a.showGraphs&&J();a.showDomains&&
C()}function ga(){if(a.showLabels&&d.labels){for(var b=0;b<d.labels.length;b++){var r=d.labels[b];r.id||(r.id=parseInt(Date.now()*Math.random()*1E3));r.data.tag&&p.selectAll("g.node").each(function(a){var b=a[r.data.tag],d=r.data.ref,d=d?d:"value",b="object"==typeof b?b[d]:b;if("property"==r.data.tag)for(pid in a.properties){var e=a.properties[pid];if(e.ref==d){b=e.value;break}}b&&(r.data[a.id]=b)});switch(r.type){case "text":for(cid in r.data)r.data[cid]&&parseInt(cid)&&p.selectAll(".cid_"+cid).append("text").attr("class",
"nodelabel text lid"+r.id).attr("dy",3).attr("text-anchor","start").attr("stroke-width",a.outline+"px").attr("stroke",e()).attr("fill",e()).attr("font-size",1.5*a.nodeHeight+"px").attr("visibility","visible").text(r.data[cid]).append("title").text(r.name+": "+r.data[cid]);break;case "color":for(cid in r.data)if(r.data[cid]&&parseInt(cid)){var f=a.nodeHeight,g=r.data[cid].replace(/0x/,"#");p.selectAll(".cid_"+cid).append("rect").attr("height",2*f).attr("width",2*f).attr("class","nodelabel color lid"+
r.id).attr("style","fill: "+g+"; stroke: "+g).append("title").text(r.name)}}}da();X()}else p.selectAll(".nodelabel").remove(),I=0;J();C()}function X(){var b=a.nodeHeight;I=0;if(d.labels){for(var e=0;e<d.labels.length;e++){var f=d.labels[e],g=0;u.selectAll(".nodelabel.lid"+f.id).attr("transform",function(d){var e=0,l=0;"color"==f.type&&(e=l=-b);var q=0;"text"==this.nodeName&&this.firstChild?q=this.firstChild.length*b/1.5:"rect"==this.nodeName&&(q=2*b);q>g&&(g=q);return"translate("+parseInt(e+b+I+(a.lineupNodes?
phyd3.phylogram.dx-d.y+H:H))+","+l+")"});I+=g+2*b}e=u.selectAll(".nodelabel");e.selectAll("text").attr("dy",a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");e.selectAll("rect").attr("width",2*a.nodeHeight).attr("height",2*a.nodeHeight)}}function da(){u.selectAll(".nodelabel").attr("visibility",function(a){return a.show?"visible":"hidden"})}function ha(){if(a.showGraphs&&d.graphs&&d.graphs.length){d3.svg.arc().innerRadius(0).outerRadius(a.nodeHeight);for(var b=d3.layout.pie().value(function(a){return a.value}).sort(null),
g=v=0;g<d.graphs.length;g++){var f=d.graphs[g];f.id||(f.id=parseInt(Date.now()*Math.random()*1E3));if(f.data.tag)var h=p.selectAll("g.node").each(function(a){var b=a[f.data.tag],d=f.data.ref,d=d?d:"value",b="object"==typeof b?b[d]:b;if("property"==f.data.tag)for(pid in a.properties){var e=a.properties[pid];if(e.ref==d){b=e.value;break}}b&&(f.data[a.id]=[],f.data[a.id][0]=b,"pie"==f.type&&f.data.max&&(f.data[a.id][1]=f.data.max-b,f.legend.fields[1]={name:f.legend.fields[0].name,color:f.legend.fields[0].background?
f.legend.fields[0].background:phyd3.phylogram.randomColor(),invert:!0}))});switch(f.type){case "pie":for(cid in f.data)if(f.data[cid]&&Array.isArray(f.data[cid])){var n=!1;p.select(".cid_"+cid).each(function(a){0==a.branchset.length&&(n=!0)});for(var h=p.selectAll(".cid_"+cid).append("svg:g").attr("class","graph pie gid"+f.id),k=[],l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&k.push({i:l,value:f.data[cid][l],leaf:n});h.selectAll("path.pie.gid"+f.id).data(b(k)).enter().append("path").attr("class",
"pie hover-visible gid"+f.id).attr("stroke",e()).attr("stroke-width",a.outline+"px").attr("fill",function(a,b){return f.legend.fields?(f.legend.fields[b]||(f.legend.fields[b]={},f.legend.fields[b].name="Series "+(b+1),f.legend.fields[b].color=phyd3.phylogram.randomColor()),f.legend.fields[b].color.replace(/0x/,"#")):""}).append("title").text(function(a,b){return f.legend.fields?(f.legend.fields[b]&&f.legend.fields[b].name?f.legend.fields[b].name+": ":"")+(f.legend.fields[b].invert?f.data.max-a.data.value:
a.data.value):""})}break;case "binary":for(cid in f.data)if(f.data[cid]&&Array.isArray(f.data[cid])){k=[];n=!1;p.select(".cid_"+cid).each(function(a){0==a.branchset.length&&(n=!0)});h=p.selectAll(".cid_"+cid).append("svg:g").attr("class","graph binary gid"+f.id);for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&k.push({i:l,value:f.data[cid][l],shape:f.legend.fields[l]?f.legend.fields[l].shape:"",leaf:n});h.selectAll("path.binary.gid"+f.id).data(k).enter().append("path").attr("class","binary hover-visible gid"+
f.id).attr("style",function(a,b){b=(f.legend.fields[b]?f.legend.fields[b].color:"").replace(/0x/,"#");return"fill:"+(1<=a.value?b:"none")+";stroke:"+(0<=a.value?b:"none")}).append("title").text(function(a,b){return(f.legend.fields[b]?f.legend.fields[b].name+": ":"")+a.value})}break;case "multibar":K[f.id]=[];for(l=0;l<f.legend.fields.length;l++)h=d3.max(d3.values(f.data),function(a){if(a)return a[l]}),K[f.id][l]=d3.scale.linear().domain([0,h]);for(cid in f.data)if(f.data[cid]){h=p.select(".cid_"+
cid).append("svg:g").attr("class","graph multibar gid"+f.id);k=[];for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&k.push({i:l,value:f.data[cid][l]});h.selectAll("rect.multibar.gid"+f.id).data(k).enter().append("rect").attr("class","multibar hover-visible gid"+f.id).attr("fill",function(a,b){return(f.legend.fields[b]?f.legend.fields[b].color:"").replace(/0x/,"#")}).attr("stroke",a.foregroundColor).attr("stroke-width",a.outline).append("title").text(function(a,b){return(f.legend.fields[b]?
f.legend.fields[b].name+": ":"")+a.value})}break;case "heatmap":var h=d3.max(d3.values(f.data),function(a){if(a)return d3.max(a)}),k=d3.min(d3.values(f.data),function(a){if(a)return d3.min(a)}),m=d3.scale.quantize().domain([k,h]).range(colorbrewer[f.legend.gradient.name][f.legend.gradient.classes]);for(cid in f.data)if(f.data[cid]){h=p.select(".cid_"+cid).append("svg:g").attr("class","graph heatmap gid"+f.id);k=[];if(f.data[cid])for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&k.push({i:l,
value:f.data[cid][l]});h.selectAll("rect.heatmap.gid"+f.id).data(k).enter().append("rect").attr("class","heatmap hover-visible gid"+f.id).attr("fill",function(a,b){return m(a.value)}).attr("stroke",a.foregroundColor).attr("stroke-width",a.outline+"px").append("title").text(function(a,b){return(f.legend.fields[b]?f.legend.fields[b].name+": ":"")+a.value})}break;default:console.log("Graph not supported "+f.type)}}ea();J()}else v=0,p.selectAll("g.graph").remove(),p.selectAll("text.legend").remove();
C()}function J(){var b=a.nodeHeight,g=H+I,f=u.selectAll("g.graph").attr("transform",function(b){return"translate("+(a.lineupNodes?phyd3.phylogram.dx-b.y+g:g)+",0)"});d3.select("#graphWidth").attr("value",a.graphWidth);p.selectAll("text.legend").remove();v=0;if(d.graphs){for(var h=0;h<d.graphs.length;h++){var n=d.graphs[h];switch(n.type){case "pie":f.selectAll("path.pie.gid"+n.id).attr("d",function(a){return d3.svg.arc().innerRadius(0).outerRadius(b)(a)}).attr("transform",function(a){return" translate("+
parseInt(a.data.leaf?b+v:0)+",0)"});a.showGraphLegend&&p.append("text").attr("class","legend").text(0!=n.legend.show?n.name:"").attr("transform","translate("+parseInt(phyd3.phylogram.dx+g+v+2*b)+",-10) rotate(-90)");v+=2*b+5;break;case "binary":f.selectAll("path.binary.gid"+n.id).attr("d",function(a){var d=d3.svg.symbol().size(4*(b-2)*(b-2));d.type(n.legend.fields[a.i].shape);return d(a)}).attr("transform",function(a){return" translate("+(a.leaf?v+10+a.i*(2*b+5):0)+" ,0)"});if(a.showGraphLegend)for(var k=
0;k<n.legend.fields.length;k++)p.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[k].name:"").attr("transform","translate("+(phyd3.phylogram.dx+g+v+k*(2*b+5)+2*b)+", -10) rotate(-90)");v+=(n.legend.fields.length+1)*(2*b+5)+5;break;case "multibar":for(k=0;k<n.legend.fields.length;k++)K[n.id][k]=K[n.id][k].range([0,a.graphWidth]);f.selectAll("rect.multibar.gid"+n.id).attr("height",parseInt(2*b)).attr("width",function(a,b){return parseInt(K[n.id][a.i]?K[n.id][a.i](a.value):
0)}).attr("transform",function(d,e){return" translate("+parseInt(v+d.i*(a.graphWidth+5))+",-"+parseInt(b)+")"});if(a.showGraphLegend)for(k=0;k<n.legend.fields.length;k++)p.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[k].name:"").attr("transform","translate("+(phyd3.phylogram.dx+g+v+k*(a.graphWidth+5)+a.graphWidth/2)+",-10) rotate(-90)");v+=n.legend.fields.length*(a.graphWidth+5);break;case "heatmap":f.selectAll("rect.heatmap.gid"+n.id).attr("width",2*b).attr("height",
2*b).attr("transform",function(a,d){return" translate("+(v+2*a.i*b)+",-"+b+")"});if(a.showGraphLegend)for(k=0;k<n.legend.fields.length;k++)p.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[k].name:"").attr("transform","translate("+parseInt(phyd3.phylogram.dx+g+v+(k+1)*b*2)+",-10) rotate(-90)");v+=2*n.legend.fields.length*b+5}}p.selectAll("text.legend").attr("fill",e()).attr("font-size",2*a.nodeHeight)}}function ma(){var b=a.nodeHeight;v=0;if(d.graphs)for(var e=0;e<d.graphs.length;e++){var f=
d.graphs[e];switch(f.type){case "pie":v+=2*b+5;break;case "binary":v+=(f.legend.fields.length+1)*(2*b+5)+5;break;case "multibar":v+=f.legend.fields.length*(a.graphWidth+5);break;case "heatmap":v+=2*f.legend.fields.length*b+5}}return 2*a.margin+(a.showNodeNames?H:0)+(a.showGraphs?v:0)+(a.showDomains?a.domainWidth:0)}function ea(){var b=[],d=function(d){if(!a.dynamicHide)return"visible";for(var e=!0,f=a.nodeHeight,g=d.x,l=d.y,h=0;h<b.length;h++){var r=b[h].x,q=b[h].y;if((r-g)*(r-g)+(q-l)*(q-l)<=4*f*
f){e=!1;break}}return e?(b.push(d),"visible"):"hidden"};u.selectAll("g.graph").attr("visibility",function(a){return a.show?"visible":"hidden"});p.selectAll("g.inner").selectAll(".graph.pie").attr("visibility",d);p.selectAll("g.inner").selectAll(".graph.binary").attr("visibility",d)}function D(b){phyd3.phylogram.lineAreas=[];phyd3.phylogram.dx=0;var g=d3.layout.cluster().separation(function(a,b){return 1}).children(a.children||function(a){return a.branchset}).size([L*a.scaleY,E*a.scaleX]);A=g(d);a.showPhylogram||
phyd3.phylogram.scaleBranchLengths(A,E*a.scaleX);var f=p.selectAll("path.link");b||(f=f.data(g.links(A)),f.enter().append("svg:path").attr("class","link").attr("fill","none").attr("stroke",e()));f.attr("d",phyd3.phylogram.rightAngleDiagonal);M=void 0;c=0;f=A.filter(function(a){return!a.children});for(g=0;g<f.length;g++)f[g].show=a.dynamicHide?ia(f[g],!a.lineupNodes):!0;M=void 0;f=A.filter(function(a){return a.children});for(g=0;g<f.length;g++)0<P(f[g]).trim().length?f[g].show=a.dynamicHide?ia(f[g],
!0):!0:f[g].show=!1;b||(R=R.data(A),R.enter().append("svg:g").attr("class",function(a){return a.children?0==a.depth?"root node cid_"+a.id:"inner node cid_"+a.id:"leaf node cid_"+a.id}).style("cursor","pointer").on("click",void 0===a.popupAction?ka:a.popupAction).append("rect").attr("class","pointer").attr("fill","red").attr("width",2*a.nodeHeight+2+"px").attr("height",2*a.nodeHeight+2+"px").style("opacity","0").attr("x","-"+(a.nodeHeight+1)+"px").attr("y","-"+(a.nodeHeight+1)+"px"));R.attr("transform",
function(a){return"translate("+parseInt(a.y)+","+parseInt(a.x)+")"});phyd3.phylogram.lineAreas=[]}function N(){D(!0);S()}function ia(b,d){var e=!0,g=b.y+1,h=b.y+5.5*P(b).length,k=b.x-a.nodeHeight,l=b.x+a.nodeHeight;if(!M)return M=b,!0;a.lineupNodes&&!b.children&&(g+=phyd3.phylogram.dx-b.y,h+=phyd3.phylogram.dx-b.y);var q=M,m=q.y+1,r=q.y+5.5*P(q).length,p=q.x-a.nodeHeight,t=q.x+a.nodeHeight;a.lineupNodes&&!q.children&&(m+=phyd3.phylogram.dx-q.y,r+=phyd3.phylogram.dx-q.y);if(m<=g&&g<=r&&p<=k&&k<=t||
m<=h&&h<=r&&p<=k&&k<=t||m<=g&&g<=r&&p<=l&&l<=t||m<=h&&h<=r&&p<=l&&l<=t)e=!1;if(e&&d)for(d=0;d<phyd3.phylogram.lineAreas.length;d++)if(p=phyd3.phylogram.lineAreas[d],q=p.start[0],m=p.end[0],r=p.start[1],p=p.end[1],r==p){if(k<=r&&p<=l&&!(q>h||m<g)){e=!1;break}}else if(q==m&&g<=q&&m<=h&&!(r>l||p<k)){e=!1;break}e&&(M=b);return e}function S(){var b=Y.translate(),d=b[0]+a.marginX-a.translateX,e=b[1]+a.marginY-a.translateY;p.attr("transform",function(a){return"translate("+parseInt(d)+","+parseInt(e)+") scale(1)"});
0!=a.lastScale&&(fa(),a.dynamicHide&&G())}a=a||{};a.scaleY=a.scaleY||1;a.scaleX=a.scaleX||1;a.translateX=a.translateX||0;a.translateY=a.translateY||0;a.height=a.height||800;a.margin=a.margin||20;a.scaleStep=a.scaleStep||.3;a.nodeHeight=a.nodeHeight||6;a.nodeHeightStep=a.nodeHeightStep||1;a.textLength=a.textLength||100;a.domainWidth=a.domainWidth||100;a.domainWidthStep=a.domainWidthStep||100;a.graphWidth=a.graphWidth||20;a.graphWidthStep=a.graphWidthStep||10;a.domainLevel=a.domainLevel||1;a.domainLevelStep=
a.domainLevelStep||10;a.outline=a.outline||.3;a.popupWidth=a.popupWidth||500;a.foregroundColor=a.foregroundColor||"#000";a.backgroundColor=a.backgroundColor||"#fff";a.branchLengthColor=a.branchLengthColor||"red";a.supportValuesColor=a.supportValuesColor||"blue";a.showNodesType=a.showNodesType||"only leaf";a.treeWidth=a.treeWidth||"auto";a.showFullTaxonomy=a.showFullTaxonomy||!1;a.showLabels=a.showLabels||!0;a.showDomains=a.showDomains||!0;a.dynamicHide=a.dynamicHide||!1;a.invertColors=a.invertColors||
!1;a.lineupNodes=a.lineupNodes||!0;a.showSupportValues=a.showSupportValues||!1;a.showLengthValues=a.showLengthValues||!1;a.showTaxonomy=a.showTaxonomy||!0;a.showTaxonomyColors=a.showTaxonomyColors||!0;a.showDomainNames=a.showDomainNames||!1;a.showDomainColors=a.showDomainColors||!0;a.showGraphs=a.showGraphs||!0;a.showGraphLegend=a.showGraphLegend||!0;a.showNodeNames=a.showNodeNames||!0;a.showPhylogram=a.showPhylogram||!1;var A,F,M,K=[],I=100,H=100,v=0,O=100,ja=!1;if(d.graphs)for(var Z=0;Z<d.graphs.length;Z++)if(0!=
d.graphs[Z].legend.show){ja=!0;break}O=ja?O:0;a.marginX=a.margin;a.marginY=a.margin+(a.showGraphs?O:0);var T=$(b).width(),E="auto"==a.treeWidth?T-ma():a.treeWidth,L=a.height-(2*a.margin+(a.showGraphs?O:0)),E=parseInt(E),L=parseInt(L);0>E&&(E=T-2*H-(a.showGraphs?2*O:0));var Y=d3.behavior.zoom().scaleExtent([1,1]).on("zoom",function(b){b=0;var d=d3.event.sourceEvent;if(d){if(0<d.deltaY||0>d.wheelDelta)b=-1*a.scaleStep;if(0>d.deltaY||0<d.wheelDelta)b=a.scaleStep;var e=.5,g=.5;d.altKey||d.ctrlKey||(e=
d.layerX/T,g=d.layerY/a.height);if(d.ctrlKey||!d.altKey)a.scaleY+=b,a.scaleY<a.scaleStep?a.scaleY=a.scaleStep:a.translateY+=L*b*g;if(d.altKey||!d.ctrlKey)a.graphWidth+=0==b?0:0>b?-10:10,10>a.graphWidth&&(a.graphWidth=10),a.domainWidth+=0==b?0:0>b?-1*a.domainWidthStep:a.domainWidthStep,a.domainWidth<a.domainWidthStep&&(a.domainWidth=a.domainWidthStep),a.scaleX+=b,a.scaleX<a.scaleStep?a.scaleX=a.scaleStep:a.translateX+=E*b*e;a.lastScale=b;0!=a.lastScale?requestAnimFrame(N):requestAnimFrame(S)}});d3.select(b).select("svg").remove();
var p=d3.select(b).insert("svg").attr("width",T+"px").attr("height",a.height+"px").attr("overflow","hidden").attr("version","1.1").attr("font-family","Open Sans").attr("xmlns","http://www.w3.org/2000/svg").call(Y);p.append("svg:rect").attr("class","canvas").attr("width","100%").attr("height","100%").attr("fill",a.invertColors?a.foregroundColor:a.backgroundColor);p.append("svg:text").attr("dy","20px").attr("stroke",e()).attr("stroke-width","1px").attr("font-size","15px").text(d.name?d.name:"");p.append("svg:text").attr("dy",
"40px").attr("stroke",e()).attr("stroke-width","0.5px").attr("font-size","10px").text(d.description?d.description:"");var p=p.append("svg:g").attr("id","main").attr("transform","translate("+a.marginX+", "+a.marginY+")"),R=p.selectAll("g.node");D();0==phyd3.phylogram.dx&&(d3.select("#phylogram").attr("checked","").attr("disabled","disabled"),a.showPhylogram=!0,D());var u=p.selectAll("g.leaf.node"),B=u.selectAll("g.domain");aa();ba();m();h();ha();ca();ga();R.append("svg:text").attr("class","name").attr("dx",
a.nodeHeight+1).attr("dy",3).attr("text-anchor","start");W();Q();G();S();z();d3.select("#dynamicHide").on("click",function(){a.dynamicHide=!a.dynamicHide;D(!0);G()});d3.select("#invertColors").on("click",function(){a.invertColors=!a.invertColors;d3.selectAll(".canvas").attr("fill",a.invertColors?a.foregroundColor:a.backgroundColor);var b=e();p.selectAll("path.link").attr("stroke",b);p.selectAll("text.legend").attr("fill",b);u.selectAll("path.support").attr("stroke",b);u.selectAll("path.domain").attr("stroke",
b);u.selectAll("text.nodelabel").attr("stroke",b).attr("fill",b);W();w()});d3.select("#phylogram").on("click",function(){a.showPhylogram=!a.showPhylogram;D(!0);z();G()});d3.select("#lineupNodes").on("click",function(){a.lineupNodes=!a.lineupNodes;D(!0);ca();z();G()});d3.select("#lengthValues").on("click",function(){a.showLengthValues=!a.showLengthValues;ba()});d3.select("#supportValues").on("click",function(){a.showSupportValues=!a.showSupportValues;aa();G()});d3.select("#nodeNames").on("click",function(){a.showNodeNames=
!a.showNodeNames;Q();z()});d3.select("#nodeLabels").on("click",function(){a.showLabels=!a.showLabels;ga()});d3.select("#taxonomy").on("click",function(){a.showTaxonomy=!a.showTaxonomy;Q();z()});d3.select("#sequences").on("click",function(){a.showSequences=!a.showSequences;Q();z()});d3.select("#nodesType").on("change",function(){a.showNodesType=$(this).val();N();Q()});d3.select("#taxonomyColors").on("click",function(){a.showTaxonomyColors=!a.showTaxonomyColors;W()});d3.select("#nodeHeightLower").on("click",
function(){a.nodeHeight-=a.nodeHeightStep;a.nodeHeight<a.nodeHeightStep&&(a.nodeHeight=a.nodeHeightStep);D(!0);z();G()});d3.select("#nodeHeightHigher").on("click",function(){a.nodeHeight+=a.nodeHeightStep;D(!0);z();G()});d3.select("#resetZoom").on("click",function(){a.domainWidth=a.domainWidthStep;a.scaleX=1;a.scaleY=1;a.translateX=0;a.translateY=0;D(!0);Y.translate([0,0]);S();z()});d3.select("#zoominY").on("click",function(){a.scaleY+=a.scaleStep;a.translateY+=L*a.scaleStep/2;a.lastScale=a.scaleStep;
requestAnimFrame(N)});d3.select("#zoomoutY").on("click",function(){a.scaleY-=a.scaleStep;a.scaleY<a.scaleStep?a.scaleY=a.scaleStep:a.translateY-=L*a.scaleStep/2;a.lastScale=-1*a.scaleStep;requestAnimFrame(N)});d3.select("#zoominX").on("click",function(){a.scaleX+=a.scaleStep;a.translateX+=E*a.scaleStep/2;a.lastScale=a.scaleStep;requestAnimFrame(N)});d3.select("#zoomoutX").on("click",function(){a.scaleX-=a.scaleStep;a.scaleX<a.scaleStep?a.scaleX=a.scaleStep:a.translateX-=E*a.scaleStep/2;a.lastScale=
-1*a.scaleStep;requestAnimFrame(N)});d3.select("#domains").on("click",function(){a.showDomains=!a.showDomains;a.showDomains?(d3.select("#domainNames").attr("disabled",null),d3.select("#domainColors").attr("disabled",null),d3.select("#domainWidthLower").attr("disabled",null),d3.select("#domainWidthHigher").attr("disabled",null),d3.select("#domainLevelLower").attr("disabled",null),d3.select("#domainLevelHigher").attr("disabled",null)):(d3.select("#domainNames").attr("disabled","disabled"),d3.select("#domainColors").attr("disabled",
"disabled"),d3.select("#domainWidthLower").attr("disabled","disabled"),d3.select("#domainWidthHigher").attr("disabled","disabled"),d3.select("#domainLevelLower").attr("disabled","disabled"),d3.select("#domainLevelHigher").attr("disabled","disabled"));m();h()});d3.select("#domainColors").on("click",function(){a.showDomainColors=!a.showDomainColors;w()});d3.select("#domainNames").on("click",function(){a.showDomainNames=!a.showDomainNames;h()});d3.select("#domainWidthLower").on("click",function(){a.domainWidth-=
a.domainWidthStep;a.domainWidth<a.domainWidthStep&&(a.domainWidth=a.domainWidthStep);F=phyd3.phylogram.scaledomainWidths(A,a.domainWidth);C()});d3.select("#domainWidthHigher").on("click",function(){a.domainWidth+=a.domainWidthStep;F=phyd3.phylogram.scaledomainWidths(A,a.domainWidth);C()});d3.select("#domainLevelLower").on("click",function(){a.domainLevel/=a.domainLevelStep;t()});d3.select("#domainLevelHigher").on("click",function(){a.domainLevel*=a.domainLevelStep;t()});d3.select("#graphLegend").on("click",
function(){a.showGraphLegend=!a.showGraphLegend;a.marginY=a.margin+(a.showGraphs?O:0);J();S()});d3.select("#graphs").on("click",function(){a.showGraphs=!a.showGraphs;a.showGraphs?(d3.select("#graphLegend").attr("disabled",null),d3.select("#graphWidthLower").attr("disabled",null),d3.select("#graphWidthHigher").attr("disabled",null)):(d3.select("#graphLegend").attr("disabled","disabled"),d3.select("#graphWidthLower").attr("disabled","disabled"),d3.select("#graphWidthHigher").attr("disabled","disabled"));
ha()});d3.select("#graphWidthLower").on("click",function(){a.graphWidth-=a.graphWidthStep;a.graphWidth<a.graphWidthStep&&(a.graphWidth=a.graphWidthStep);z()});d3.select("#graphWidthHigher").on("click",function(){a.graphWidth+=a.graphWidthStep;z()});d3.select("#linkSVG").on("click",function(){var a=g();saveAs(new Blob([unescape(encodeURIComponent(a))],{type:"application/svg+xml"}),"phylogram.svg")});d3.select("#linkPNG").on("click",function(){var a=g(),b=document.createElement("canvas");canvg(b,a);
b.toBlob(function(a){saveAs(a,"phylogram.png")})})}})();
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.phyloxml={};phyd3.phyloxml.cid=0;phyd3.phyloxml.parseConfidence=function(b){return{type:b.getAttribute("type"),stddev:parseFloat(b.getAttribute("stddev")),value:parseFloat(b.textContent)}};phyd3.phyloxml.parseProperty=function(b){return{ref:b.getAttribute("ref"),unit:b.getAttribute("unit"),datatype:b.getAttribute("datatype"),appliesTo:b.getAttribute("applies_to"),idRef:b.getAttribute("id_ref"),value:b.textContent}};phyd3.phyloxml.parseUri=function(b){return{desc:b.getAttribute("desc"),
type:b.getAttribute("type"),value:b.textContent}};phyd3.phyloxml.parseReference=function(b){return{doi:b.getAttribute("doi"),desc:b.getElementsByTagName("desc")[0]?b.getElementsByTagName("desc")[0].textContent:""}};phyd3.phyloxml.parseAccession=function(b){return{source:b.getAttribute("source"),comment:b.getAttribute("comment"),value:b.textContent}};phyd3.phyloxml.parseMolSeq=function(b){return{isAligned:b.getAttribute("is_aligned"),value:b.textContent}};phyd3.phyloxml.parseColor=function(b){var d=
b.getElementsByTagName("red")[0],d=d?parseInt(d.textContent):0,a=b.getElementsByTagName("greeen")[0],a=a?parseInt(a.textContent):0,e=b.getElementsByTagName("blue")[0],e=e?parseInt(e.textContent):0;b=(b=b.getElementsByTagName("alpha")[0])?parseInt(b.textContent):255;return"rgba("+d+","+a+","+e+", "+parseFloat(b/255)+")"};phyd3.phyloxml.parseDomainArchitecture=function(b){var d={sequenceLength:parseInt(b.getAttribute("length")),domains:[]};b=b.getElementsByTagName("domain");for(var a=0;a<b.length;a++){var e=
b[a];d.domains.push({confidence:parseFloat(e.getAttribute("confidence")),from:parseInt(e.getAttribute("from")),to:parseInt(e.getAttribute("to")),id:e.getAttribute("id"),name:e.textContent})}return d};phyd3.phyloxml.parseCrossReference=function(b){var d=[];b=b.getElementsByTagName("accession");for(var a=0;a<b.length;a++)d.push(phyd3.phyloxml.parseAccession(b[a]));return d};phyd3.phyloxml.parseEvents=function(b){for(var d={},a=0;a<b.childNodes.length;a++){var e=b.childNodes[a];switch(e.nodeName){case "type":d.type=
e.textContent;break;case "duplications":case "speciations":case "losses":d[e.nodeName]=parseInt(e.textContent);break;case "confidence":d.confidence=phyd3.phyloxml.parseConfidence(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return d};phyd3.phyloxml.parseTaxonomy=function(b){for(var d={uris:[],synonyms:[]},a=0;a<b.childNodes.length;a++){var e=b.childNodes[a];switch(e.nodeName){case "id":case "code":case "authority":case "rank":d[e.nodeName]=
e.textContent;break;case "scientific_name":d.scientificName=e.textContent;break;case "common_name":d.commonName=e.textContent;break;case "synonym":d.synonyms.push(e.textContent);case "uri":d.uris.push(phyd3.phyloxml.parseUri(e));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return d};phyd3.phyloxml.parseAnnotation=function(b){for(var d={ref:b.getAttribute("ref"),source:b.getAttribute("source"),evidence:b.getAttribute("evidence"),
type:b.getAttribute("type"),properties:[],uris:[]},a=0;a<b.childNodes.length;a++){var e=b.childNodes[a];switch(e.nodeName){case "desc":d.desc=e.textContent;break;case "confidence":d.confidence=phyd3.phyloxml.parseConfidence(e);break;case "property":d.properties.push(phyd3.phyloxml.parseProperty(e));break;case "uri":d.uris.push(phyd3.phyloxml.parseUri(e));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return d};phyd3.phyloxml.parseSequence=
function(b){for(var d={type:b.getAttribute("type"),idSource:b.getAttribute("id_source"),idRef:b.getAttribute("id_ref"),uris:[],annotations:[]},a=0;a<b.childNodes.length;a++){var e=b.childNodes[a];switch(e.nodeName){case "symbol":case "name":case "location":d[e.nodeName]=e.textContent;break;case "gene_name":d.geneName=e.textContent;break;case "accession":d.accession=phyd3.phyloxml.parseAccession(e);break;case "cross_reference":d.crossReference=phyd3.phyloxml.parseCrossReference(e);break;case "mol_seq":d.molSeq=
phyd3.phyloxml.parseMolSeq(e);break;case "annotation":d.annotations.push(phyd3.phyloxml.parseAnnotation(e));break;case "uri":d.uris.push(phyd3.phyloxml.parseUri(e));break;case "domain_architecture":d.domainArchitecture=phyd3.phyloxml.parseDomainArchitecture(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return d};phyd3.phyloxml.parseClade=function(b){for(var d={branchset:[],properties:[],taxonomies:[],sequences:[],
confidences:[],references:[],branchLength:parseFloat(b.getAttribute("branch_length"))},a=0;a<b.childNodes.length;a++){var e=b.childNodes[a];switch(e.nodeName){case "branch_length":d.branchLength=parseFloat(e.textContent);break;case "width":d.width=parseFloat(e.textContent);break;case "clade":d.branchset.push(phyd3.phyloxml.parseClade(e));break;case "property":d.properties.push(phyd3.phyloxml.parseProperty(e));break;case "taxonomy":d.taxonomies.push(phyd3.phyloxml.parseTaxonomy(e));break;case "reference":d.references.push(phyd3.phyloxml.parseReference(e));
break;case "confidence":d.confidences.push(phyd3.phyloxml.parseConfidence(e));break;case "sequence":d.sequences.push(phyd3.phyloxml.parseSequence(e));break;case "color":d.color=phyd3.phyloxml.parseColor(e);break;case "events":d.events=phyd3.phyloxml.parseEvents(e);break;case "id":case "name":d[e.nodeName]=e.textContent;break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}d.id||(phyd3.phyloxml.cid++,d.id="_"+phyd3.phyloxml.cid);
return d};phyd3.phyloxml.parseLegend=function(b){for(var d={show:parseInt(b.getAttribute("show")),fields:[],gradient:{}},a=b.getElementsByTagName("field"),e=0;e<a.length;e++){var g=a[e],m=g.getElementsByTagName("name")[0],m=m?m.textContent:"",h=g.getElementsByTagName("color")[0],h=h?h.textContent:"",t=g.getElementsByTagName("background")[0],t=t?t.textContent:"",w=g.getElementsByTagName("shape")[0],w=w?w.textContent:"",g=(g=g.getElementsByTagName("url")[0])?g.textContent:"";d.fields.push({name:m,color:h,
background:t,shape:w,url:g})}if(b=b.getElementsByTagName("gradient")[0])m=(m=b.getElementsByTagName("name")[0])?m.textContent:"",b=(b=b.getElementsByTagName("classes")[0])?parseInt(b.textContent):0,d.gradient={name:m,classes:b};return d};phyd3.phyloxml.parseData=function(b){var d={tag:b.getAttribute("tag"),ref:b.getAttribute("ref")},a=b.getElementsByTagName("min")[0];d.min=a?a.textContent:void 0;a=b.getElementsByTagName("max")[0];d.max=a?a.textContent:void 0;b=b.getElementsByTagName("values");for(a=
0;a<b.length;a++){var e=b[a].getAttribute("for"),g=b[a].getElementsByTagName("value");d[e]=[];for(var m=0;m<g.length;m++)d[e].push(parseFloat(g[m].textContent))}return d};phyd3.phyloxml.parseGraph=function(b){for(var d={name:"",legend:{},data:{},type:b.getAttribute("type")},a=0;a<b.childNodes.length;a++){var e=b.childNodes[a];switch(e.nodeName){case "name":d.name=e.textContent;break;case "legend":d.legend=phyd3.phyloxml.parseLegend(e);break;case "data":d.data=phyd3.phyloxml.parseData(e);break;case "#text":case "#comment":break;
default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return d};phyd3.phyloxml.parseLabel=function(b){for(var d={name:"",data:{},type:b.getAttribute("type")},a=0;a<b.childNodes.length;a++){var e=b.childNodes[a];switch(e.nodeName){case "name":d.name=e.textContent;break;case "data":d.data=phyd3.phyloxml.parseData(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return d};phyd3.phyloxml.parse=
function(b){var d={branchset:[],properties:[],confidence:[]},a=b.getElementsByTagName("phylogeny"),a=a[0];d.rooted=a.getAttribute("rooted");d.rerootable=a.getAttribute("rerootable");d.branch_length_unit=a.getAttribute("branch_length_unit");d.type=a.getAttribute("type");if(a&&a.childNodes)for(var e=0;e<a.childNodes.length;e++){var g=a.childNodes[e];switch(g.nodeName){case "clade":d.branchset.push(phyd3.phyloxml.parseClade(g));break;case "confidence":d.confidence.push(phyd3.phyloxml.parseConfidence(g));
break;case "date":d.date=g.textContent;break;case "description":d.description=g.textContent;break;case "id":d.id=g.textContent;break;case "name":d.name=g.textContent;break;case "property":d.properties.push(phyd3.phyloxml.parseProperty(g));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+g.nodeName+" "+g.textContent+" - skipping...")}}var a=b.getElementsByTagName("taxonomies"),a=a[0],m={};if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++){var h=a.childNodes[e];if("color"==
h.nodeName){var g=h.getElementsByTagName("code")[0].textContent,t=h.getElementsByTagName("value")[0].textContent;m[g]={color:t}}if("taxonomy"==h.nodeName){var g=h.getAttribute("code"),t=(t=h.getElementsByTagName("color")[0])?t.textContent:t,w=h.getElementsByTagName("name")[0],w=w?w.textContent:w,h=(h=h.getElementsByTagName("url")[0])?h.textContent:h;m[g]={color:t,name:w,url:h}}}d.taxcolors=m;a=b.getElementsByTagName("domains");a=a[0];m={};if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)h=a.childNodes[e],
"color"==h.nodeName&&(g=h.getElementsByTagName("code")[0].textContent,t=h.getElementsByTagName("value")[0].textContent,m[g]={color:t}),"domain"==h.nodeName&&(g=h.getAttribute("name"),t=(t=h.getElementsByTagName("color")[0])?t.textContent:t,w=(w=h.getElementsByTagName("description")[0])?w.textContent:w,h=(h=h.getElementsByTagName("url")[0])?h.textContent:h,m[g]={color:t,description:w,url:h});d.domcolors=m;a=b.getElementsByTagName("graphs");a=a[0];g=[];if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)t=
a.childNodes[e],"graph"==t.nodeName&&g.push(phyd3.phyloxml.parseGraph(t));d.graphs=g;a=b.getElementsByTagName("labels");a=a[0];b=[];if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)g=a.childNodes[e],"label"==g.nodeName&&b.push(phyd3.phyloxml.parseLabel(g));d.labels=b;return d}})();