var $jscomp={scope:{}};$jscomp.defineProperty="function"==typeof Object.defineProperties?Object.defineProperty:function(d,b,a){if(a.get||a.set)throw new TypeError("ES3 does not support getters and setters.");d!=Array.prototype&&d!=Object.prototype&&(d[b]=a.value)};$jscomp.getGlobal=function(d){return"undefined"!=typeof window&&window===d?d:"undefined"!=typeof global&&null!=global?global:d};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(d){return $jscomp.SYMBOL_PREFIX+(d||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var d=$jscomp.global.Symbol.iterator;d||(d=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[d]&&$jscomp.defineProperty(Array.prototype,d,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(d){var b=0;return $jscomp.iteratorPrototype(function(){return b<d.length?{done:!1,value:d[b++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(d){$jscomp.initSymbolIterator();d={next:d};d[$jscomp.global.Symbol.iterator]=function(){return this};return d};$jscomp.array=$jscomp.array||{};$jscomp.iteratorFromArray=function(d,b){$jscomp.initSymbolIterator();d instanceof String&&(d+="");var a=0,e={next:function(){if(a<d.length){var g=a++;return{value:b(g,d[g]),done:!1}}e.next=function(){return{done:!0,value:void 0}};return e.next()}};e[Symbol.iterator]=function(){return e};return e};
$jscomp.polyfill=function(d,b,a,e){if(b){a=$jscomp.global;d=d.split(".");for(e=0;e<d.length-1;e++){var g=d[e];g in a||(a[g]={});a=a[g]}d=d[d.length-1];e=a[d];b=b(e);b!=e&&null!=b&&$jscomp.defineProperty(a,d,{configurable:!0,writable:!0,value:b})}};$jscomp.polyfill("Array.prototype.values",function(d){return d?d:function(){return $jscomp.iteratorFromArray(this,function(b,a){return a})}},"es6","es3");
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.newick={};phyd3.newick.parse=function(d){var b=[],a={};d=d.split(/\s*(;|\(|\)|,|:)\s*/);for(var e=0,g=0;g<d.length;g++){var p=d[g];switch(p){case "(":p={};a.id=e;e++;a.branchset=[p];b.push(a);a=p;break;case ",":p={};b[b.length-1].branchset.push(p);a=p;break;case ")":a=b.pop();break;case ":":break;default:var k=d[g-1];")"==k||"("==k||","==k?a.name=p:":"==k&&(a.branchLength=parseFloat(p));a.id=e;e++}}return a}})();
if(!d3)throw"d3 wasn't included!";window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(d){window.setTimeout(d,1E3/60)}}();
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.phylogram={};phyd3.phylogram.options={};phyd3.phylogram.intenals={};phyd3.phylogram.domains={};phyd3.phylogram.graphs={};phyd3.phylogram.dx=0;phyd3.phylogram.lineAreas=[];phyd3.phylogram.labelAreas=[];phyd3.phylogram.projection=function(d){return[parseInt(d.y),parseInt(d.x)]};phyd3.phylogram.rightAngleDiagonal=function(d,b){b=d.source;d=d.target;b=[b,{x:d.x,y:b.y},d];b=b.map(phyd3.phylogram.projection);phyd3.phylogram.lineAreas.push({start:b[1],
end:b[2]});!d.children&&b[2][0]>phyd3.phylogram.dx&&(phyd3.phylogram.dx=b[2][0]);return"M"+b[0]+" "+b[1]+" "+b[2]};phyd3.phylogram.scaleBranchLengths=function(d,b){function a(b,d){d(b);if(b.children)for(var e=b.children.length-1;0<=e;e--)a(b.children[e],d)}a(d[0],function(a){a.rootDist=(a.parent?a.parent.rootDist:0)+(a.branchLength||0)});var e=d.map(function(a){return a.rootDist}),g=d3.scale.linear().domain([0,d3.max(e)]).range([0,b]);a(d[0],function(a){a.y=parseInt(g(a.rootDist))});return g};phyd3.phylogram.randomColor=
function(){function d(a,b,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(b-a)*d:.5>d?b:d<2/3?a+(b-a)*(2/3-d)*6:a}var b=Math.random();return function(a,b,g){if(0==b)g=b=a=g;else{var e=.5>g?g*(1+b):g+b-g*b,k=2*g-e;g=d(k,e,a+1/3);b=d(k,e,a);a=d(k,e,a-1/3)}return"#"+Math.round(255*g).toString(16)+Math.round(255*b).toString(16)+Math.round(255*a).toString(16)}((b+.618033988749895)%1,.5,.6)};phyd3.phylogram.scaledomainWidths=function(d,b){d=d.map(function(a){return a.sequences&&a.sequences[0]&&a.sequences[0].domainArchitecture&&
a.sequences[0].domainArchitecture.sequenceLength?a.sequences[0].domainArchitecture.sequenceLength:0});return d3.scale.linear().domain([0,d3.max(d)]).range([0,b])};phyd3.phylogram.build=function(d,b,a){function e(){return a.invertColors?a.backgroundColor:a.foregroundColor}function g(){var m=d.replace("#",""),m=document.getElementById(m).querySelector("svg"),b=m.getElementById("main"),f=b.getBBox(),b=b.getAttributeNode("transform"),e=m.getAttributeNode("width"),n=m.getAttributeNode("height"),h=b.value,
l=e.value,g=n.value;b.value="translate("+a.marginX+", "+a.marginY+")";e.value=f.width+a.marginX;n.value=f.height+a.marginY;if("undefined"!=typeof window.XMLSerializer)var x=(new XMLSerializer).serializeToString(m);else"undefined"!=typeof m.xml&&(x=m.xml);b.value=h;e.value=l;n.value=g;return x}function p(){a.showDomains?(G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth),u.append("svg:path").attr("class","domain").attr("stroke",e()).attr("visibility",function(a,b){return a.show?"visibile":"hidden"}),
C=C.data(function(a,b,f){a=a.sequences&&a.sequences[0]&&a.sequences[0].domainArchitecture?a.sequences[0].domainArchitecture.domains:[];for(f=0;f<a.length;f++)a[f].i=b;a.sort(function(a,f){return Math.abs(f.to-f.from)-Math.abs(a.to-a.from)});return a}).enter().append("svg:g").attr("class","domain"),C.append("svg:rect").attr("class","domain hover-visible").attr("stroke",a.foregroundColor).attr("stroke-width",a.outline+"px").append("title").text(function(a){return a.name}),r(),D(),w()):(C.remove(),u.selectAll("path.domain").remove(),
C=u.selectAll("g.domain"))}function k(){a.showDomainNames?(C.append("svg:text").attr("class","domain").attr("dy",-3).attr("fill",e()).attr("font-size","10px").text(function(a){return a.name}),D()):C.selectAll("text.domain").remove()}function r(){var b=u.data();u.selectAll("g.domain").attr("visibility",function(m,f,d){return b[d].show&&m.confidence<=a.domainLevel?"visible":"hidden"});u.selectAll("path.domain").attr("visibility",function(a){return a.show?"visible":"hidden"});d3.select("#domainLevel").attr("value",
a.domainLevel.toPrecision(1))}function w(){C.selectAll("rect.domain").attr("fill",function(m){return a.showDomainColors&&b.domcolors[m.name]?b.domcolors[m.name].color.replace(/0x/,"#"):e()})}function D(){var b=u.data(),d=I+(a.showLabels?J:0)+(a.showGraphs?v:0);G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth);u.selectAll("path.domain").attr("d",function(f,m,e){m=a.lineupNodes?phyd3.phylogram.dx-b[e].y:0;f=f.sequences&&f.sequences[0]&&f.sequences[0].domainArchitecture?f.sequences[0].domainArchitecture.sequenceLength:
0;return"M"+parseInt(d+m)+",0L"+parseInt(d+m+G(f))+",0"});C.selectAll("rect.domain").attr("width",function(a){return parseInt(G(a.to-a.from))}).attr("transform",function(f,m,e){return"translate("+parseInt(d+(a.lineupNodes?phyd3.phylogram.dx-b[f.i].y:0)+G(f.from))+","+parseInt(-1*a.nodeHeight)+")"}).attr("height",2*a.nodeHeight-2);C.selectAll("text.domain").attr("transform",function(f){return"translate("+parseInt(d+(a.lineupNodes?phyd3.phylogram.dx-b[f.i].y:0)+G(f.from))+","+parseInt(-1*a.nodeHeight)+
")"});d3.select("#domainWidth").attr("value",a.domainWidth)}function aa(){a.showSupportValues?(q.selectAll("g.inner.node").append("svg:text").attr("class","supportValue").attr("dx",-2).attr("text-anchor","end").attr("fill",a.supportValuesColor).text(function(a){var b="";if(a.confidences)for(var f in a.confidences)b+=parseFloat(a.confidences[f].value)+" ";return b}),z()):q.selectAll("text.supportValue").remove()}function ba(){a.showLengthValues?(q.selectAll("g.node").append("svg:text").attr("class",
"branchLength").attr("dx",-2).attr("text-anchor","end").attr("fill",a.branchLengthColor).text(function(a){return a.branchLength?parseFloat(a.branchLength).toFixed(5):""}),z()):q.selectAll("text.branchLength").remove()}function V(a,b,f){var m=a.attr("id")+"_"+a.selectAll("div.panel-default").size(),d=a.append("div").attr("class","panel panel-default");d.append("div").attr("class","panel-heading").attr("role","tab").attr("id","heading"+m).append("h4").attr("class","panel-title").append("a").attr("class",
"collapsed").attr("aria-expanded",f?"true":"false").attr("role","button").attr("data-toggle","collapse").attr("data-parent","#"+a.attr("id")).attr("href","#collapse"+m).attr("aria-controls","collapse"+m).html(b);return d.append("div").attr("id","collapse"+m).attr("class","panel-collapse collapse "+(f?"in":"")).attr("role","tabpanel").attr("aria-labelledby","heading"+m).append("div").attr("class","panel-body table-responsive")}function ka(m){var e=d3.event;if(!e.defaultPrevented){var f=e.layerX;y=
e.layerY;var A="popup"+parseInt(Date.now()*Math.random()*1E3),f=d3.select(d).append("div").attr("class","popup").attr("id",A).style("position","absolute").style("top",parseInt(y)+"px").style("left",parseInt(f)+"px").style("width",parseInt(a.popupWidth)+"px").style("color",a.foregroundColor).style("background-color",a.backgroundColor),n=f.append("button").attr("class","btn btn-link").style("position","absolute").style("right","8px");n.append("span").attr("class","glyphicon glyphicon-remove").attr("aria-hidden",
"true");n.on("click",function(){d3.select("#"+A).remove();q.selectAll("g.node.cid_"+m.id).selectAll("rect.pointer").style("opacity","0")});f=f.append("div").attr("class","panel-group").attr("id","accordion_"+parseInt(Date.now()*Math.random()*1E3)).attr("role","tablist").attr("aria-multiselectable","true");n="text"==e.target.nodeName||e.target.classList.contains("pointer")?!0:!1;n=V(f,"Node",n).append("table").attr("class","table table-condensed table-bordered").append("tbody");if(m.name){var h=n.append("tr");
h.append("td").text("Name");h.append("td").text(m.name)}if(m.taxonomies)for(var l in m.taxonomies){var g=m.taxonomies[l],h=n.append("tr");h.append("td").text("Taxononomy");h=h.append("td");b.taxcolors[g.code]&&b.taxcolors[g.code].url&&(h=h.append("a").attr("href",b.taxcolors[g.code].url));var x="",x=x+(b.taxcolors[g.code]&&b.taxcolors[g.code].name?b.taxcolors[g.code].name+" ":""),x=x+" ",x=x+(g.scientificName?"\x3ci\x3e"+g.scientificName+"\x3c/i\x3e":""),x=x+" ",x=x+(g.commonName?g.commonName:""),
x=x+" ",x=x+(g.code?"("+g.code+")":"");h.html(x)}if(m.confidences)for(var ma in m.confidences)h=n.append("tr"),h.append("td").text("Confidence"),h.append("td").html(m.confidences[ma].value);h=n.append("tr");h.append("td").text("Depth");h.append("td").text(m.depth);h=n.append("tr");h.append("td").text("Branch length");h.append("td").text(m.branchLength?m.branchLength:0);h=n.append("tr");h.append("td").text("Distance from root");h.append("td").text(m.rootDist);for(var k in m.properties)h=m.properties[k],
p=h.ref,l=h.value,l=l.trim(),/^http:\/\//.test(l)&&(l="\x3ca href\x3d'"+l+"' target\x3d'_blank'\x3e"+l+"\x3c/a\x3e\x3cbr /\x3e"),h=n.append("tr"),h.append("td").text(p),h.append("td").html(l);for(var p in m.events)l=m.events[p],h=n.append("tr"),h.append("td").text(p),h.append("td").html(l);if(m.sequences)for(var r in m.sequences)if(m.sequences[r].domainArchitecture&&m.sequences[r].domainArchitecture.domains){n=e.target.parentNode.classList.contains("domain")?!0:!1;n=V(f,"Domains",n).append("table").attr("id",
"dt"+A).attr("class","table table-condensed table-bordered");p=n.append("thead").append("tr");p.append("th").text("#");p.append("th").text("Name");p.append("th").text("Description");p.append("th").text("From");p.append("th").text("To");p.append("th").text("P value");n=n.append("tbody");for(k=0;k<m.sequences[r].domainArchitecture.domains.length;k++)l=m.sequences[r].domainArchitecture.domains[k],h=n.append("tr"),h.append("td").style("background",b.domcolors[l.name]&&b.domcolors[l.name].color?b.domcolors[l.name].color.replace("0x",
"#"):"").text(" "),p=h.append("td"),b.domcolors[l.name]&&b.domcolors[l.name].url&&(p=p.append("a").attr("href",b.domcolors[l.name].url)),p.text(l.name),h.append("td").text(b.domcolors[l.name]?b.domcolors[l.name].description:""),h.append("td").text(l.from),h.append("td").text(l.to),h.append("td").text(l.confidence);$("#dt"+A).dataTable({searching:!1,paging:!1,language:{info:""},order:[[3,"asc"]],columns:[{orderable:!1},null,null,null,null,null]})}if(b.graphs)for(r=0;r<b.graphs.length;r++)if(l=b.graphs[r],
l.data&&l.data[m.id]&&l.data[m.id].length)for(n=e.target.parentNode.classList.contains(l.type)?!0:!1,n=V(f,l.name,n).append("table").attr("class","table table-condensed table-bordered").append("tbody"),k=0;k<l.legend.fields.length;k++)h=n.append("tr"),p=h.append("td"),l.legend.fields[k].url&&(p=p.append("a").attr("href",l.legend.fields[k].url)),p.text(l.legend.fields[k].name),h.append("td").text(l.data[m.id][k]);q.selectAll("g.node.cid_"+m.id).selectAll("rect.pointer").style("opacity","1");e.stopPropagation()}}
function ca(){a.lineupNodes?q.selectAll("g.leaf").append("path").attr("class","support").attr("stroke",e()).attr("stroke-dasharray","2,3").attr("stroke-width","0.5px"):q.selectAll("path.support").remove()}function Q(m){if(m.children&&"only leaf"==a.showNodesType||!m.children&&"only inner"==a.showNodesType)return"";var d="";if(a.showTaxonomy&&m.taxonomies)for(var f in m.taxonomies){var e=m.taxonomies[f];a.showFullTaxonomy&&(d+=b.taxcolors[e.code]&&b.taxcolors[e.code].name?b.taxcolors[e.code].name:
"",d+=" ",d+=e.scientificName?e.scientificName:"",d+=" ",d+=e.commonName?e.commonName:"",d+=" ");d+=e.code?e.code:"";d+=" "}d+=(a.showNodeNames&&m.name?m.name:"")+" ";if(a.showSequences&&m.sequences)for(var n in m.sequences)if(f=m.sequences[n],d+=f.symbol?f.symbol:"",d+=" ",d+=f.accession?f.accession.value:"",d+=" ",d+=f.name?f.name:"",d+=" ",d+=f.geneName?f.geneName:"",d+=" ",f.annotations)for(var h in f.annotations)d+=f.annotations[h].desc?f.annotations[h].desc:"",d+=" ";return d}function R(){var b=
0;u.selectAll("text.name").text(function(a){a=Q(a);a.length>b&&(b=a.length);return a});q.selectAll("g.node.inner").selectAll("text.name").text(Q);a.showGraphs&&K();a.showDomains&&D()}function H(){u.selectAll("text.name").attr("visibility",function(a){return a.show?"visible":"hidden"});a.lineupNodes&&u.selectAll("path.support").attr("visibility",function(a){return a.show?"visible":"hidden"});a.showLabels&&da();a.showGraphs&&ea();a.showDomains&&r()}function W(){q.selectAll("text.name").attr("stroke",
e()).attr("stroke-width",a.outline+"px").attr("fill",function(m){var d=null;if(a.showTaxonomyColors&&b.taxcolors&&m.taxonomies)for(var f in m.taxonomies){var A=m.taxonomies[f];b.taxcolors[A.code]&&b.taxcolors[A.code].color&&(d=b.taxcolors[A.code].color.replace(/0x/,"#"))}return d?d:e()})}function fa(){u.selectAll("text.name").attr("dx",function(b){return parseInt(a.lineupNodes?phyd3.phylogram.dx-b.y+5:5)});u.selectAll("path.support").attr("d",function(a){return"M0,0 L"+parseInt(phyd3.phylogram.dx-
a.y)+",0"});a.showLabels&&X();a.showGraphs&&K();a.showDomains&&D()}function z(){q.selectAll("text.name").attr("dy",a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");q.selectAll("text.branchLength").attr("dy",-a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");q.selectAll("text.supportValue").attr("dy",a.nodeHeight/2+5).attr("font-size",1.5*a.nodeHeight+"px");I=100*a.nodeHeight/6+10;d3.select("#nodeHeight").attr("value",a.nodeHeight);fa();a.showLabels&&X();a.showGraphs&&K();a.showDomains&&
D()}function ga(){if(a.showLabels&&b.labels){for(var d=0;d<b.labels.length;d++){var t=b.labels[d];t.id||(t.id=parseInt(Date.now()*Math.random()*1E3));t.data.tag&&q.selectAll("g.node").each(function(a){var f=a[t.data.tag],b=t.data.ref,b=b?b:"value",f="object"==typeof f?f[b]:f;if("property"==t.data.tag)for(pid in a.properties){var d=a.properties[pid];if(d.ref==b){f=d.value;break}}f&&(t.data[a.id]=f)});switch(t.type){case "text":for(cid in t.data)t.data[cid]&&parseInt(cid)&&q.selectAll(".cid_"+cid).append("text").attr("class",
"nodelabel text lid"+t.id).attr("dy",3).attr("text-anchor","start").attr("stroke-width","0.3px").attr("stroke",e()).attr("fill",e()).attr("font-size",1.5*a.nodeHeight+"px").attr("visibility","visible").text(t.data[cid]).append("title").text(t.name+": "+t.data[cid]);break;case "color":for(cid in t.data)if(t.data[cid]&&parseInt(cid)){var f=a.nodeHeight,A=t.data[cid].replace(/0x/,"#");q.selectAll(".cid_"+cid).append("rect").attr("height",2*f).attr("width",2*f).attr("class","nodelabel color lid"+t.id).attr("style",
"fill: "+A+"; stroke: "+A).append("title").text(t.name)}}}da();X()}else q.selectAll(".nodelabel").remove(),J=0;K();D()}function X(){var d=a.nodeHeight;J=0;if(b.labels){for(var e=0;e<b.labels.length;e++){var f=b.labels[e],A=0;u.selectAll(".nodelabel.lid"+f.id).attr("transform",function(b){var m=0,e=0;"color"==f.type&&(m=e=-d);var t=0;"text"==this.nodeName&&this.firstChild?t=this.firstChild.length*d/1.5:"rect"==this.nodeName&&(t=2*d);t>A&&(A=t);return"translate("+parseInt(m+d+J+(a.lineupNodes?phyd3.phylogram.dx-
b.y+I:I))+","+e+")"});J+=A+2*d}e=u.selectAll(".nodelabel");e.selectAll("text").attr("dy",a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");e.selectAll("rect").attr("width",2*a.nodeHeight).attr("height",2*a.nodeHeight)}}function da(){u.selectAll(".nodelabel").attr("visibility",function(a){return a.show?"visible":"hidden"})}function ha(){if(a.showGraphs&&b.graphs&&b.graphs.length){d3.svg.arc().innerRadius(0).outerRadius(a.nodeHeight);for(var d=d3.layout.pie().value(function(a){return a.value}).sort(null),
t=v=0;t<b.graphs.length;t++){var f=b.graphs[t];f.id||(f.id=parseInt(Date.now()*Math.random()*1E3));if(f.data.tag)var A=q.selectAll("g.node").each(function(a){var b=a[f.data.tag],d=f.data.ref,d=d?d:"value",b="object"==typeof b?b[d]:b;if("property"==f.data.tag)for(pid in a.properties){var m=a.properties[pid];if(m.ref==d){b=m.value;break}}b&&(f.data[a.id]=[],f.data[a.id][0]=b,"pie"==f.type&&f.data.max&&(f.data[a.id][1]=f.data.max-b,f.legend.fields[1]={name:f.legend.fields[0].name,color:f.legend.fields[0].background?
f.legend.fields[0].background:phyd3.phylogram.randomColor(),invert:!0}))});switch(f.type){case "pie":for(cid in f.data)if(f.data[cid]&&Array.isArray(f.data[cid])){var n=!1;q.select(".cid_"+cid).each(function(a){0==a.branchset.length&&(n=!0)});for(var A=q.selectAll(".cid_"+cid).append("svg:g").attr("class","graph pie gid"+f.id),h=[],l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,value:f.data[cid][l],leaf:n});A.selectAll("path.pie.gid"+f.id).data(d(h)).enter().append("path").attr("class",
"pie hover-visible gid"+f.id).attr("stroke",e()).attr("stroke-width",a.outline+"px").attr("fill",function(a,b){return f.legend.fields?(f.legend.fields[b]||(f.legend.fields[b]={},f.legend.fields[b].name="Series "+(b+1),f.legend.fields[b].color=phyd3.phylogram.randomColor()),f.legend.fields[b].color.replace(/0x/,"#")):""}).append("title").text(function(a,b){return f.legend.fields?(f.legend.fields[b]&&f.legend.fields[b].name?f.legend.fields[b].name+": ":"")+(f.legend.fields[b].invert?f.data.max-a.data.value:
a.data.value):""})}break;case "binary":for(cid in f.data)if(f.data[cid]&&Array.isArray(f.data[cid])){h=[];n=!1;q.select(".cid_"+cid).each(function(a){0==a.branchset.length&&(n=!0)});A=q.selectAll(".cid_"+cid).append("svg:g").attr("class","graph binary gid"+f.id);for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,value:f.data[cid][l],shape:f.legend.fields[l]?f.legend.fields[l].shape:"",leaf:n});A.selectAll("path.binary.gid"+f.id).data(h).enter().append("path").attr("class","binary hover-visible gid"+
f.id).attr("style",function(a,b){b=(f.legend.fields[b]?f.legend.fields[b].color:"").replace(/0x/,"#");return"fill:"+(1<=a.value?b:"none")+";stroke:"+(0<=a.value?b:"none")}).append("title").text(function(a,b){return(f.legend.fields[b]?f.legend.fields[b].name+": ":"")+a.value})}break;case "multibar":L[f.id]=[];for(l=0;l<f.legend.fields.length;l++)A=d3.max(d3.values(f.data),function(a){if(a)return a[l]}),L[f.id][l]=d3.scale.linear().domain([0,A]);for(cid in f.data)if(f.data[cid]){A=q.select(".cid_"+
cid).append("svg:g").attr("class","graph multibar gid"+f.id);h=[];for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,value:f.data[cid][l]});A.selectAll("rect.multibar.gid"+f.id).data(h).enter().append("rect").attr("class","multibar hover-visible gid"+f.id).attr("fill",function(a,b){return(f.legend.fields[b]?f.legend.fields[b].color:"").replace(/0x/,"#")}).attr("stroke",a.foregroundColor).attr("stroke-width",a.outline).append("title").text(function(a,b){return(f.legend.fields[b]?
f.legend.fields[b].name+": ":"")+a.value})}break;case "heatmap":var A=d3.max(d3.values(f.data),function(a){if(a)return d3.max(a)}),h=d3.min(d3.values(f.data),function(a){if(a)return d3.min(a)}),g=d3.scale.quantize().domain([h,A]).range(colorbrewer[f.legend.gradient.name][f.legend.gradient.classes]);for(cid in f.data)if(f.data[cid]){A=q.select(".cid_"+cid).append("svg:g").attr("class","graph heatmap gid"+f.id);h=[];if(f.data[cid])for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,
value:f.data[cid][l]});A.selectAll("rect.heatmap.gid"+f.id).data(h).enter().append("rect").attr("class","heatmap hover-visible gid"+f.id).attr("fill",function(a,b){return g(a.value)}).attr("stroke",a.foregroundColor).attr("stroke-width",a.outline+"px").append("title").text(function(a,b){return(f.legend.fields[b]?f.legend.fields[b].name+": ":"")+a.value})}break;default:console.log("Graph not supported "+f.type)}}ea();K()}else v=0,q.selectAll("g.graph").remove(),q.selectAll("text.legend").remove();
D()}function K(){var d=a.nodeHeight,t=I+J,f=u.selectAll("g.graph").attr("transform",function(b){return"translate("+(a.lineupNodes?phyd3.phylogram.dx-b.y+t:t)+",0)"});d3.select("#graphWidth").attr("value",a.graphWidth);q.selectAll("text.legend").remove();v=0;if(b.graphs){for(var A=0;A<b.graphs.length;A++){var n=b.graphs[A];switch(n.type){case "pie":f.selectAll("path.pie.gid"+n.id).attr("d",function(a){return d3.svg.arc().innerRadius(0).outerRadius(d)(a)}).attr("transform",function(a){return" translate("+
parseInt(a.data.leaf?d+v:0)+",0)"});a.showGraphLegend&&q.append("text").attr("class","legend").text(0!=n.legend.show?n.name:"").attr("transform","translate("+parseInt(phyd3.phylogram.dx+t+v+2*d)+",-10) rotate(-90)");v+=2*d+5;break;case "binary":f.selectAll("path.binary.gid"+n.id).attr("d",function(a){var b=d3.svg.symbol().size(4*(d-2)*(d-2));b.type(n.legend.fields[a.i].shape);return b(a)}).attr("transform",function(a){return" translate("+(a.leaf?v+10+a.i*(2*d+5):0)+" ,0)"});if(a.showGraphLegend)for(var h=
0;h<n.legend.fields.length;h++)q.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[h].name:"").attr("transform","translate("+(phyd3.phylogram.dx+t+v+h*(2*d+5)+2*d)+", -10) rotate(-90)");v+=(n.legend.fields.length+1)*(2*d+5)+5;break;case "multibar":for(h=0;h<n.legend.fields.length;h++)L[n.id][h]=L[n.id][h].range([0,a.graphWidth]);f.selectAll("rect.multibar.gid"+n.id).attr("height",parseInt(2*d)).attr("width",function(a,b){return parseInt(L[n.id][a.i]?L[n.id][a.i](a.value):
0)}).attr("transform",function(b,f){return" translate("+parseInt(v+b.i*(a.graphWidth+5))+",-"+parseInt(d)+")"});if(a.showGraphLegend)for(h=0;h<n.legend.fields.length;h++)q.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[h].name:"").attr("transform","translate("+(phyd3.phylogram.dx+t+v+h*(a.graphWidth+5)+a.graphWidth/2)+",-10) rotate(-90)");v+=n.legend.fields.length*(a.graphWidth+5);break;case "heatmap":f.selectAll("rect.heatmap.gid"+n.id).attr("width",2*d).attr("height",
2*d).attr("transform",function(a,b){return" translate("+(v+2*a.i*d)+",-"+d+")"});if(a.showGraphLegend)for(h=0;h<n.legend.fields.length;h++)q.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[h].name:"").attr("transform","translate("+parseInt(phyd3.phylogram.dx+t+v+(h+1)*d*2)+",-10) rotate(-90)");v+=2*n.legend.fields.length*d+5}}q.selectAll("text.legend").attr("fill",e()).attr("font-size",2*a.nodeHeight)}}function la(){var d=a.nodeHeight;v=0;if(b.graphs)for(var e=0;e<b.graphs.length;e++){var f=
b.graphs[e];switch(f.type){case "pie":v+=2*d+5;break;case "binary":v+=(f.legend.fields.length+1)*(2*d+5)+5;break;case "multibar":v+=f.legend.fields.length*(a.graphWidth+5);break;case "heatmap":v+=2*f.legend.fields.length*d+5}}return 2*a.margin+(a.showNodeNames?I:0)+(a.showGraphs?v:0)+(a.showDomains?a.domainWidth:0)}function ea(){var b=[],d=function(f){if(!a.dynamicHide)return"visible";for(var d=!0,m=a.nodeHeight,e=f.x,t=f.y,g=0;g<b.length;g++){var x=b[g].x,p=b[g].y;if((x-e)*(x-e)+(p-t)*(p-t)<=4*m*
m){d=!1;break}}return d?(b.push(f),"visible"):"hidden"};u.selectAll("g.graph").attr("visibility",function(a){return a.show?"visible":"hidden"});q.selectAll("g.inner").selectAll(".graph.pie").attr("visibility",d);q.selectAll("g.inner").selectAll(".graph.binary").attr("visibility",d)}function E(d){phyd3.phylogram.lineAreas=[];phyd3.phylogram.dx=0;var m=d3.layout.cluster().separation(function(a,b){return 1}).children(a.children||function(a){return a.branchset}).size([M*a.scaleY,F*a.scaleX]);B=m(b);a.showPhylogram||
phyd3.phylogram.scaleBranchLengths(B,F*a.scaleX);var f=q.selectAll("path.link");d||(f=f.data(m.links(B)),f.enter().append("svg:path").attr("class","link").attr("fill","none").attr("stroke",e()));f.attr("d",phyd3.phylogram.rightAngleDiagonal);N=void 0;c=0;f=B.filter(function(a){return!a.children});for(m=0;m<f.length;m++)f[m].show=a.dynamicHide?ia(f[m],!a.lineupNodes):!0;N=void 0;f=B.filter(function(a){return a.children});for(m=0;m<f.length;m++)0<Q(f[m]).trim().length?f[m].show=a.dynamicHide?ia(f[m],
!0):!0:f[m].show=!1;d||(S=S.data(B),S.enter().append("svg:g").attr("class",function(a){return a.children?0==a.depth?"root node cid_"+a.id:"inner node cid_"+a.id:"leaf node cid_"+a.id}).style("cursor","pointer").on("click",void 0===a.popupAction?ka:a.popupAction).append("rect").attr("class","pointer").attr("fill","red").attr("width",2*a.nodeHeight+2+"px").attr("height",2*a.nodeHeight+2+"px").style("opacity","0").attr("x","-"+(a.nodeHeight+1)+"px").attr("y","-"+(a.nodeHeight+1)+"px"));S.attr("transform",
function(a){return"translate("+parseInt(a.y)+","+parseInt(a.x)+")"});phyd3.phylogram.lineAreas=[]}function O(){E(!0);T()}function ia(b,d){var f=!0,m=b.y+1,e=b.y+5.5*Q(b).length,t=b.x-a.nodeHeight,l=b.x+a.nodeHeight;if(!N)return N=b,!0;a.lineupNodes&&!b.children&&(m+=phyd3.phylogram.dx-b.y,e+=phyd3.phylogram.dx-b.y);var g=N,x=g.y+1,p=g.y+5.5*Q(g).length,k=g.x-a.nodeHeight,q=g.x+a.nodeHeight;a.lineupNodes&&!g.children&&(x+=phyd3.phylogram.dx-g.y,p+=phyd3.phylogram.dx-g.y);if(x<=m&&m<=p&&k<=t&&t<=q||
x<=e&&e<=p&&k<=t&&t<=q||x<=m&&m<=p&&k<=l&&l<=q||x<=e&&e<=p&&k<=l&&l<=q)f=!1;if(f&&d)for(d=0;d<phyd3.phylogram.lineAreas.length;d++)if(k=phyd3.phylogram.lineAreas[d],g=k.start[0],x=k.end[0],p=k.start[1],k=k.end[1],p==k){if(t<=p&&k<=l&&!(g>e||x<m)){f=!1;break}}else if(g==x&&m<=g&&x<=e&&!(p>l||k<t)){f=!1;break}f&&(N=b);return f}function T(){var b=Y.translate(),d=b[0]+a.marginX-a.translateX,f=b[1]+a.marginY-a.translateY;q.attr("transform",function(a){return"translate("+parseInt(d)+","+parseInt(f)+") scale(1)"});
0!=a.lastScale&&(fa(),a.dynamicHide&&H())}a=a||{};a.scaleY=a.scaleY||1;a.scaleX=a.scaleX||1;a.translateX=a.translateX||0;a.translateY=a.translateY||0;a.height=a.height||800;a.margin=a.margin||20;a.scaleStep=a.scaleStep||.3;a.nodeHeight=a.nodeHeight||6;a.nodeHeightStep=a.nodeHeightStep||1;a.textLength=a.textLength||100;a.domainWidth=a.domainWidth||100;a.domainWidthStep=a.domainWidthStep||100;a.graphWidth=a.graphWidth||20;a.graphWidthStep=a.graphWidthStep||10;a.foregroundColor=a.foregroundColor||"#000";
a.backgroundColor=a.backgroundColor||"#fff";a.domainLevel=a.domainLevel||1;a.domainLevelStep=a.domainLevelStep||10;a.outline=a.outline||.3;a.branchLengthColor=a.branchLengthColor||"red";a.supportValuesColor=a.supportValuesColor||"blue";a.popupWidth=a.popupWidth||500;a.showNodesType=a.showNodesType||"only leaf";a.showFullTaxonomy=a.showFullTaxonomy||!1;a.showLabels=a.showLabels||!0;a.treeWidth=a.treeWidth||"auto";var B,G,N,L=[],J=100,I=100,v=0,P=100,ja=!1;if(b.graphs)for(var Z=0;Z<b.graphs.length;Z++)if(0!=
b.graphs[Z].legend.show){ja=!0;break}P=ja?P:0;a.marginX=a.margin;a.marginY=a.margin+(a.showGraphs?P:0);var U=$(d).width(),F="auto"==a.treeWidth?U-la():a.treeWidth,M=a.height-(2*a.margin+(a.showGraphs?P:0)),F=parseInt(F),M=parseInt(M);0>F&&(F=U-2*I-(a.showGraphs?2*P:0));var Y=d3.behavior.zoom().scaleExtent([1,1]).on("zoom",function(b){b=0;var d=d3.event.sourceEvent;if(d){if(0<d.deltaY||0>d.wheelDelta)b=-1*a.scaleStep;if(0>d.deltaY||0<d.wheelDelta)b=a.scaleStep;var f=.5,e=.5;d.altKey||d.ctrlKey||(f=
d.layerX/U,e=d.layerY/a.height);if(d.ctrlKey||!d.altKey)a.scaleY+=b,a.scaleY<a.scaleStep?a.scaleY=a.scaleStep:a.translateY+=M*b*e;if(d.altKey||!d.ctrlKey)a.graphWidth+=0==b?0:0>b?-10:10,10>a.graphWidth&&(a.graphWidth=10),a.domainWidth+=0==b?0:0>b?-1*a.domainWidthStep:a.domainWidthStep,a.domainWidth<a.domainWidthStep&&(a.domainWidth=a.domainWidthStep),a.scaleX+=b,a.scaleX<a.scaleStep?a.scaleX=a.scaleStep:a.translateX+=F*b*f;a.lastScale=b;0!=a.lastScale?requestAnimFrame(O):requestAnimFrame(T)}});d3.select(d).select("svg").remove();
var q=d3.select(d).insert("svg").attr("width",U+"px").attr("height",a.height+"px").attr("overflow","hidden").attr("version","1.1").attr("font-family","Open Sans").attr("xmlns","http://www.w3.org/2000/svg").call(Y);q.append("svg:rect").attr("class","canvas").attr("width","100%").attr("height","100%").attr("fill",a.invertColors?a.foregroundColor:a.backgroundColor);q.append("svg:text").attr("dy","20px").attr("stroke",e()).attr("stroke-width","1px").attr("font-size","15px").text(b.name?b.name:"");q.append("svg:text").attr("dy",
"40px").attr("stroke",e()).attr("stroke-width","0.5px").attr("font-size","10px").text(b.description?b.description:"");var q=q.append("svg:g").attr("id","main").attr("transform","translate("+a.marginX+", "+a.marginY+")"),S=q.selectAll("g.node");E();0==phyd3.phylogram.dx&&(d3.select("#phylogram").attr("checked","").attr("disabled","disabled"),a.showPhylogram=!0,E());var u=q.selectAll("g.leaf.node"),C=u.selectAll("g.domain");aa();ba();p();k();ha();ca();ga();S.append("svg:text").attr("class","name").attr("dx",
a.nodeHeight+1).attr("dy",3).attr("text-anchor","start");W();R();H();T();z();d3.select("#dynamicHide").on("click",function(){a.dynamicHide=!a.dynamicHide;E(!0);H()});d3.select("#invertColors").on("click",function(){a.invertColors=!a.invertColors;d3.selectAll(".canvas").attr("fill",a.invertColors?a.foregroundColor:a.backgroundColor);var b=e();q.selectAll("path.link").attr("stroke",b);q.selectAll("text.legend").attr("fill",b);u.selectAll("path.support").attr("stroke",b);u.selectAll("path.domain").attr("stroke",
b);u.selectAll("text.nodelabel").attr("stroke",b).attr("fill",b);W();w()});d3.select("#phylogram").on("click",function(){a.showPhylogram=!a.showPhylogram;E(!0);z();H()});d3.select("#lineupNodes").on("click",function(){a.lineupNodes=!a.lineupNodes;E(!0);ca();z();H()});d3.select("#lengthValues").on("click",function(){a.showLengthValues=!a.showLengthValues;ba()});d3.select("#supportValues").on("click",function(){a.showSupportValues=!a.showSupportValues;aa();H()});d3.select("#nodeNames").on("click",function(){a.showNodeNames=
!a.showNodeNames;R();z()});d3.select("#nodeLabels").on("click",function(){a.showLabels=!a.showLabels;ga()});d3.select("#taxonomy").on("click",function(){a.showTaxonomy=!a.showTaxonomy;R();z()});d3.select("#sequences").on("click",function(){a.showSequences=!a.showSequences;R();z()});d3.select("#nodesType").on("change",function(){a.showNodesType=$(this).val();O();R()});d3.select("#taxonomyColors").on("click",function(){a.showTaxonomyColors=!a.showTaxonomyColors;W()});d3.select("#nodeHeightLower").on("click",
function(){a.nodeHeight-=a.nodeHeightStep;a.nodeHeight<a.nodeHeightStep&&(a.nodeHeight=a.nodeHeightStep);E(!0);z();H()});d3.select("#nodeHeightHigher").on("click",function(){a.nodeHeight+=a.nodeHeightStep;E(!0);z();H()});d3.select("#resetZoom").on("click",function(){a.domainWidth=a.domainWidthStep;a.scaleX=1;a.scaleY=1;a.translateX=0;a.translateY=0;E(!0);Y.translate([0,0]);T();z()});d3.select("#zoominY").on("click",function(){a.scaleY+=a.scaleStep;a.translateY+=M*a.scaleStep/2;a.lastScale=a.scaleStep;
requestAnimFrame(O)});d3.select("#zoomoutY").on("click",function(){a.scaleY-=a.scaleStep;a.scaleY<a.scaleStep?a.scaleY=a.scaleStep:a.translateY-=M*a.scaleStep/2;a.lastScale=-1*a.scaleStep;requestAnimFrame(O)});d3.select("#zoominX").on("click",function(){a.scaleX+=a.scaleStep;a.translateX+=F*a.scaleStep/2;a.lastScale=a.scaleStep;requestAnimFrame(O)});d3.select("#zoomoutX").on("click",function(){a.scaleX-=a.scaleStep;a.scaleX<a.scaleStep?a.scaleX=a.scaleStep:a.translateX-=F*a.scaleStep/2;a.lastScale=
-1*a.scaleStep;requestAnimFrame(O)});d3.select("#domains").on("click",function(){a.showDomains=!a.showDomains;a.showDomains?(d3.select("#domainNames").attr("disabled",null),d3.select("#domainColors").attr("disabled",null),d3.select("#domainWidthLower").attr("disabled",null),d3.select("#domainWidthHigher").attr("disabled",null),d3.select("#domainLevelLower").attr("disabled",null),d3.select("#domainLevelHigher").attr("disabled",null)):(d3.select("#domainNames").attr("disabled","disabled"),d3.select("#domainColors").attr("disabled",
"disabled"),d3.select("#domainWidthLower").attr("disabled","disabled"),d3.select("#domainWidthHigher").attr("disabled","disabled"),d3.select("#domainLevelLower").attr("disabled","disabled"),d3.select("#domainLevelHigher").attr("disabled","disabled"));p();k()});d3.select("#domainColors").on("click",function(){a.showDomainColors=!a.showDomainColors;w()});d3.select("#domainNames").on("click",function(){a.showDomainNames=!a.showDomainNames;k()});d3.select("#domainWidthLower").on("click",function(){a.domainWidth-=
a.domainWidthStep;a.domainWidth<a.domainWidthStep&&(a.domainWidth=a.domainWidthStep);G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth);D()});d3.select("#domainWidthHigher").on("click",function(){a.domainWidth+=a.domainWidthStep;G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth);D()});d3.select("#domainLevelLower").on("click",function(){a.domainLevel/=a.domainLevelStep;r()});d3.select("#domainLevelHigher").on("click",function(){a.domainLevel*=a.domainLevelStep;r()});d3.select("#graphLegend").on("click",
function(){a.showGraphLegend=!a.showGraphLegend;a.marginY=a.margin+(a.showGraphs?P:0);K();T()});d3.select("#graphs").on("click",function(){a.showGraphs=!a.showGraphs;a.showGraphs?(d3.select("#graphLegend").attr("disabled",null),d3.select("#graphWidthLower").attr("disabled",null),d3.select("#graphWidthHigher").attr("disabled",null)):(d3.select("#graphLegend").attr("disabled","disabled"),d3.select("#graphWidthLower").attr("disabled","disabled"),d3.select("#graphWidthHigher").attr("disabled","disabled"));
ha()});d3.select("#graphWidthLower").on("click",function(){a.graphWidth-=a.graphWidthStep;a.graphWidth<a.graphWidthStep&&(a.graphWidth=a.graphWidthStep);z()});d3.select("#graphWidthHigher").on("click",function(){a.graphWidth+=a.graphWidthStep;z()});d3.select("#linkSVG").on("click",function(){var a=g();saveAs(new Blob([unescape(encodeURIComponent(a))],{type:"application/svg+xml"}),"phylogram.svg")});d3.select("#linkPNG").on("click",function(){var a=g(),b=document.createElement("canvas");canvg(b,a);
b.toBlob(function(a){saveAs(a,"phylogram.png")})})}})();
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.phyloxml={};phyd3.phyloxml.cid=0;phyd3.phyloxml.parseConfidence=function(d){return{type:d.getAttribute("type"),stddev:parseFloat(d.getAttribute("stddev")),value:parseFloat(d.textContent)}};phyd3.phyloxml.parseProperty=function(d){return{ref:d.getAttribute("ref"),unit:d.getAttribute("unit"),datatype:d.getAttribute("datatype"),appliesTo:d.getAttribute("applies_to"),idRef:d.getAttribute("id_ref"),value:d.textContent}};phyd3.phyloxml.parseUri=function(d){return{desc:d.getAttribute("desc"),
type:d.getAttribute("type"),value:d.textContent}};phyd3.phyloxml.parseReference=function(d){return{doi:d.getAttribute("doi"),desc:d.getElementsByTagName("desc")[0]?d.getElementsByTagName("desc")[0].textContent:""}};phyd3.phyloxml.parseAccession=function(d){return{source:d.getAttribute("source"),comment:d.getAttribute("comment"),value:d.textContent}};phyd3.phyloxml.parseMolSeq=function(d){return{isAligned:d.getAttribute("is_aligned"),value:d.textContent}};phyd3.phyloxml.parseColor=function(d){var b=
d.getElementsByTagName("red")[0],b=b?parseInt(b.textContent):0,a=d.getElementsByTagName("greeen")[0],a=a?parseInt(a.textContent):0,e=d.getElementsByTagName("blue")[0],e=e?parseInt(e.textContent):0;d=(d=d.getElementsByTagName("alpha")[0])?parseInt(d.textContent):255;return"rgba("+b+","+a+","+e+", "+parseFloat(d/255)+")"};phyd3.phyloxml.parseDomainArchitecture=function(d){var b={sequenceLength:parseInt(d.getAttribute("length")),domains:[]};d=d.getElementsByTagName("domain");for(var a=0;a<d.length;a++){var e=
d[a];b.domains.push({confidence:parseFloat(e.getAttribute("confidence")),from:parseInt(e.getAttribute("from")),to:parseInt(e.getAttribute("to")),id:e.getAttribute("id"),name:e.textContent})}return b};phyd3.phyloxml.parseCrossReference=function(d){var b=[];d=d.getElementsByTagName("accession");for(var a=0;a<d.length;a++)b.push(phyd3.phyloxml.parseAccession(d[a]));return b};phyd3.phyloxml.parseEvents=function(d){for(var b={},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "type":b.type=
e.textContent;break;case "duplications":case "speciations":case "losses":b[e.nodeName]=parseInt(e.textContent);break;case "confidence":b.confidence=phyd3.phyloxml.parseConfidence(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseTaxonomy=function(d){for(var b={uris:[],synonyms:[]},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "id":case "code":case "authority":case "rank":b[e.nodeName]=
e.textContent;break;case "scientific_name":b.scientificName=e.textContent;break;case "common_name":b.commonName=e.textContent;break;case "synonym":b.synonyms.push(e.textContent);case "uri":b.uris.push(phyd3.phyloxml.parseUri(e));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseAnnotation=function(d){for(var b={ref:d.getAttribute("ref"),source:d.getAttribute("source"),evidence:d.getAttribute("evidence"),
type:d.getAttribute("type"),properties:[],uris:[]},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "desc":b.desc=e.textContent;break;case "confidence":b.confidence=phyd3.phyloxml.parseConfidence(e);break;case "property":b.properties.push(phyd3.phyloxml.parseProperty(e));break;case "uri":b.uris.push(phyd3.phyloxml.parseUri(e));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseSequence=
function(d){for(var b={type:d.getAttribute("type"),idSource:d.getAttribute("id_source"),idRef:d.getAttribute("id_ref"),uris:[],annotations:[]},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "symbol":case "name":case "location":b[e.nodeName]=e.textContent;break;case "gene_name":b.geneName=e.textContent;break;case "accession":b.accession=phyd3.phyloxml.parseAccession(e);break;case "cross_reference":b.crossReference=phyd3.phyloxml.parseCrossReference(e);break;case "mol_seq":b.molSeq=
phyd3.phyloxml.parseMolSeq(e);break;case "annotation":b.annotations.push(phyd3.phyloxml.parseAnnotation(e));break;case "uri":b.uris.push(phyd3.phyloxml.parseUri(e));break;case "domain_architecture":b.domainArchitecture=phyd3.phyloxml.parseDomainArchitecture(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseClade=function(d){for(var b={branchset:[],properties:[],taxonomies:[],sequences:[],
confidences:[],references:[],branchLength:parseFloat(d.getAttribute("branch_length"))},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "branch_length":b.branchLength=parseFloat(e.textContent);break;case "width":b.width=parseFloat(e.textContent);break;case "clade":b.branchset.push(phyd3.phyloxml.parseClade(e));break;case "property":b.properties.push(phyd3.phyloxml.parseProperty(e));break;case "taxonomy":b.taxonomies.push(phyd3.phyloxml.parseTaxonomy(e));break;case "reference":b.references.push(phyd3.phyloxml.parseReference(e));
break;case "confidence":b.confidences.push(phyd3.phyloxml.parseConfidence(e));break;case "sequence":b.sequences.push(phyd3.phyloxml.parseSequence(e));break;case "color":b.color=phyd3.phyloxml.parseColor(e);break;case "events":b.events=phyd3.phyloxml.parseEvents(e);break;case "id":case "name":b[e.nodeName]=e.textContent;break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}b.id||(phyd3.phyloxml.cid++,b.id="_"+phyd3.phyloxml.cid);
return b};phyd3.phyloxml.parseLegend=function(d){for(var b={show:parseInt(d.getAttribute("show")),fields:[],gradient:{}},a=d.getElementsByTagName("field"),e=0;e<a.length;e++){var g=a[e],p=g.getElementsByTagName("name")[0],p=p?p.textContent:"",k=g.getElementsByTagName("color")[0],k=k?k.textContent:"",r=g.getElementsByTagName("background")[0],r=r?r.textContent:"",w=g.getElementsByTagName("shape")[0],w=w?w.textContent:"",g=(g=g.getElementsByTagName("url")[0])?g.textContent:"";b.fields.push({name:p,color:k,
background:r,shape:w,url:g})}if(d=d.getElementsByTagName("gradient")[0])p=(p=d.getElementsByTagName("name")[0])?p.textContent:"",d=(d=d.getElementsByTagName("classes")[0])?parseInt(d.textContent):0,b.gradient={name:p,classes:d};return b};phyd3.phyloxml.parseData=function(d){var b={tag:d.getAttribute("tag"),ref:d.getAttribute("ref")},a=d.getElementsByTagName("min")[0];b.min=a?a.textContent:void 0;a=d.getElementsByTagName("max")[0];b.max=a?a.textContent:void 0;d=d.getElementsByTagName("values");for(a=
0;a<d.length;a++){var e=d[a].getAttribute("for"),g=d[a].getElementsByTagName("value");b[e]=[];for(var p=0;p<g.length;p++)b[e].push(parseFloat(g[p].textContent))}return b};phyd3.phyloxml.parseGraph=function(d){for(var b={name:"",legend:{},data:{},type:d.getAttribute("type")},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "name":b.name=e.textContent;break;case "legend":b.legend=phyd3.phyloxml.parseLegend(e);break;case "data":b.data=phyd3.phyloxml.parseData(e);break;case "#text":case "#comment":break;
default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseLabel=function(d){for(var b={name:"",data:{},type:d.getAttribute("type")},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "name":b.name=e.textContent;break;case "data":b.data=phyd3.phyloxml.parseData(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parse=
function(d){var b={branchset:[],properties:[],confidence:[]},a=d.getElementsByTagName("phylogeny"),a=a[0];b.rooted=a.getAttribute("rooted");b.rerootable=a.getAttribute("rerootable");b.branch_length_unit=a.getAttribute("branch_length_unit");b.type=a.getAttribute("type");if(a&&a.childNodes)for(var e=0;e<a.childNodes.length;e++){var g=a.childNodes[e];switch(g.nodeName){case "clade":b.branchset.push(phyd3.phyloxml.parseClade(g));break;case "confidence":b.confidence.push(phyd3.phyloxml.parseConfidence(g));
break;case "date":b.date=g.textContent;break;case "description":b.description=g.textContent;break;case "id":b.id=g.textContent;break;case "name":b.name=g.textContent;break;case "property":b.properties.push(phyd3.phyloxml.parseProperty(g));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+g.nodeName+" "+g.textContent+" - skipping...")}}var a=d.getElementsByTagName("taxonomies"),a=a[0],p={};if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++){var k=a.childNodes[e];if("color"==
k.nodeName){var g=k.getElementsByTagName("code")[0].textContent,r=k.getElementsByTagName("value")[0].textContent;p[g]={color:r}}if("taxonomy"==k.nodeName){var g=k.getAttribute("code"),r=(r=k.getElementsByTagName("color")[0])?r.textContent:r,w=k.getElementsByTagName("name")[0],w=w?w.textContent:w,k=(k=k.getElementsByTagName("url")[0])?k.textContent:k;p[g]={color:r,name:w,url:k}}}b.taxcolors=p;a=d.getElementsByTagName("domains");a=a[0];p={};if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)k=a.childNodes[e],
"color"==k.nodeName&&(g=k.getElementsByTagName("code")[0].textContent,r=k.getElementsByTagName("value")[0].textContent,p[g]={color:r}),"domain"==k.nodeName&&(g=k.getAttribute("name"),r=(r=k.getElementsByTagName("color")[0])?r.textContent:r,w=(w=k.getElementsByTagName("description")[0])?w.textContent:w,k=(k=k.getElementsByTagName("url")[0])?k.textContent:k,p[g]={color:r,description:w,url:k});b.domcolors=p;a=d.getElementsByTagName("graphs");a=a[0];g=[];if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)r=
a.childNodes[e],"graph"==r.nodeName&&g.push(phyd3.phyloxml.parseGraph(r));b.graphs=g;a=d.getElementsByTagName("labels");a=a[0];d=[];if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)g=a.childNodes[e],"label"==g.nodeName&&d.push(phyd3.phyloxml.parseLabel(g));b.labels=d;return b}})();
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.newick={};phyd3.newick.parse=function(d){var b=[],a={};d=d.split(/\s*(;|\(|\)|,|:)\s*/);for(var e=0,g=0;g<d.length;g++){var p=d[g];switch(p){case "(":p={};a.id=e;e++;a.branchset=[p];b.push(a);a=p;break;case ",":p={};b[b.length-1].branchset.push(p);a=p;break;case ")":a=b.pop();break;case ":":break;default:var k=d[g-1];")"==k||"("==k||","==k?a.name=p:":"==k&&(a.branchLength=parseFloat(p));a.id=e;e++}}return a}})();
if(!d3)throw"d3 wasn't included!";window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(d){window.setTimeout(d,1E3/60)}}();
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.phylogram={};phyd3.phylogram.options={};phyd3.phylogram.intenals={};phyd3.phylogram.domains={};phyd3.phylogram.graphs={};phyd3.phylogram.dx=0;phyd3.phylogram.lineAreas=[];phyd3.phylogram.labelAreas=[];phyd3.phylogram.projection=function(d){return[parseInt(d.y),parseInt(d.x)]};phyd3.phylogram.rightAngleDiagonal=function(d,b){b=d.source;d=d.target;b=[b,{x:d.x,y:b.y},d];b=b.map(phyd3.phylogram.projection);phyd3.phylogram.lineAreas.push({start:b[1],
end:b[2]});!d.children&&b[2][0]>phyd3.phylogram.dx&&(phyd3.phylogram.dx=b[2][0]);return"M"+b[0]+" "+b[1]+" "+b[2]};phyd3.phylogram.scaleBranchLengths=function(d,b){function a(b,d){d(b);if(b.children)for(var e=b.children.length-1;0<=e;e--)a(b.children[e],d)}a(d[0],function(a){a.rootDist=(a.parent?a.parent.rootDist:0)+(a.branchLength||0)});var e=d.map(function(a){return a.rootDist}),g=d3.scale.linear().domain([0,d3.max(e)]).range([0,b]);a(d[0],function(a){a.y=parseInt(g(a.rootDist))});return g};phyd3.phylogram.randomColor=
function(){function d(a,b,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(b-a)*d:.5>d?b:d<2/3?a+(b-a)*(2/3-d)*6:a}var b=Math.random();return function(a,b,g){if(0==b)g=b=a=g;else{var e=.5>g?g*(1+b):g+b-g*b,k=2*g-e;g=d(k,e,a+1/3);b=d(k,e,a);a=d(k,e,a-1/3)}return"#"+Math.round(255*g).toString(16)+Math.round(255*b).toString(16)+Math.round(255*a).toString(16)}((b+.618033988749895)%1,.5,.6)};phyd3.phylogram.scaledomainWidths=function(d,b){d=d.map(function(a){return a.sequences&&a.sequences[0]&&a.sequences[0].domainArchitecture&&
a.sequences[0].domainArchitecture.sequenceLength?a.sequences[0].domainArchitecture.sequenceLength:0});return d3.scale.linear().domain([0,d3.max(d)]).range([0,b])};phyd3.phylogram.build=function(d,b,a){function e(){return a.invertColors?a.backgroundColor:a.foregroundColor}function g(){var b=d.replace("#",""),b=document.getElementById(b).querySelector("svg"),e=b.getElementById("main"),f=e.getBBox(),e=e.getAttributeNode("transform"),g=b.getAttributeNode("width"),n=b.getAttributeNode("height"),h=e.value,
l=g.value,k=n.value;e.value="translate("+a.marginX+", "+a.marginY+")";g.value=f.width+a.marginX;n.value=f.height+a.marginY;if("undefined"!=typeof window.XMLSerializer)var x=(new XMLSerializer).serializeToString(b);else"undefined"!=typeof b.xml&&(x=b.xml);e.value=h;g.value=l;n.value=k;return x}function p(){a.showDomains?(G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth),u.append("svg:path").attr("class","domain").attr("stroke",e()).attr("visibility",function(a,b){return a.show?"visibile":"hidden"}),
C=C.data(function(a,b,d){a=a.sequences&&a.sequences[0]&&a.sequences[0].domainArchitecture?a.sequences[0].domainArchitecture.domains:[];for(d=0;d<a.length;d++)a[d].i=b;a.sort(function(a,b){return Math.abs(b.to-b.from)-Math.abs(a.to-a.from)});return a}).enter().append("svg:g").attr("class","domain"),C.append("svg:rect").attr("class","domain hover-visible").attr("stroke",a.foregroundColor).attr("stroke-width",a.outline+"px").append("title").text(function(a){return a.name}),r(),D(),w()):(C.remove(),u.selectAll("path.domain").remove(),
C=u.selectAll("g.domain"))}function k(){a.showDomainNames?(C.append("svg:text").attr("class","domain").attr("dy",-3).attr("fill",e()).attr("font-size","10px").text(function(a){return a.name}),D()):C.selectAll("text.domain").remove()}function r(){var b=u.data();u.selectAll("g.domain").attr("visibility",function(d,f,e){return b[e].show&&d.confidence<=a.domainLevel?"visible":"hidden"});u.selectAll("path.domain").attr("visibility",function(a){return a.show?"visible":"hidden"});d3.select("#domainLevel").attr("value",
a.domainLevel.toPrecision(1))}function w(){C.selectAll("rect.domain").attr("fill",function(d){return a.showDomainColors&&b.domcolors[d.name]?b.domcolors[d.name].color.replace(/0x/,"#"):e()})}function D(){var b=u.data(),d=I+(a.showLabels?J:0)+(a.showGraphs?v:0);G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth);u.selectAll("path.domain").attr("d",function(f,e,m){e=a.lineupNodes?phyd3.phylogram.dx-b[m].y:0;f=f.sequences&&f.sequences[0]&&f.sequences[0].domainArchitecture?f.sequences[0].domainArchitecture.sequenceLength:
0;return"M"+parseInt(d+e)+",0L"+parseInt(d+e+G(f))+",0"});C.selectAll("rect.domain").attr("width",function(a){return parseInt(G(a.to-a.from))}).attr("transform",function(f,e,m){return"translate("+parseInt(d+(a.lineupNodes?phyd3.phylogram.dx-b[f.i].y:0)+G(f.from))+","+parseInt(-1*a.nodeHeight)+")"}).attr("height",2*a.nodeHeight-2);C.selectAll("text.domain").attr("transform",function(f){return"translate("+parseInt(d+(a.lineupNodes?phyd3.phylogram.dx-b[f.i].y:0)+G(f.from))+","+parseInt(-1*a.nodeHeight)+
")"});d3.select("#domainWidth").attr("value",a.domainWidth)}function aa(){a.showSupportValues?(q.selectAll("g.inner.node").append("svg:text").attr("class","supportValue").attr("dx",-2).attr("text-anchor","end").attr("fill",a.supportValuesColor).text(function(a){var b="";if(a.confidences)for(var d in a.confidences)b+=parseFloat(a.confidences[d].value)+" ";return b}),z()):q.selectAll("text.supportValue").remove()}function ba(){a.showLengthValues?(q.selectAll("g.node").append("svg:text").attr("class",
"branchLength").attr("dx",-2).attr("text-anchor","end").attr("fill",a.branchLengthColor).text(function(a){return a.branchLength?parseFloat(a.branchLength).toFixed(5):""}),z()):q.selectAll("text.branchLength").remove()}function V(a,b,d){var f=a.attr("id")+"_"+a.selectAll("div.panel-default").size(),e=a.append("div").attr("class","panel panel-default");e.append("div").attr("class","panel-heading").attr("role","tab").attr("id","heading"+f).append("h4").attr("class","panel-title").append("a").attr("class",
"collapsed").attr("aria-expanded",d?"true":"false").attr("role","button").attr("data-toggle","collapse").attr("data-parent","#"+a.attr("id")).attr("href","#collapse"+f).attr("aria-controls","collapse"+f).html(b);return e.append("div").attr("id","collapse"+f).attr("class","panel-collapse collapse "+(d?"in":"")).attr("role","tabpanel").attr("aria-labelledby","heading"+f).append("div").attr("class","panel-body table-responsive")}function ka(e){var m=d3.event;if(!m.defaultPrevented){var f=m.layerX;y=
m.layerY;var g="popup"+parseInt(Date.now()*Math.random()*1E3),f=d3.select(d).append("div").attr("class","popup").attr("id",g).style("position","absolute").style("top",parseInt(y)+"px").style("left",parseInt(f)+"px").style("width",parseInt(a.popupWidth)+"px").style("color",a.foregroundColor).style("background-color",a.backgroundColor),n=f.append("button").attr("class","btn btn-link").style("position","absolute").style("right","8px");n.append("span").attr("class","glyphicon glyphicon-remove").attr("aria-hidden",
"true");n.on("click",function(){d3.select("#"+g).remove();q.selectAll("g.node.cid_"+e.id).selectAll("rect.pointer").style("opacity","0")});f=f.append("div").attr("class","panel-group").attr("id","accordion_"+parseInt(Date.now()*Math.random()*1E3)).attr("role","tablist").attr("aria-multiselectable","true");n="text"==m.target.nodeName||m.target.classList.contains("pointer")?!0:!1;n=V(f,"Node",n).append("table").attr("class","table table-condensed table-bordered").append("tbody");if(e.name){var h=n.append("tr");
h.append("td").text("Name");h.append("td").text(e.name)}if(e.taxonomies)for(var l in e.taxonomies){var k=e.taxonomies[l],h=n.append("tr");h.append("td").text("Taxononomy");h=h.append("td");b.taxcolors[k.code]&&b.taxcolors[k.code].url&&(h=h.append("a").attr("href",b.taxcolors[k.code].url));var x="",x=x+(b.taxcolors[k.code]&&b.taxcolors[k.code].name?b.taxcolors[k.code].name+" ":""),x=x+" ",x=x+(k.scientificName?"\x3ci\x3e"+k.scientificName+"\x3c/i\x3e":""),x=x+" ",x=x+(k.commonName?k.commonName:""),
x=x+" ",x=x+(k.code?"("+k.code+")":"");h.html(x)}if(e.confidences)for(var p in e.confidences)h=n.append("tr"),h.append("td").text("Confidence"),h.append("td").html(e.confidences[p].value);h=n.append("tr");h.append("td").text("Depth");h.append("td").text(e.depth);h=n.append("tr");h.append("td").text("Branch length");h.append("td").text(e.branchLength?e.branchLength:0);h=n.append("tr");h.append("td").text("Distance from root");h.append("td").text(e.rootDist);for(var r in e.properties)h=e.properties[r],
u=h.ref,l=h.value,l=l.trim(),/^http:\/\//.test(l)&&(l="\x3ca href\x3d'"+l+"' target\x3d'_blank'\x3e"+l+"\x3c/a\x3e\x3cbr /\x3e"),h=n.append("tr"),h.append("td").text(u),h.append("td").html(l);for(var u in e.events)l=e.events[u],h=n.append("tr"),h.append("td").text(u),h.append("td").html(l);if(e.sequences)for(var v in e.sequences)if(e.sequences[v].domainArchitecture&&e.sequences[v].domainArchitecture.domains){n=m.target.parentNode.classList.contains("domain")?!0:!1;n=V(f,"Domains",n).append("table").attr("id",
"dt"+g).attr("class","table table-condensed table-bordered");u=n.append("thead").append("tr");u.append("th").text("#");u.append("th").text("Name");u.append("th").text("Description");u.append("th").text("From");u.append("th").text("To");u.append("th").text("P value");n=n.append("tbody");for(r=0;r<e.sequences[v].domainArchitecture.domains.length;r++)l=e.sequences[v].domainArchitecture.domains[r],h=n.append("tr"),h.append("td").style("background",b.domcolors[l.name]&&b.domcolors[l.name].color?b.domcolors[l.name].color.replace("0x",
"#"):"").text(" "),u=h.append("td"),b.domcolors[l.name]&&b.domcolors[l.name].url&&(u=u.append("a").attr("href",b.domcolors[l.name].url)),u.text(l.name),h.append("td").text(b.domcolors[l.name]?b.domcolors[l.name].description:""),h.append("td").text(l.from),h.append("td").text(l.to),h.append("td").text(l.confidence);$("#dt"+g).dataTable({searching:!1,paging:!1,language:{info:""},order:[[3,"asc"]],columns:[{orderable:!1},null,null,null,null,null]})}if(b.graphs)for(v=0;v<b.graphs.length;v++)if(l=b.graphs[v],
l.data&&l.data[e.id]&&l.data[e.id].length)for(n=m.target.parentNode.classList.contains(l.type)?!0:!1,n=V(f,l.name,n).append("table").attr("class","table table-condensed table-bordered").append("tbody"),r=0;r<l.legend.fields.length;r++)h=n.append("tr"),u=h.append("td"),l.legend.fields[r].url&&(u=u.append("a").attr("href",l.legend.fields[r].url)),u.text(l.legend.fields[r].name),h.append("td").text(l.data[e.id][r]);q.selectAll("g.node.cid_"+e.id).selectAll("rect.pointer").style("opacity","1");m.stopPropagation()}}
function ca(){a.lineupNodes?q.selectAll("g.leaf").append("path").attr("class","support").attr("stroke",e()).attr("stroke-dasharray","2,3").attr("stroke-width","0.5px"):q.selectAll("path.support").remove()}function Q(d){if(d.children&&"only leaf"==a.showNodesType||!d.children&&"only inner"==a.showNodesType)return"";var e="";if(a.showTaxonomy&&d.taxonomies)for(var f in d.taxonomies){var m=d.taxonomies[f];a.showFullTaxonomy&&(e+=b.taxcolors[m.code]&&b.taxcolors[m.code].name?b.taxcolors[m.code].name:
"",e+=" ",e+=m.scientificName?m.scientificName:"",e+=" ",e+=m.commonName?m.commonName:"",e+=" ");e+=m.code?m.code:"";e+=" "}e+=(a.showNodeNames&&d.name?d.name:"")+" ";if(a.showSequences&&d.sequences)for(var g in d.sequences)if(f=d.sequences[g],e+=f.symbol?f.symbol:"",e+=" ",e+=f.accession?f.accession.value:"",e+=" ",e+=f.name?f.name:"",e+=" ",e+=f.geneName?f.geneName:"",e+=" ",f.annotations)for(var h in f.annotations)e+=f.annotations[h].desc?f.annotations[h].desc:"",e+=" ";return e}function R(){var b=
0;u.selectAll("text.name").text(function(a){a=Q(a);a.length>b&&(b=a.length);return a});q.selectAll("g.node.inner").selectAll("text.name").text(Q);a.showGraphs&&K();a.showDomains&&D()}function H(){u.selectAll("text.name").attr("visibility",function(a){return a.show?"visible":"hidden"});a.lineupNodes&&u.selectAll("path.support").attr("visibility",function(a){return a.show?"visible":"hidden"});a.showLabels&&da();a.showGraphs&&ea();a.showDomains&&r()}function W(){q.selectAll("text.name").attr("stroke",
e()).attr("stroke-width",a.outline+"px").attr("fill",function(d){var m=null;if(a.showTaxonomyColors&&b.taxcolors&&d.taxonomies)for(var f in d.taxonomies){var g=d.taxonomies[f];b.taxcolors[g.code]&&b.taxcolors[g.code].color&&(m=b.taxcolors[g.code].color.replace(/0x/,"#"))}return m?m:e()})}function fa(){u.selectAll("text.name").attr("dx",function(b){return parseInt(a.lineupNodes?phyd3.phylogram.dx-b.y+5:5)});u.selectAll("path.support").attr("d",function(a){return"M0,0 L"+parseInt(phyd3.phylogram.dx-
a.y)+",0"});a.showLabels&&X();a.showGraphs&&K();a.showDomains&&D()}function z(){q.selectAll("text.name").attr("dy",a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");q.selectAll("text.branchLength").attr("dy",-a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");q.selectAll("text.supportValue").attr("dy",a.nodeHeight/2+5).attr("font-size",1.5*a.nodeHeight+"px");I=100*a.nodeHeight/6+10;d3.select("#nodeHeight").attr("value",a.nodeHeight);fa();a.showLabels&&X();a.showGraphs&&K();a.showDomains&&
D()}function ga(){if(a.showLabels&&b.labels){for(var d=0;d<b.labels.length;d++){var t=b.labels[d];t.id||(t.id=parseInt(Date.now()*Math.random()*1E3));t.data.tag&&q.selectAll("g.node").each(function(a){var b=a[t.data.tag],d=t.data.ref,d=d?d:"value",b="object"==typeof b?b[d]:b;if("property"==t.data.tag)for(pid in a.properties){var f=a.properties[pid];if(f.ref==d){b=f.value;break}}b&&(t.data[a.id]=b)});switch(t.type){case "text":for(cid in t.data)t.data[cid]&&parseInt(cid)&&q.selectAll(".cid_"+cid).append("text").attr("class",
"nodelabel text lid"+t.id).attr("dy",3).attr("text-anchor","start").attr("stroke-width","0.3px").attr("stroke",e()).attr("fill",e()).attr("font-size",1.5*a.nodeHeight+"px").attr("visibility","visible").text(t.data[cid]).append("title").text(t.name+": "+t.data[cid]);break;case "color":for(cid in t.data)if(t.data[cid]&&parseInt(cid)){var f=a.nodeHeight,g=t.data[cid].replace(/0x/,"#");q.selectAll(".cid_"+cid).append("rect").attr("height",2*f).attr("width",2*f).attr("class","nodelabel color lid"+t.id).attr("style",
"fill: "+g+"; stroke: "+g).append("title").text(t.name)}}}da();X()}else q.selectAll(".nodelabel").remove(),J=0;K();D()}function X(){var d=a.nodeHeight;J=0;if(b.labels){for(var e=0;e<b.labels.length;e++){var f=b.labels[e],g=0;u.selectAll(".nodelabel.lid"+f.id).attr("transform",function(b){var e=0,m=0;"color"==f.type&&(e=m=-d);var t=0;"text"==this.nodeName&&this.firstChild?t=this.firstChild.length*d/1.5:"rect"==this.nodeName&&(t=2*d);t>g&&(g=t);return"translate("+parseInt(e+d+J+(a.lineupNodes?phyd3.phylogram.dx-
b.y+I:I))+","+m+")"});J+=g+2*d}e=u.selectAll(".nodelabel");e.selectAll("text").attr("dy",a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");e.selectAll("rect").attr("width",2*a.nodeHeight).attr("height",2*a.nodeHeight)}}function da(){u.selectAll(".nodelabel").attr("visibility",function(a){return a.show?"visible":"hidden"})}function ha(){if(a.showGraphs&&b.graphs&&b.graphs.length){d3.svg.arc().innerRadius(0).outerRadius(a.nodeHeight);for(var d=d3.layout.pie().value(function(a){return a.value}).sort(null),
t=v=0;t<b.graphs.length;t++){var f=b.graphs[t];f.id||(f.id=parseInt(Date.now()*Math.random()*1E3));if(f.data.tag)var g=q.selectAll("g.node").each(function(a){var b=a[f.data.tag],d=f.data.ref,d=d?d:"value",b="object"==typeof b?b[d]:b;if("property"==f.data.tag)for(pid in a.properties){var e=a.properties[pid];if(e.ref==d){b=e.value;break}}b&&(f.data[a.id]=[],f.data[a.id][0]=b,"pie"==f.type&&f.data.max&&(f.data[a.id][1]=f.data.max-b,f.legend.fields[1]={name:f.legend.fields[0].name,color:f.legend.fields[0].background?
f.legend.fields[0].background:phyd3.phylogram.randomColor(),invert:!0}))});switch(f.type){case "pie":for(cid in f.data)if(f.data[cid]&&Array.isArray(f.data[cid])){var n=!1;q.select(".cid_"+cid).each(function(a){0==a.branchset.length&&(n=!0)});for(var g=q.selectAll(".cid_"+cid).append("svg:g").attr("class","graph pie gid"+f.id),h=[],l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,value:f.data[cid][l],leaf:n});g.selectAll("path.pie.gid"+f.id).data(d(h)).enter().append("path").attr("class",
"pie hover-visible gid"+f.id).attr("stroke",e()).attr("stroke-width",a.outline+"px").attr("fill",function(a,b){return f.legend.fields?(f.legend.fields[b]||(f.legend.fields[b]={},f.legend.fields[b].name="Series "+(b+1),f.legend.fields[b].color=phyd3.phylogram.randomColor()),f.legend.fields[b].color.replace(/0x/,"#")):""}).append("title").text(function(a,b){return f.legend.fields?(f.legend.fields[b]&&f.legend.fields[b].name?f.legend.fields[b].name+": ":"")+(f.legend.fields[b].invert?f.data.max-a.data.value:
a.data.value):""})}break;case "binary":for(cid in f.data)if(f.data[cid]&&Array.isArray(f.data[cid])){h=[];n=!1;q.select(".cid_"+cid).each(function(a){0==a.branchset.length&&(n=!0)});g=q.selectAll(".cid_"+cid).append("svg:g").attr("class","graph binary gid"+f.id);for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,value:f.data[cid][l],shape:f.legend.fields[l]?f.legend.fields[l].shape:"",leaf:n});g.selectAll("path.binary.gid"+f.id).data(h).enter().append("path").attr("class","binary hover-visible gid"+
f.id).attr("style",function(a,b){b=(f.legend.fields[b]?f.legend.fields[b].color:"").replace(/0x/,"#");return"fill:"+(1<=a.value?b:"none")+";stroke:"+(0<=a.value?b:"none")}).append("title").text(function(a,b){return(f.legend.fields[b]?f.legend.fields[b].name+": ":"")+a.value})}break;case "multibar":L[f.id]=[];for(l=0;l<f.legend.fields.length;l++)g=d3.max(d3.values(f.data),function(a){if(a)return a[l]}),L[f.id][l]=d3.scale.linear().domain([0,g]);for(cid in f.data)if(f.data[cid]){g=q.select(".cid_"+
cid).append("svg:g").attr("class","graph multibar gid"+f.id);h=[];for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,value:f.data[cid][l]});g.selectAll("rect.multibar.gid"+f.id).data(h).enter().append("rect").attr("class","multibar hover-visible gid"+f.id).attr("fill",function(a,b){return(f.legend.fields[b]?f.legend.fields[b].color:"").replace(/0x/,"#")}).attr("stroke",a.foregroundColor).attr("stroke-width",a.outline).append("title").text(function(a,b){return(f.legend.fields[b]?
f.legend.fields[b].name+": ":"")+a.value})}break;case "heatmap":var g=d3.max(d3.values(f.data),function(a){if(a)return d3.max(a)}),h=d3.min(d3.values(f.data),function(a){if(a)return d3.min(a)}),k=d3.scale.quantize().domain([h,g]).range(colorbrewer[f.legend.gradient.name][f.legend.gradient.classes]);for(cid in f.data)if(f.data[cid]){g=q.select(".cid_"+cid).append("svg:g").attr("class","graph heatmap gid"+f.id);h=[];if(f.data[cid])for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,
value:f.data[cid][l]});g.selectAll("rect.heatmap.gid"+f.id).data(h).enter().append("rect").attr("class","heatmap hover-visible gid"+f.id).attr("fill",function(a,b){return k(a.value)}).attr("stroke",a.foregroundColor).attr("stroke-width",a.outline+"px").append("title").text(function(a,b){return(f.legend.fields[b]?f.legend.fields[b].name+": ":"")+a.value})}break;default:console.log("Graph not supported "+f.type)}}ea();K()}else v=0,q.selectAll("g.graph").remove(),q.selectAll("text.legend").remove();
D()}function K(){var d=a.nodeHeight,t=I+J,f=u.selectAll("g.graph").attr("transform",function(b){return"translate("+(a.lineupNodes?phyd3.phylogram.dx-b.y+t:t)+",0)"});d3.select("#graphWidth").attr("value",a.graphWidth);q.selectAll("text.legend").remove();v=0;if(b.graphs){for(var g=0;g<b.graphs.length;g++){var n=b.graphs[g];switch(n.type){case "pie":f.selectAll("path.pie.gid"+n.id).attr("d",function(a){return d3.svg.arc().innerRadius(0).outerRadius(d)(a)}).attr("transform",function(a){return" translate("+
parseInt(a.data.leaf?d+v:0)+",0)"});a.showGraphLegend&&q.append("text").attr("class","legend").text(0!=n.legend.show?n.name:"").attr("transform","translate("+parseInt(phyd3.phylogram.dx+t+v+2*d)+",-10) rotate(-90)");v+=2*d+5;break;case "binary":f.selectAll("path.binary.gid"+n.id).attr("d",function(a){var b=d3.svg.symbol().size(4*(d-2)*(d-2));b.type(n.legend.fields[a.i].shape);return b(a)}).attr("transform",function(a){return" translate("+(a.leaf?v+10+a.i*(2*d+5):0)+" ,0)"});if(a.showGraphLegend)for(var h=
0;h<n.legend.fields.length;h++)q.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[h].name:"").attr("transform","translate("+(phyd3.phylogram.dx+t+v+h*(2*d+5)+2*d)+", -10) rotate(-90)");v+=(n.legend.fields.length+1)*(2*d+5)+5;break;case "multibar":for(h=0;h<n.legend.fields.length;h++)L[n.id][h]=L[n.id][h].range([0,a.graphWidth]);f.selectAll("rect.multibar.gid"+n.id).attr("height",parseInt(2*d)).attr("width",function(a,b){return parseInt(L[n.id][a.i]?L[n.id][a.i](a.value):
0)}).attr("transform",function(b,f){return" translate("+parseInt(v+b.i*(a.graphWidth+5))+",-"+parseInt(d)+")"});if(a.showGraphLegend)for(h=0;h<n.legend.fields.length;h++)q.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[h].name:"").attr("transform","translate("+(phyd3.phylogram.dx+t+v+h*(a.graphWidth+5)+a.graphWidth/2)+",-10) rotate(-90)");v+=n.legend.fields.length*(a.graphWidth+5);break;case "heatmap":f.selectAll("rect.heatmap.gid"+n.id).attr("width",2*d).attr("height",
2*d).attr("transform",function(a,b){return" translate("+(v+2*a.i*d)+",-"+d+")"});if(a.showGraphLegend)for(h=0;h<n.legend.fields.length;h++)q.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[h].name:"").attr("transform","translate("+parseInt(phyd3.phylogram.dx+t+v+(h+1)*d*2)+",-10) rotate(-90)");v+=2*n.legend.fields.length*d+5}}q.selectAll("text.legend").attr("fill",e()).attr("font-size",2*a.nodeHeight)}}function la(){var d=a.nodeHeight;v=0;if(b.graphs)for(var e=0;e<b.graphs.length;e++){var f=
b.graphs[e];switch(f.type){case "pie":v+=2*d+5;break;case "binary":v+=(f.legend.fields.length+1)*(2*d+5)+5;break;case "multibar":v+=f.legend.fields.length*(a.graphWidth+5);break;case "heatmap":v+=2*f.legend.fields.length*d+5}}return 2*a.margin+(a.showNodeNames?I:0)+(a.showGraphs?v:0)+(a.showDomains?a.domainWidth:0)}function ea(){var b=[],d=function(d){if(!a.dynamicHide)return"visible";for(var f=!0,e=a.nodeHeight,m=d.x,t=d.y,g=0;g<b.length;g++){var k=b[g].x,p=b[g].y;if((k-m)*(k-m)+(p-t)*(p-t)<=4*e*
e){f=!1;break}}return f?(b.push(d),"visible"):"hidden"};u.selectAll("g.graph").attr("visibility",function(a){return a.show?"visible":"hidden"});q.selectAll("g.inner").selectAll(".graph.pie").attr("visibility",d);q.selectAll("g.inner").selectAll(".graph.binary").attr("visibility",d)}function E(d){phyd3.phylogram.lineAreas=[];phyd3.phylogram.dx=0;var m=d3.layout.cluster().separation(function(a,b){return 1}).children(a.children||function(a){return a.branchset}).size([M*a.scaleY,F*a.scaleX]);B=m(b);a.showPhylogram||
phyd3.phylogram.scaleBranchLengths(B,F*a.scaleX);var f=q.selectAll("path.link");d||(f=f.data(m.links(B)),f.enter().append("svg:path").attr("class","link").attr("fill","none").attr("stroke",e()));f.attr("d",phyd3.phylogram.rightAngleDiagonal);N=void 0;c=0;f=B.filter(function(a){return!a.children});for(m=0;m<f.length;m++)f[m].show=a.dynamicHide?ia(f[m],!a.lineupNodes):!0;N=void 0;f=B.filter(function(a){return a.children});for(m=0;m<f.length;m++)0<Q(f[m]).trim().length?f[m].show=a.dynamicHide?ia(f[m],
!0):!0:f[m].show=!1;d||(S=S.data(B),S.enter().append("svg:g").attr("class",function(a){return a.children?0==a.depth?"root node cid_"+a.id:"inner node cid_"+a.id:"leaf node cid_"+a.id}).style("cursor","pointer").on("click",void 0===a.popupAction?ka:a.popupAction).append("rect").attr("class","pointer").attr("fill","red").attr("width",2*a.nodeHeight+2+"px").attr("height",2*a.nodeHeight+2+"px").style("opacity","0").attr("x","-"+(a.nodeHeight+1)+"px").attr("y","-"+(a.nodeHeight+1)+"px"));S.attr("transform",
function(a){return"translate("+parseInt(a.y)+","+parseInt(a.x)+")"});phyd3.phylogram.lineAreas=[]}function O(){E(!0);T()}function ia(b,d){var f=!0,e=b.y+1,m=b.y+5.5*Q(b).length,g=b.x-a.nodeHeight,l=b.x+a.nodeHeight;if(!N)return N=b,!0;a.lineupNodes&&!b.children&&(e+=phyd3.phylogram.dx-b.y,m+=phyd3.phylogram.dx-b.y);var t=N,k=t.y+1,p=t.y+5.5*Q(t).length,q=t.x-a.nodeHeight,r=t.x+a.nodeHeight;a.lineupNodes&&!t.children&&(k+=phyd3.phylogram.dx-t.y,p+=phyd3.phylogram.dx-t.y);if(k<=e&&e<=p&&q<=g&&g<=r||
k<=m&&m<=p&&q<=g&&g<=r||k<=e&&e<=p&&q<=l&&l<=r||k<=m&&m<=p&&q<=l&&l<=r)f=!1;if(f&&d)for(d=0;d<phyd3.phylogram.lineAreas.length;d++)if(q=phyd3.phylogram.lineAreas[d],t=q.start[0],k=q.end[0],p=q.start[1],q=q.end[1],p==q){if(g<=p&&q<=l&&!(t>m||k<e)){f=!1;break}}else if(t==k&&e<=t&&k<=m&&!(p>l||q<g)){f=!1;break}f&&(N=b);return f}function T(){var b=Y.translate(),d=b[0]+a.marginX-a.translateX,f=b[1]+a.marginY-a.translateY;q.attr("transform",function(a){return"translate("+parseInt(d)+","+parseInt(f)+") scale(1)"});
0!=a.lastScale&&(fa(),a.dynamicHide&&H())}a=a||{};a.scaleY=a.scaleY||1;a.scaleX=a.scaleX||1;a.translateX=a.translateX||0;a.translateY=a.translateY||0;a.height=a.height||800;a.margin=a.margin||20;a.scaleStep=a.scaleStep||.3;a.nodeHeight=a.nodeHeight||6;a.nodeHeightStep=a.nodeHeightStep||1;a.textLength=a.textLength||100;a.domainWidth=a.domainWidth||100;a.domainWidthStep=a.domainWidthStep||100;a.graphWidth=a.graphWidth||20;a.graphWidthStep=a.graphWidthStep||10;a.foregroundColor=a.foregroundColor||"#000";
a.backgroundColor=a.backgroundColor||"#fff";a.domainLevel=a.domainLevel||1;a.domainLevelStep=a.domainLevelStep||10;a.outline=a.outline||.3;a.branchLengthColor=a.branchLengthColor||"red";a.supportValuesColor=a.supportValuesColor||"blue";a.popupWidth=a.popupWidth||500;a.showNodesType=a.showNodesType||"only leaf";a.showFullTaxonomy=a.showFullTaxonomy||!1;a.showLabels=a.showLabels||!0;a.treeWidth=a.treeWidth||"auto";var B,G,N,L=[],J=100,I=100,v=0,P=100,ja=!1;if(b.graphs)for(var Z=0;Z<b.graphs.length;Z++)if(0!=
b.graphs[Z].legend.show){ja=!0;break}P=ja?P:0;a.marginX=a.margin;a.marginY=a.margin+(a.showGraphs?P:0);var U=$(d).width(),F="auto"==a.treeWidth?U-la():a.treeWidth,M=a.height-(2*a.margin+(a.showGraphs?P:0)),F=parseInt(F),M=parseInt(M);0>F&&(F=U-2*I-(a.showGraphs?2*P:0));var Y=d3.behavior.zoom().scaleExtent([1,1]).on("zoom",function(b){b=0;var d=d3.event.sourceEvent;if(d){if(0<d.deltaY||0>d.wheelDelta)b=-1*a.scaleStep;if(0>d.deltaY||0<d.wheelDelta)b=a.scaleStep;var f=.5,e=.5;d.altKey||d.ctrlKey||(f=
d.layerX/U,e=d.layerY/a.height);if(d.ctrlKey||!d.altKey)a.scaleY+=b,a.scaleY<a.scaleStep?a.scaleY=a.scaleStep:a.translateY+=M*b*e;if(d.altKey||!d.ctrlKey)a.graphWidth+=0==b?0:0>b?-10:10,10>a.graphWidth&&(a.graphWidth=10),a.domainWidth+=0==b?0:0>b?-1*a.domainWidthStep:a.domainWidthStep,a.domainWidth<a.domainWidthStep&&(a.domainWidth=a.domainWidthStep),a.scaleX+=b,a.scaleX<a.scaleStep?a.scaleX=a.scaleStep:a.translateX+=F*b*f;a.lastScale=b;0!=a.lastScale?requestAnimFrame(O):requestAnimFrame(T)}});d3.select(d).select("svg").remove();
var q=d3.select(d).insert("svg").attr("width",U+"px").attr("height",a.height+"px").attr("overflow","hidden").attr("version","1.1").attr("font-family","Open Sans").attr("xmlns","http://www.w3.org/2000/svg").call(Y);q.append("svg:rect").attr("class","canvas").attr("width","100%").attr("height","100%").attr("fill",a.invertColors?a.foregroundColor:a.backgroundColor);q.append("svg:text").attr("dy","20px").attr("stroke",e()).attr("stroke-width","1px").attr("font-size","15px").text(b.name?b.name:"");q.append("svg:text").attr("dy",
"40px").attr("stroke",e()).attr("stroke-width","0.5px").attr("font-size","10px").text(b.description?b.description:"");var q=q.append("svg:g").attr("id","main").attr("transform","translate("+a.marginX+", "+a.marginY+")"),S=q.selectAll("g.node");E();0==phyd3.phylogram.dx&&(d3.select("#phylogram").attr("checked","").attr("disabled","disabled"),a.showPhylogram=!0,E());var u=q.selectAll("g.leaf.node"),C=u.selectAll("g.domain");aa();ba();p();k();ha();ca();ga();S.append("svg:text").attr("class","name").attr("dx",
a.nodeHeight+1).attr("dy",3).attr("text-anchor","start");W();R();H();T();z();d3.select("#dynamicHide").on("click",function(){a.dynamicHide=!a.dynamicHide;E(!0);H()});d3.select("#invertColors").on("click",function(){a.invertColors=!a.invertColors;d3.selectAll(".canvas").attr("fill",a.invertColors?a.foregroundColor:a.backgroundColor);var b=e();q.selectAll("path.link").attr("stroke",b);q.selectAll("text.legend").attr("fill",b);u.selectAll("path.support").attr("stroke",b);u.selectAll("path.domain").attr("stroke",
b);u.selectAll("text.nodelabel").attr("stroke",b).attr("fill",b);W();w()});d3.select("#phylogram").on("click",function(){a.showPhylogram=!a.showPhylogram;E(!0);z();H()});d3.select("#lineupNodes").on("click",function(){a.lineupNodes=!a.lineupNodes;E(!0);ca();z();H()});d3.select("#lengthValues").on("click",function(){a.showLengthValues=!a.showLengthValues;ba()});d3.select("#supportValues").on("click",function(){a.showSupportValues=!a.showSupportValues;aa();H()});d3.select("#nodeNames").on("click",function(){a.showNodeNames=
!a.showNodeNames;R();z()});d3.select("#nodeLabels").on("click",function(){a.showLabels=!a.showLabels;ga()});d3.select("#taxonomy").on("click",function(){a.showTaxonomy=!a.showTaxonomy;R();z()});d3.select("#sequences").on("click",function(){a.showSequences=!a.showSequences;R();z()});d3.select("#nodesType").on("change",function(){a.showNodesType=$(this).val();O();R()});d3.select("#taxonomyColors").on("click",function(){a.showTaxonomyColors=!a.showTaxonomyColors;W()});d3.select("#nodeHeightLower").on("click",
function(){a.nodeHeight-=a.nodeHeightStep;a.nodeHeight<a.nodeHeightStep&&(a.nodeHeight=a.nodeHeightStep);E(!0);z();H()});d3.select("#nodeHeightHigher").on("click",function(){a.nodeHeight+=a.nodeHeightStep;E(!0);z();H()});d3.select("#resetZoom").on("click",function(){a.domainWidth=a.domainWidthStep;a.scaleX=1;a.scaleY=1;a.translateX=0;a.translateY=0;E(!0);Y.translate([0,0]);T();z()});d3.select("#zoominY").on("click",function(){a.scaleY+=a.scaleStep;a.translateY+=M*a.scaleStep/2;a.lastScale=a.scaleStep;
requestAnimFrame(O)});d3.select("#zoomoutY").on("click",function(){a.scaleY-=a.scaleStep;a.scaleY<a.scaleStep?a.scaleY=a.scaleStep:a.translateY-=M*a.scaleStep/2;a.lastScale=-1*a.scaleStep;requestAnimFrame(O)});d3.select("#zoominX").on("click",function(){a.scaleX+=a.scaleStep;a.translateX+=F*a.scaleStep/2;a.lastScale=a.scaleStep;requestAnimFrame(O)});d3.select("#zoomoutX").on("click",function(){a.scaleX-=a.scaleStep;a.scaleX<a.scaleStep?a.scaleX=a.scaleStep:a.translateX-=F*a.scaleStep/2;a.lastScale=
-1*a.scaleStep;requestAnimFrame(O)});d3.select("#domains").on("click",function(){a.showDomains=!a.showDomains;a.showDomains?(d3.select("#domainNames").attr("disabled",null),d3.select("#domainColors").attr("disabled",null),d3.select("#domainWidthLower").attr("disabled",null),d3.select("#domainWidthHigher").attr("disabled",null),d3.select("#domainLevelLower").attr("disabled",null),d3.select("#domainLevelHigher").attr("disabled",null)):(d3.select("#domainNames").attr("disabled","disabled"),d3.select("#domainColors").attr("disabled",
"disabled"),d3.select("#domainWidthLower").attr("disabled","disabled"),d3.select("#domainWidthHigher").attr("disabled","disabled"),d3.select("#domainLevelLower").attr("disabled","disabled"),d3.select("#domainLevelHigher").attr("disabled","disabled"));p();k()});d3.select("#domainColors").on("click",function(){a.showDomainColors=!a.showDomainColors;w()});d3.select("#domainNames").on("click",function(){a.showDomainNames=!a.showDomainNames;k()});d3.select("#domainWidthLower").on("click",function(){a.domainWidth-=
a.domainWidthStep;a.domainWidth<a.domainWidthStep&&(a.domainWidth=a.domainWidthStep);G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth);D()});d3.select("#domainWidthHigher").on("click",function(){a.domainWidth+=a.domainWidthStep;G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth);D()});d3.select("#domainLevelLower").on("click",function(){a.domainLevel/=a.domainLevelStep;r()});d3.select("#domainLevelHigher").on("click",function(){a.domainLevel*=a.domainLevelStep;r()});d3.select("#graphLegend").on("click",
function(){a.showGraphLegend=!a.showGraphLegend;a.marginY=a.margin+(a.showGraphs?P:0);K();T()});d3.select("#graphs").on("click",function(){a.showGraphs=!a.showGraphs;a.showGraphs?(d3.select("#graphLegend").attr("disabled",null),d3.select("#graphWidthLower").attr("disabled",null),d3.select("#graphWidthHigher").attr("disabled",null)):(d3.select("#graphLegend").attr("disabled","disabled"),d3.select("#graphWidthLower").attr("disabled","disabled"),d3.select("#graphWidthHigher").attr("disabled","disabled"));
ha()});d3.select("#graphWidthLower").on("click",function(){a.graphWidth-=a.graphWidthStep;a.graphWidth<a.graphWidthStep&&(a.graphWidth=a.graphWidthStep);z()});d3.select("#graphWidthHigher").on("click",function(){a.graphWidth+=a.graphWidthStep;z()});d3.select("#linkSVG").on("click",function(){var a=g();saveAs(new Blob([unescape(encodeURIComponent(a))],{type:"application/svg+xml"}),"phylogram.svg")});d3.select("#linkPNG").on("click",function(){var a=g(),b=document.createElement("canvas");canvg(b,a);
b.toBlob(function(a){saveAs(a,"phylogram.png")})})}})();
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.phyloxml={};phyd3.phyloxml.cid=0;phyd3.phyloxml.parseConfidence=function(d){return{type:d.getAttribute("type"),stddev:parseFloat(d.getAttribute("stddev")),value:parseFloat(d.textContent)}};phyd3.phyloxml.parseProperty=function(d){return{ref:d.getAttribute("ref"),unit:d.getAttribute("unit"),datatype:d.getAttribute("datatype"),appliesTo:d.getAttribute("applies_to"),idRef:d.getAttribute("id_ref"),value:d.textContent}};phyd3.phyloxml.parseUri=function(d){return{desc:d.getAttribute("desc"),
type:d.getAttribute("type"),value:d.textContent}};phyd3.phyloxml.parseReference=function(d){return{doi:d.getAttribute("doi"),desc:d.getElementsByTagName("desc")[0]?d.getElementsByTagName("desc")[0].textContent:""}};phyd3.phyloxml.parseAccession=function(d){return{source:d.getAttribute("source"),comment:d.getAttribute("comment"),value:d.textContent}};phyd3.phyloxml.parseMolSeq=function(d){return{isAligned:d.getAttribute("is_aligned"),value:d.textContent}};phyd3.phyloxml.parseColor=function(d){var b=
d.getElementsByTagName("red")[0],b=b?parseInt(b.textContent):0,a=d.getElementsByTagName("greeen")[0],a=a?parseInt(a.textContent):0,e=d.getElementsByTagName("blue")[0],e=e?parseInt(e.textContent):0;d=(d=d.getElementsByTagName("alpha")[0])?parseInt(d.textContent):255;return"rgba("+b+","+a+","+e+", "+parseFloat(d/255)+")"};phyd3.phyloxml.parseDomainArchitecture=function(d){var b={sequenceLength:parseInt(d.getAttribute("length")),domains:[]};d=d.getElementsByTagName("domain");for(var a=0;a<d.length;a++){var e=
d[a];b.domains.push({confidence:parseFloat(e.getAttribute("confidence")),from:parseInt(e.getAttribute("from")),to:parseInt(e.getAttribute("to")),id:e.getAttribute("id"),name:e.textContent})}return b};phyd3.phyloxml.parseCrossReference=function(d){var b=[];d=d.getElementsByTagName("accession");for(var a=0;a<d.length;a++)b.push(phyd3.phyloxml.parseAccession(d[a]));return b};phyd3.phyloxml.parseEvents=function(d){for(var b={},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "type":b.type=
e.textContent;break;case "duplications":case "speciations":case "losses":b[e.nodeName]=parseInt(e.textContent);break;case "confidence":b.confidence=phyd3.phyloxml.parseConfidence(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseTaxonomy=function(d){for(var b={uris:[],synonyms:[]},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "id":case "code":case "authority":case "rank":b[e.nodeName]=
e.textContent;break;case "scientific_name":b.scientificName=e.textContent;break;case "common_name":b.commonName=e.textContent;break;case "synonym":b.synonyms.push(e.textContent);case "uri":b.uris.push(phyd3.phyloxml.parseUri(e));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseAnnotation=function(d){for(var b={ref:d.getAttribute("ref"),source:d.getAttribute("source"),evidence:d.getAttribute("evidence"),
type:d.getAttribute("type"),properties:[],uris:[]},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "desc":b.desc=e.textContent;break;case "confidence":b.confidence=phyd3.phyloxml.parseConfidence(e);break;case "property":b.properties.push(phyd3.phyloxml.parseProperty(e));break;case "uri":b.uris.push(phyd3.phyloxml.parseUri(e));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseSequence=
function(d){for(var b={type:d.getAttribute("type"),idSource:d.getAttribute("id_source"),idRef:d.getAttribute("id_ref"),uris:[],annotations:[]},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "symbol":case "name":case "location":b[e.nodeName]=e.textContent;break;case "gene_name":b.geneName=e.textContent;break;case "accession":b.accession=phyd3.phyloxml.parseAccession(e);break;case "cross_reference":b.crossReference=phyd3.phyloxml.parseCrossReference(e);break;case "mol_seq":b.molSeq=
phyd3.phyloxml.parseMolSeq(e);break;case "annotation":b.annotations.push(phyd3.phyloxml.parseAnnotation(e));break;case "uri":b.uris.push(phyd3.phyloxml.parseUri(e));break;case "domain_architecture":b.domainArchitecture=phyd3.phyloxml.parseDomainArchitecture(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseClade=function(d){for(var b={branchset:[],properties:[],taxonomies:[],sequences:[],
confidences:[],references:[],branchLength:parseFloat(d.getAttribute("branch_length"))},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "branch_length":b.branchLength=parseFloat(e.textContent);break;case "width":b.width=parseFloat(e.textContent);break;case "clade":b.branchset.push(phyd3.phyloxml.parseClade(e));break;case "property":b.properties.push(phyd3.phyloxml.parseProperty(e));break;case "taxonomy":b.taxonomies.push(phyd3.phyloxml.parseTaxonomy(e));break;case "reference":b.references.push(phyd3.phyloxml.parseReference(e));
break;case "confidence":b.confidences.push(phyd3.phyloxml.parseConfidence(e));break;case "sequence":b.sequences.push(phyd3.phyloxml.parseSequence(e));break;case "color":b.color=phyd3.phyloxml.parseColor(e);break;case "events":b.events=phyd3.phyloxml.parseEvents(e);break;case "id":case "name":b[e.nodeName]=e.textContent;break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}b.id||(phyd3.phyloxml.cid++,b.id="_"+phyd3.phyloxml.cid);
return b};phyd3.phyloxml.parseLegend=function(d){for(var b={show:parseInt(d.getAttribute("show")),fields:[],gradient:{}},a=d.getElementsByTagName("field"),e=0;e<a.length;e++){var g=a[e],p=g.getElementsByTagName("name")[0],p=p?p.textContent:"",k=g.getElementsByTagName("color")[0],k=k?k.textContent:"",r=g.getElementsByTagName("background")[0],r=r?r.textContent:"",w=g.getElementsByTagName("shape")[0],w=w?w.textContent:"",g=(g=g.getElementsByTagName("url")[0])?g.textContent:"";b.fields.push({name:p,color:k,
background:r,shape:w,url:g})}if(d=d.getElementsByTagName("gradient")[0])p=(p=d.getElementsByTagName("name")[0])?p.textContent:"",d=(d=d.getElementsByTagName("classes")[0])?parseInt(d.textContent):0,b.gradient={name:p,classes:d};return b};phyd3.phyloxml.parseData=function(d){var b={tag:d.getAttribute("tag"),ref:d.getAttribute("ref")},a=d.getElementsByTagName("min")[0];b.min=a?a.textContent:void 0;a=d.getElementsByTagName("max")[0];b.max=a?a.textContent:void 0;d=d.getElementsByTagName("values");for(a=
0;a<d.length;a++){var e=d[a].getAttribute("for"),g=d[a].getElementsByTagName("value");b[e]=[];for(var p=0;p<g.length;p++)b[e].push(parseFloat(g[p].textContent))}return b};phyd3.phyloxml.parseGraph=function(d){for(var b={name:"",legend:{},data:{},type:d.getAttribute("type")},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "name":b.name=e.textContent;break;case "legend":b.legend=phyd3.phyloxml.parseLegend(e);break;case "data":b.data=phyd3.phyloxml.parseData(e);break;case "#text":case "#comment":break;
default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseLabel=function(d){for(var b={name:"",data:{},type:d.getAttribute("type")},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "name":b.name=e.textContent;break;case "data":b.data=phyd3.phyloxml.parseData(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parse=
function(d){var b={branchset:[],properties:[],confidence:[]},a=d.getElementsByTagName("phylogeny"),a=a[0];b.rooted=a.getAttribute("rooted");b.rerootable=a.getAttribute("rerootable");b.branch_length_unit=a.getAttribute("branch_length_unit");b.type=a.getAttribute("type");if(a&&a.childNodes)for(var e=0;e<a.childNodes.length;e++){var g=a.childNodes[e];switch(g.nodeName){case "clade":b.branchset.push(phyd3.phyloxml.parseClade(g));break;case "confidence":b.confidence.push(phyd3.phyloxml.parseConfidence(g));
break;case "date":b.date=g.textContent;break;case "description":b.description=g.textContent;break;case "id":b.id=g.textContent;break;case "name":b.name=g.textContent;break;case "property":b.properties.push(phyd3.phyloxml.parseProperty(g));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+g.nodeName+" "+g.textContent+" - skipping...")}}var a=d.getElementsByTagName("taxonomies"),a=a[0],p={};if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++){var k=a.childNodes[e];if("color"==
k.nodeName){var g=k.getElementsByTagName("code")[0].textContent,r=k.getElementsByTagName("value")[0].textContent;p[g]={color:r}}if("taxonomy"==k.nodeName){var g=k.getAttribute("code"),r=(r=k.getElementsByTagName("color")[0])?r.textContent:r,w=k.getElementsByTagName("name")[0],w=w?w.textContent:w,k=(k=k.getElementsByTagName("url")[0])?k.textContent:k;p[g]={color:r,name:w,url:k}}}b.taxcolors=p;a=d.getElementsByTagName("domains");a=a[0];p={};if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)k=a.childNodes[e],
"color"==k.nodeName&&(g=k.getElementsByTagName("code")[0].textContent,r=k.getElementsByTagName("value")[0].textContent,p[g]={color:r}),"domain"==k.nodeName&&(g=k.getAttribute("name"),r=(r=k.getElementsByTagName("color")[0])?r.textContent:r,w=(w=k.getElementsByTagName("description")[0])?w.textContent:w,k=(k=k.getElementsByTagName("url")[0])?k.textContent:k,p[g]={color:r,description:w,url:k});b.domcolors=p;a=d.getElementsByTagName("graphs");a=a[0];g=[];if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)r=
a.childNodes[e],"graph"==r.nodeName&&g.push(phyd3.phyloxml.parseGraph(r));b.graphs=g;a=d.getElementsByTagName("labels");a=a[0];d=[];if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)g=a.childNodes[e],"label"==g.nodeName&&d.push(phyd3.phyloxml.parseLabel(g));b.labels=d;return b}})();
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.newick={};phyd3.newick.parse=function(d){var b=[],a={};d=d.split(/\s*(;|\(|\)|,|:)\s*/);for(var e=0,g=0;g<d.length;g++){var p=d[g];switch(p){case "(":p={};a.id=e;e++;a.branchset=[p];b.push(a);a=p;break;case ",":p={};b[b.length-1].branchset.push(p);a=p;break;case ")":a=b.pop();break;case ":":break;default:var k=d[g-1];")"==k||"("==k||","==k?a.name=p:":"==k&&(a.branchLength=parseFloat(p));a.id=e;e++}}return a}})();
if(!d3)throw"d3 wasn't included!";window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(d){window.setTimeout(d,1E3/60)}}();
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.phylogram={};phyd3.phylogram.options={};phyd3.phylogram.intenals={};phyd3.phylogram.domains={};phyd3.phylogram.graphs={};phyd3.phylogram.dx=0;phyd3.phylogram.lineAreas=[];phyd3.phylogram.labelAreas=[];phyd3.phylogram.projection=function(d){return[parseInt(d.y),parseInt(d.x)]};phyd3.phylogram.rightAngleDiagonal=function(d,b){b=d.source;d=d.target;b=[b,{x:d.x,y:b.y},d];b=b.map(phyd3.phylogram.projection);phyd3.phylogram.lineAreas.push({start:b[1],
end:b[2]});!d.children&&b[2][0]>phyd3.phylogram.dx&&(phyd3.phylogram.dx=b[2][0]);return"M"+b[0]+" "+b[1]+" "+b[2]};phyd3.phylogram.scaleBranchLengths=function(d,b){function a(b,d){d(b);if(b.children)for(var e=b.children.length-1;0<=e;e--)a(b.children[e],d)}a(d[0],function(a){a.rootDist=(a.parent?a.parent.rootDist:0)+(a.branchLength||0)});var e=d.map(function(a){return a.rootDist}),g=d3.scale.linear().domain([0,d3.max(e)]).range([0,b]);a(d[0],function(a){a.y=parseInt(g(a.rootDist))});return g};phyd3.phylogram.randomColor=
function(){function d(a,b,d){0>d&&(d+=1);1<d&&--d;return d<1/6?a+6*(b-a)*d:.5>d?b:d<2/3?a+(b-a)*(2/3-d)*6:a}var b=Math.random();return function(a,b,g){if(0==b)g=b=a=g;else{var e=.5>g?g*(1+b):g+b-g*b,k=2*g-e;g=d(k,e,a+1/3);b=d(k,e,a);a=d(k,e,a-1/3)}return"#"+Math.round(255*g).toString(16)+Math.round(255*b).toString(16)+Math.round(255*a).toString(16)}((b+.618033988749895)%1,.5,.6)};phyd3.phylogram.scaledomainWidths=function(d,b){d=d.map(function(a){return a.sequences&&a.sequences[0]&&a.sequences[0].domainArchitecture&&
a.sequences[0].domainArchitecture.sequenceLength?a.sequences[0].domainArchitecture.sequenceLength:0});return d3.scale.linear().domain([0,d3.max(d)]).range([0,b])};phyd3.phylogram.build=function(d,b,a){function e(){return a.invertColors?a.backgroundColor:a.foregroundColor}function g(){var b=d.replace("#",""),b=document.getElementById(b).querySelector("svg"),e=b.getElementById("main"),f=e.getBBox(),e=e.getAttributeNode("transform"),g=b.getAttributeNode("width"),n=b.getAttributeNode("height"),h=e.value,
l=g.value,k=n.value;e.value="translate("+a.marginX+", "+a.marginY+")";g.value=f.width+a.marginX;n.value=f.height+a.marginY;if("undefined"!=typeof window.XMLSerializer)var q=(new XMLSerializer).serializeToString(b);else"undefined"!=typeof b.xml&&(q=b.xml);e.value=h;g.value=l;n.value=k;return q}function p(){a.showDomains?(G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth),u.append("svg:path").attr("class","domain").attr("stroke",e()).attr("visibility",function(a,b){return a.show?"visibile":"hidden"}),
C=C.data(function(a,b,d){a=a.sequences&&a.sequences[0]&&a.sequences[0].domainArchitecture?a.sequences[0].domainArchitecture.domains:[];for(d=0;d<a.length;d++)a[d].i=b;a.sort(function(a,b){return Math.abs(b.to-b.from)-Math.abs(a.to-a.from)});return a}).enter().append("svg:g").attr("class","domain"),C.append("svg:rect").attr("class","domain hover-visible").attr("stroke",a.foregroundColor).attr("stroke-width",a.outline+"px").append("title").text(function(a){return a.name}),r(),D(),w()):(C.remove(),u.selectAll("path.domain").remove(),
C=u.selectAll("g.domain"))}function k(){a.showDomainNames?(C.append("svg:text").attr("class","domain").attr("dy",-3).attr("fill",e()).attr("font-size","10px").text(function(a){return a.name}),D()):C.selectAll("text.domain").remove()}function r(){var b=u.data();u.selectAll("g.domain").attr("visibility",function(d,e,m){return b[m].show&&d.confidence<=a.domainLevel?"visible":"hidden"});u.selectAll("path.domain").attr("visibility",function(a){return a.show?"visible":"hidden"});d3.select("#domainLevel").attr("value",
a.domainLevel.toPrecision(1))}function w(){C.selectAll("rect.domain").attr("fill",function(d){return a.showDomainColors&&b.domcolors[d.name]?b.domcolors[d.name].color.replace(/0x/,"#"):e()})}function D(){var b=u.data(),d=I+(a.showLabels?J:0)+(a.showGraphs?v:0);G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth);u.selectAll("path.domain").attr("d",function(e,m,g){m=a.lineupNodes?phyd3.phylogram.dx-b[g].y:0;e=e.sequences&&e.sequences[0]&&e.sequences[0].domainArchitecture?e.sequences[0].domainArchitecture.sequenceLength:
0;return"M"+parseInt(d+m)+",0L"+parseInt(d+m+G(e))+",0"});C.selectAll("rect.domain").attr("width",function(a){return parseInt(G(a.to-a.from))}).attr("transform",function(e,m,g){return"translate("+parseInt(d+(a.lineupNodes?phyd3.phylogram.dx-b[e.i].y:0)+G(e.from))+","+parseInt(-1*a.nodeHeight)+")"}).attr("height",2*a.nodeHeight-2);C.selectAll("text.domain").attr("transform",function(e){return"translate("+parseInt(d+(a.lineupNodes?phyd3.phylogram.dx-b[e.i].y:0)+G(e.from))+","+parseInt(-1*a.nodeHeight)+
")"});d3.select("#domainWidth").attr("value",a.domainWidth)}function aa(){a.showSupportValues?(q.selectAll("g.inner.node").append("svg:text").attr("class","supportValue").attr("dx",-2).attr("text-anchor","end").attr("fill",a.supportValuesColor).text(function(a){var b="";if(a.confidences)for(var d in a.confidences)b+=parseFloat(a.confidences[d].value)+" ";return b}),z()):q.selectAll("text.supportValue").remove()}function ba(){a.showLengthValues?(q.selectAll("g.node").append("svg:text").attr("class",
"branchLength").attr("dx",-2).attr("text-anchor","end").attr("fill",a.branchLengthColor).text(function(a){return a.branchLength?parseFloat(a.branchLength).toFixed(5):""}),z()):q.selectAll("text.branchLength").remove()}function V(a,b,d){var e=a.attr("id")+"_"+a.selectAll("div.panel-default").size(),f=a.append("div").attr("class","panel panel-default");f.append("div").attr("class","panel-heading").attr("role","tab").attr("id","heading"+e).append("h4").attr("class","panel-title").append("a").attr("class",
"collapsed").attr("aria-expanded",d?"true":"false").attr("role","button").attr("data-toggle","collapse").attr("data-parent","#"+a.attr("id")).attr("href","#collapse"+e).attr("aria-controls","collapse"+e).html(b);return f.append("div").attr("id","collapse"+e).attr("class","panel-collapse collapse "+(d?"in":"")).attr("role","tabpanel").attr("aria-labelledby","heading"+e).append("div").attr("class","panel-body table-responsive")}function ka(e){var g=d3.event;if(!g.defaultPrevented){var f=g.layerX;y=
g.layerY;var m="popup"+parseInt(Date.now()*Math.random()*1E3),f=d3.select(d).append("div").attr("class","popup").attr("id",m).style("position","absolute").style("top",parseInt(y)+"px").style("left",parseInt(f)+"px").style("width",parseInt(a.popupWidth)+"px").style("color",a.foregroundColor).style("background-color",a.backgroundColor),n=f.append("button").attr("class","btn btn-link").style("position","absolute").style("right","8px");n.append("span").attr("class","glyphicon glyphicon-remove").attr("aria-hidden",
"true");n.on("click",function(){d3.select("#"+m).remove();q.selectAll("g.node.cid_"+e.id).selectAll("rect.pointer").style("opacity","0")});f=f.append("div").attr("class","panel-group").attr("id","accordion_"+parseInt(Date.now()*Math.random()*1E3)).attr("role","tablist").attr("aria-multiselectable","true");n="text"==g.target.nodeName||g.target.classList.contains("pointer")?!0:!1;n=V(f,"Node",n).append("table").attr("class","table table-condensed table-bordered").append("tbody");if(e.name){var h=n.append("tr");
h.append("td").text("Name");h.append("td").text(e.name)}if(e.taxonomies)for(var l in e.taxonomies){var k=e.taxonomies[l],h=n.append("tr");h.append("td").text("Taxononomy");h=h.append("td");b.taxcolors[k.code]&&b.taxcolors[k.code].url&&(h=h.append("a").attr("href",b.taxcolors[k.code].url));var p="",p=p+(b.taxcolors[k.code]&&b.taxcolors[k.code].name?b.taxcolors[k.code].name+" ":""),p=p+" ",p=p+(k.scientificName?"\x3ci\x3e"+k.scientificName+"\x3c/i\x3e":""),p=p+" ",p=p+(k.commonName?k.commonName:""),
p=p+" ",p=p+(k.code?"("+k.code+")":"");h.html(p)}if(e.confidences)for(var r in e.confidences)h=n.append("tr"),h.append("td").text("Confidence"),h.append("td").html(e.confidences[r].value);h=n.append("tr");h.append("td").text("Depth");h.append("td").text(e.depth);h=n.append("tr");h.append("td").text("Branch length");h.append("td").text(e.branchLength?e.branchLength:0);h=n.append("tr");h.append("td").text("Distance from root");h.append("td").text(e.rootDist);for(var u in e.properties)h=e.properties[u],
v=h.ref,l=h.value,l=l.trim(),/^http:\/\//.test(l)&&(l="\x3ca href\x3d'"+l+"' target\x3d'_blank'\x3e"+l+"\x3c/a\x3e\x3cbr /\x3e"),h=n.append("tr"),h.append("td").text(v),h.append("td").html(l);for(var v in e.events)l=e.events[v],h=n.append("tr"),h.append("td").text(v),h.append("td").html(l);if(e.sequences)for(var w in e.sequences)if(e.sequences[w].domainArchitecture&&e.sequences[w].domainArchitecture.domains){n=g.target.parentNode.classList.contains("domain")?!0:!1;n=V(f,"Domains",n).append("table").attr("id",
"dt"+m).attr("class","table table-condensed table-bordered");v=n.append("thead").append("tr");v.append("th").text("#");v.append("th").text("Name");v.append("th").text("Description");v.append("th").text("From");v.append("th").text("To");v.append("th").text("P value");n=n.append("tbody");for(u=0;u<e.sequences[w].domainArchitecture.domains.length;u++)l=e.sequences[w].domainArchitecture.domains[u],h=n.append("tr"),h.append("td").style("background",b.domcolors[l.name]&&b.domcolors[l.name].color?b.domcolors[l.name].color.replace("0x",
"#"):"").text(" "),v=h.append("td"),b.domcolors[l.name]&&b.domcolors[l.name].url&&(v=v.append("a").attr("href",b.domcolors[l.name].url)),v.text(l.name),h.append("td").text(b.domcolors[l.name]?b.domcolors[l.name].description:""),h.append("td").text(l.from),h.append("td").text(l.to),h.append("td").text(l.confidence);$("#dt"+m).dataTable({searching:!1,paging:!1,language:{info:""},order:[[3,"asc"]],columns:[{orderable:!1},null,null,null,null,null]})}if(b.graphs)for(w=0;w<b.graphs.length;w++)if(l=b.graphs[w],
l.data&&l.data[e.id]&&l.data[e.id].length)for(n=g.target.parentNode.classList.contains(l.type)?!0:!1,n=V(f,l.name,n).append("table").attr("class","table table-condensed table-bordered").append("tbody"),u=0;u<l.legend.fields.length;u++)h=n.append("tr"),v=h.append("td"),l.legend.fields[u].url&&(v=v.append("a").attr("href",l.legend.fields[u].url)),v.text(l.legend.fields[u].name),h.append("td").text(l.data[e.id][u]);q.selectAll("g.node.cid_"+e.id).selectAll("rect.pointer").style("opacity","1");g.stopPropagation()}}
function ca(){a.lineupNodes?q.selectAll("g.leaf").append("path").attr("class","support").attr("stroke",e()).attr("stroke-dasharray","2,3").attr("stroke-width","0.5px"):q.selectAll("path.support").remove()}function Q(d){if(d.children&&"only leaf"==a.showNodesType||!d.children&&"only inner"==a.showNodesType)return"";var e="";if(a.showTaxonomy&&d.taxonomies)for(var f in d.taxonomies){var g=d.taxonomies[f];a.showFullTaxonomy&&(e+=b.taxcolors[g.code]&&b.taxcolors[g.code].name?b.taxcolors[g.code].name:
"",e+=" ",e+=g.scientificName?g.scientificName:"",e+=" ",e+=g.commonName?g.commonName:"",e+=" ");e+=g.code?g.code:"";e+=" "}e+=(a.showNodeNames&&d.name?d.name:"")+" ";if(a.showSequences&&d.sequences)for(var m in d.sequences)if(f=d.sequences[m],e+=f.symbol?f.symbol:"",e+=" ",e+=f.accession?f.accession.value:"",e+=" ",e+=f.name?f.name:"",e+=" ",e+=f.geneName?f.geneName:"",e+=" ",f.annotations)for(var h in f.annotations)e+=f.annotations[h].desc?f.annotations[h].desc:"",e+=" ";return e}function R(){var b=
0;u.selectAll("text.name").text(function(a){a=Q(a);a.length>b&&(b=a.length);return a});q.selectAll("g.node.inner").selectAll("text.name").text(Q);a.showGraphs&&K();a.showDomains&&D()}function H(){u.selectAll("text.name").attr("visibility",function(a){return a.show?"visible":"hidden"});a.lineupNodes&&u.selectAll("path.support").attr("visibility",function(a){return a.show?"visible":"hidden"});a.showLabels&&da();a.showGraphs&&ea();a.showDomains&&r()}function W(){q.selectAll("text.name").attr("stroke",
e()).attr("stroke-width",a.outline+"px").attr("fill",function(d){var g=null;if(a.showTaxonomyColors&&b.taxcolors&&d.taxonomies)for(var f in d.taxonomies){var m=d.taxonomies[f];b.taxcolors[m.code]&&b.taxcolors[m.code].color&&(g=b.taxcolors[m.code].color.replace(/0x/,"#"))}return g?g:e()})}function fa(){u.selectAll("text.name").attr("dx",function(b){return parseInt(a.lineupNodes?phyd3.phylogram.dx-b.y+5:5)});u.selectAll("path.support").attr("d",function(a){return"M0,0 L"+parseInt(phyd3.phylogram.dx-
a.y)+",0"});a.showLabels&&X();a.showGraphs&&K();a.showDomains&&D()}function z(){q.selectAll("text.name").attr("dy",a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");q.selectAll("text.branchLength").attr("dy",-a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");q.selectAll("text.supportValue").attr("dy",a.nodeHeight/2+5).attr("font-size",1.5*a.nodeHeight+"px");I=100*a.nodeHeight/6+10;d3.select("#nodeHeight").attr("value",a.nodeHeight);fa();a.showLabels&&X();a.showGraphs&&K();a.showDomains&&
D()}function ga(){if(a.showLabels&&b.labels){for(var d=0;d<b.labels.length;d++){var g=b.labels[d];g.id||(g.id=parseInt(Date.now()*Math.random()*1E3));g.data.tag&&q.selectAll("g.node").each(function(a){var b=a[g.data.tag],d=g.data.ref,d=d?d:"value",b="object"==typeof b?b[d]:b;if("property"==g.data.tag)for(pid in a.properties){var e=a.properties[pid];if(e.ref==d){b=e.value;break}}b&&(g.data[a.id]=b)});switch(g.type){case "text":for(cid in g.data)g.data[cid]&&parseInt(cid)&&q.selectAll(".cid_"+cid).append("text").attr("class",
"nodelabel text lid"+g.id).attr("dy",3).attr("text-anchor","start").attr("stroke-width","0.3px").attr("stroke",e()).attr("fill",e()).attr("font-size",1.5*a.nodeHeight+"px").attr("visibility","visible").text(g.data[cid]).append("title").text(g.name+": "+g.data[cid]);break;case "color":for(cid in g.data)if(g.data[cid]&&parseInt(cid)){var f=a.nodeHeight,k=g.data[cid].replace(/0x/,"#");q.selectAll(".cid_"+cid).append("rect").attr("height",2*f).attr("width",2*f).attr("class","nodelabel color lid"+g.id).attr("style",
"fill: "+k+"; stroke: "+k).append("title").text(g.name)}}}da();X()}else q.selectAll(".nodelabel").remove(),J=0;K();D()}function X(){var d=a.nodeHeight;J=0;if(b.labels){for(var e=0;e<b.labels.length;e++){var f=b.labels[e],g=0;u.selectAll(".nodelabel.lid"+f.id).attr("transform",function(b){var e=0,l=0;"color"==f.type&&(e=l=-d);var m=0;"text"==this.nodeName&&this.firstChild?m=this.firstChild.length*d/1.5:"rect"==this.nodeName&&(m=2*d);m>g&&(g=m);return"translate("+parseInt(e+d+J+(a.lineupNodes?phyd3.phylogram.dx-
b.y+I:I))+","+l+")"});J+=g+2*d}e=u.selectAll(".nodelabel");e.selectAll("text").attr("dy",a.nodeHeight/2).attr("font-size",1.5*a.nodeHeight+"px");e.selectAll("rect").attr("width",2*a.nodeHeight).attr("height",2*a.nodeHeight)}}function da(){u.selectAll(".nodelabel").attr("visibility",function(a){return a.show?"visible":"hidden"})}function ha(){if(a.showGraphs&&b.graphs&&b.graphs.length){d3.svg.arc().innerRadius(0).outerRadius(a.nodeHeight);for(var d=d3.layout.pie().value(function(a){return a.value}).sort(null),
g=v=0;g<b.graphs.length;g++){var f=b.graphs[g];f.id||(f.id=parseInt(Date.now()*Math.random()*1E3));if(f.data.tag)var k=q.selectAll("g.node").each(function(a){var b=a[f.data.tag],d=f.data.ref,d=d?d:"value",b="object"==typeof b?b[d]:b;if("property"==f.data.tag)for(pid in a.properties){var e=a.properties[pid];if(e.ref==d){b=e.value;break}}b&&(f.data[a.id]=[],f.data[a.id][0]=b,"pie"==f.type&&f.data.max&&(f.data[a.id][1]=f.data.max-b,f.legend.fields[1]={name:f.legend.fields[0].name,color:f.legend.fields[0].background?
f.legend.fields[0].background:phyd3.phylogram.randomColor(),invert:!0}))});switch(f.type){case "pie":for(cid in f.data)if(f.data[cid]&&Array.isArray(f.data[cid])){var n=!1;q.select(".cid_"+cid).each(function(a){0==a.branchset.length&&(n=!0)});for(var k=q.selectAll(".cid_"+cid).append("svg:g").attr("class","graph pie gid"+f.id),h=[],l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,value:f.data[cid][l],leaf:n});k.selectAll("path.pie.gid"+f.id).data(d(h)).enter().append("path").attr("class",
"pie hover-visible gid"+f.id).attr("stroke",e()).attr("stroke-width",a.outline+"px").attr("fill",function(a,b){return f.legend.fields?(f.legend.fields[b]||(f.legend.fields[b]={},f.legend.fields[b].name="Series "+(b+1),f.legend.fields[b].color=phyd3.phylogram.randomColor()),f.legend.fields[b].color.replace(/0x/,"#")):""}).append("title").text(function(a,b){return f.legend.fields?(f.legend.fields[b]&&f.legend.fields[b].name?f.legend.fields[b].name+": ":"")+(f.legend.fields[b].invert?f.data.max-a.data.value:
a.data.value):""})}break;case "binary":for(cid in f.data)if(f.data[cid]&&Array.isArray(f.data[cid])){h=[];n=!1;q.select(".cid_"+cid).each(function(a){0==a.branchset.length&&(n=!0)});k=q.selectAll(".cid_"+cid).append("svg:g").attr("class","graph binary gid"+f.id);for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,value:f.data[cid][l],shape:f.legend.fields[l]?f.legend.fields[l].shape:"",leaf:n});k.selectAll("path.binary.gid"+f.id).data(h).enter().append("path").attr("class","binary hover-visible gid"+
f.id).attr("style",function(a,b){b=(f.legend.fields[b]?f.legend.fields[b].color:"").replace(/0x/,"#");return"fill:"+(1<=a.value?b:"none")+";stroke:"+(0<=a.value?b:"none")}).append("title").text(function(a,b){return(f.legend.fields[b]?f.legend.fields[b].name+": ":"")+a.value})}break;case "multibar":L[f.id]=[];for(l=0;l<f.legend.fields.length;l++)k=d3.max(d3.values(f.data),function(a){if(a)return a[l]}),L[f.id][l]=d3.scale.linear().domain([0,k]);for(cid in f.data)if(f.data[cid]){k=q.select(".cid_"+
cid).append("svg:g").attr("class","graph multibar gid"+f.id);h=[];for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,value:f.data[cid][l]});k.selectAll("rect.multibar.gid"+f.id).data(h).enter().append("rect").attr("class","multibar hover-visible gid"+f.id).attr("fill",function(a,b){return(f.legend.fields[b]?f.legend.fields[b].color:"").replace(/0x/,"#")}).attr("stroke",a.foregroundColor).attr("stroke-width",a.outline).append("title").text(function(a,b){return(f.legend.fields[b]?
f.legend.fields[b].name+": ":"")+a.value})}break;case "heatmap":var k=d3.max(d3.values(f.data),function(a){if(a)return d3.max(a)}),h=d3.min(d3.values(f.data),function(a){if(a)return d3.min(a)}),p=d3.scale.quantize().domain([h,k]).range(colorbrewer[f.legend.gradient.name][f.legend.gradient.classes]);for(cid in f.data)if(f.data[cid]){k=q.select(".cid_"+cid).append("svg:g").attr("class","graph heatmap gid"+f.id);h=[];if(f.data[cid])for(l=0;l<f.data[cid].length;l++)void 0!=f.data[cid][l]&&h.push({i:l,
value:f.data[cid][l]});k.selectAll("rect.heatmap.gid"+f.id).data(h).enter().append("rect").attr("class","heatmap hover-visible gid"+f.id).attr("fill",function(a,b){return p(a.value)}).attr("stroke",a.foregroundColor).attr("stroke-width",a.outline+"px").append("title").text(function(a,b){return(f.legend.fields[b]?f.legend.fields[b].name+": ":"")+a.value})}break;default:console.log("Graph not supported "+f.type)}}ea();K()}else v=0,q.selectAll("g.graph").remove(),q.selectAll("text.legend").remove();
D()}function K(){var d=a.nodeHeight,g=I+J,f=u.selectAll("g.graph").attr("transform",function(b){return"translate("+(a.lineupNodes?phyd3.phylogram.dx-b.y+g:g)+",0)"});d3.select("#graphWidth").attr("value",a.graphWidth);q.selectAll("text.legend").remove();v=0;if(b.graphs){for(var k=0;k<b.graphs.length;k++){var n=b.graphs[k];switch(n.type){case "pie":f.selectAll("path.pie.gid"+n.id).attr("d",function(a){return d3.svg.arc().innerRadius(0).outerRadius(d)(a)}).attr("transform",function(a){return" translate("+
parseInt(a.data.leaf?d+v:0)+",0)"});a.showGraphLegend&&q.append("text").attr("class","legend").text(0!=n.legend.show?n.name:"").attr("transform","translate("+parseInt(phyd3.phylogram.dx+g+v+2*d)+",-10) rotate(-90)");v+=2*d+5;break;case "binary":f.selectAll("path.binary.gid"+n.id).attr("d",function(a){var b=d3.svg.symbol().size(4*(d-2)*(d-2));b.type(n.legend.fields[a.i].shape);return b(a)}).attr("transform",function(a){return" translate("+(a.leaf?v+10+a.i*(2*d+5):0)+" ,0)"});if(a.showGraphLegend)for(var h=
0;h<n.legend.fields.length;h++)q.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[h].name:"").attr("transform","translate("+(phyd3.phylogram.dx+g+v+h*(2*d+5)+2*d)+", -10) rotate(-90)");v+=(n.legend.fields.length+1)*(2*d+5)+5;break;case "multibar":for(h=0;h<n.legend.fields.length;h++)L[n.id][h]=L[n.id][h].range([0,a.graphWidth]);f.selectAll("rect.multibar.gid"+n.id).attr("height",parseInt(2*d)).attr("width",function(a,b){return parseInt(L[n.id][a.i]?L[n.id][a.i](a.value):
0)}).attr("transform",function(b,e){return" translate("+parseInt(v+b.i*(a.graphWidth+5))+",-"+parseInt(d)+")"});if(a.showGraphLegend)for(h=0;h<n.legend.fields.length;h++)q.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[h].name:"").attr("transform","translate("+(phyd3.phylogram.dx+g+v+h*(a.graphWidth+5)+a.graphWidth/2)+",-10) rotate(-90)");v+=n.legend.fields.length*(a.graphWidth+5);break;case "heatmap":f.selectAll("rect.heatmap.gid"+n.id).attr("width",2*d).attr("height",
2*d).attr("transform",function(a,b){return" translate("+(v+2*a.i*d)+",-"+d+")"});if(a.showGraphLegend)for(h=0;h<n.legend.fields.length;h++)q.append("text").attr("class","legend").text(0!=n.legend.show?n.legend.fields[h].name:"").attr("transform","translate("+parseInt(phyd3.phylogram.dx+g+v+(h+1)*d*2)+",-10) rotate(-90)");v+=2*n.legend.fields.length*d+5}}q.selectAll("text.legend").attr("fill",e()).attr("font-size",2*a.nodeHeight)}}function la(){var d=a.nodeHeight;v=0;if(b.graphs)for(var e=0;e<b.graphs.length;e++){var f=
b.graphs[e];switch(f.type){case "pie":v+=2*d+5;break;case "binary":v+=(f.legend.fields.length+1)*(2*d+5)+5;break;case "multibar":v+=f.legend.fields.length*(a.graphWidth+5);break;case "heatmap":v+=2*f.legend.fields.length*d+5}}return 2*a.margin+(a.showNodeNames?I:0)+(a.showGraphs?v:0)+(a.showDomains?a.domainWidth:0)}function ea(){var b=[],d=function(d){if(!a.dynamicHide)return"visible";for(var e=!0,f=a.nodeHeight,g=d.x,l=d.y,k=0;k<b.length;k++){var m=b[k].x,p=b[k].y;if((m-g)*(m-g)+(p-l)*(p-l)<=4*f*
f){e=!1;break}}return e?(b.push(d),"visible"):"hidden"};u.selectAll("g.graph").attr("visibility",function(a){return a.show?"visible":"hidden"});q.selectAll("g.inner").selectAll(".graph.pie").attr("visibility",d);q.selectAll("g.inner").selectAll(".graph.binary").attr("visibility",d)}function E(d){phyd3.phylogram.lineAreas=[];phyd3.phylogram.dx=0;var g=d3.layout.cluster().separation(function(a,b){return 1}).children(a.children||function(a){return a.branchset}).size([M*a.scaleY,F*a.scaleX]);B=g(b);a.showPhylogram||
phyd3.phylogram.scaleBranchLengths(B,F*a.scaleX);var f=q.selectAll("path.link");d||(f=f.data(g.links(B)),f.enter().append("svg:path").attr("class","link").attr("fill","none").attr("stroke",e()));f.attr("d",phyd3.phylogram.rightAngleDiagonal);N=void 0;c=0;f=B.filter(function(a){return!a.children});for(g=0;g<f.length;g++)f[g].show=a.dynamicHide?ia(f[g],!a.lineupNodes):!0;N=void 0;f=B.filter(function(a){return a.children});for(g=0;g<f.length;g++)0<Q(f[g]).trim().length?f[g].show=a.dynamicHide?ia(f[g],
!0):!0:f[g].show=!1;d||(S=S.data(B),S.enter().append("svg:g").attr("class",function(a){return a.children?0==a.depth?"root node cid_"+a.id:"inner node cid_"+a.id:"leaf node cid_"+a.id}).style("cursor","pointer").on("click",void 0===a.popupAction?ka:a.popupAction).append("rect").attr("class","pointer").attr("fill","red").attr("width",2*a.nodeHeight+2+"px").attr("height",2*a.nodeHeight+2+"px").style("opacity","0").attr("x","-"+(a.nodeHeight+1)+"px").attr("y","-"+(a.nodeHeight+1)+"px"));S.attr("transform",
function(a){return"translate("+parseInt(a.y)+","+parseInt(a.x)+")"});phyd3.phylogram.lineAreas=[]}function O(){E(!0);T()}function ia(b,d){var e=!0,g=b.y+1,k=b.y+5.5*Q(b).length,h=b.x-a.nodeHeight,l=b.x+a.nodeHeight;if(!N)return N=b,!0;a.lineupNodes&&!b.children&&(g+=phyd3.phylogram.dx-b.y,k+=phyd3.phylogram.dx-b.y);var m=N,p=m.y+1,q=m.y+5.5*Q(m).length,t=m.x-a.nodeHeight,r=m.x+a.nodeHeight;a.lineupNodes&&!m.children&&(p+=phyd3.phylogram.dx-m.y,q+=phyd3.phylogram.dx-m.y);if(p<=g&&g<=q&&t<=h&&h<=r||
p<=k&&k<=q&&t<=h&&h<=r||p<=g&&g<=q&&t<=l&&l<=r||p<=k&&k<=q&&t<=l&&l<=r)e=!1;if(e&&d)for(d=0;d<phyd3.phylogram.lineAreas.length;d++)if(t=phyd3.phylogram.lineAreas[d],m=t.start[0],p=t.end[0],q=t.start[1],t=t.end[1],q==t){if(h<=q&&t<=l&&!(m>k||p<g)){e=!1;break}}else if(m==p&&g<=m&&p<=k&&!(q>l||t<h)){e=!1;break}e&&(N=b);return e}function T(){var b=Y.translate(),d=b[0]+a.marginX-a.translateX,e=b[1]+a.marginY-a.translateY;q.attr("transform",function(a){return"translate("+parseInt(d)+","+parseInt(e)+") scale(1)"});
0!=a.lastScale&&(fa(),a.dynamicHide&&H())}a=a||{};a.scaleY=a.scaleY||1;a.scaleX=a.scaleX||1;a.translateX=a.translateX||0;a.translateY=a.translateY||0;a.height=a.height||800;a.margin=a.margin||20;a.scaleStep=a.scaleStep||.3;a.nodeHeight=a.nodeHeight||6;a.nodeHeightStep=a.nodeHeightStep||1;a.textLength=a.textLength||100;a.domainWidth=a.domainWidth||100;a.domainWidthStep=a.domainWidthStep||100;a.graphWidth=a.graphWidth||20;a.graphWidthStep=a.graphWidthStep||10;a.foregroundColor=a.foregroundColor||"#000";
a.backgroundColor=a.backgroundColor||"#fff";a.domainLevel=a.domainLevel||1;a.domainLevelStep=a.domainLevelStep||10;a.outline=a.outline||.3;a.branchLengthColor=a.branchLengthColor||"red";a.supportValuesColor=a.supportValuesColor||"blue";a.popupWidth=a.popupWidth||500;a.showNodesType=a.showNodesType||"only leaf";a.showFullTaxonomy=a.showFullTaxonomy||!1;a.showLabels=a.showLabels||!0;a.treeWidth=a.treeWidth||"auto";var B,G,N,L=[],J=100,I=100,v=0,P=100,ja=!1;if(b.graphs)for(var Z=0;Z<b.graphs.length;Z++)if(0!=
b.graphs[Z].legend.show){ja=!0;break}P=ja?P:0;a.marginX=a.margin;a.marginY=a.margin+(a.showGraphs?P:0);var U=$(d).width(),F="auto"==a.treeWidth?U-la():a.treeWidth,M=a.height-(2*a.margin+(a.showGraphs?P:0)),F=parseInt(F),M=parseInt(M);0>F&&(F=U-2*I-(a.showGraphs?2*P:0));var Y=d3.behavior.zoom().scaleExtent([1,1]).on("zoom",function(b){b=0;var d=d3.event.sourceEvent;if(d){if(0<d.deltaY||0>d.wheelDelta)b=-1*a.scaleStep;if(0>d.deltaY||0<d.wheelDelta)b=a.scaleStep;var e=.5,g=.5;d.altKey||d.ctrlKey||(e=
d.layerX/U,g=d.layerY/a.height);if(d.ctrlKey||!d.altKey)a.scaleY+=b,a.scaleY<a.scaleStep?a.scaleY=a.scaleStep:a.translateY+=M*b*g;if(d.altKey||!d.ctrlKey)a.graphWidth+=0==b?0:0>b?-10:10,10>a.graphWidth&&(a.graphWidth=10),a.domainWidth+=0==b?0:0>b?-1*a.domainWidthStep:a.domainWidthStep,a.domainWidth<a.domainWidthStep&&(a.domainWidth=a.domainWidthStep),a.scaleX+=b,a.scaleX<a.scaleStep?a.scaleX=a.scaleStep:a.translateX+=F*b*e;a.lastScale=b;0!=a.lastScale?requestAnimFrame(O):requestAnimFrame(T)}});d3.select(d).select("svg").remove();
var q=d3.select(d).insert("svg").attr("width",U+"px").attr("height",a.height+"px").attr("overflow","hidden").attr("version","1.1").attr("font-family","Open Sans").attr("xmlns","http://www.w3.org/2000/svg").call(Y);q.append("svg:rect").attr("class","canvas").attr("width","100%").attr("height","100%").attr("fill",a.invertColors?a.foregroundColor:a.backgroundColor);q.append("svg:text").attr("dy","20px").attr("stroke",e()).attr("stroke-width","1px").attr("font-size","15px").text(b.name?b.name:"");q.append("svg:text").attr("dy",
"40px").attr("stroke",e()).attr("stroke-width","0.5px").attr("font-size","10px").text(b.description?b.description:"");var q=q.append("svg:g").attr("id","main").attr("transform","translate("+a.marginX+", "+a.marginY+")"),S=q.selectAll("g.node");E();0==phyd3.phylogram.dx&&(d3.select("#phylogram").attr("checked","").attr("disabled","disabled"),a.showPhylogram=!0,E());var u=q.selectAll("g.leaf.node"),C=u.selectAll("g.domain");aa();ba();p();k();ha();ca();ga();S.append("svg:text").attr("class","name").attr("dx",
a.nodeHeight+1).attr("dy",3).attr("text-anchor","start");W();R();H();T();z();d3.select("#dynamicHide").on("click",function(){a.dynamicHide=!a.dynamicHide;E(!0);H()});d3.select("#invertColors").on("click",function(){a.invertColors=!a.invertColors;d3.selectAll(".canvas").attr("fill",a.invertColors?a.foregroundColor:a.backgroundColor);var b=e();q.selectAll("path.link").attr("stroke",b);q.selectAll("text.legend").attr("fill",b);u.selectAll("path.support").attr("stroke",b);u.selectAll("path.domain").attr("stroke",
b);u.selectAll("text.nodelabel").attr("stroke",b).attr("fill",b);W();w()});d3.select("#phylogram").on("click",function(){a.showPhylogram=!a.showPhylogram;E(!0);z();H()});d3.select("#lineupNodes").on("click",function(){a.lineupNodes=!a.lineupNodes;E(!0);ca();z();H()});d3.select("#lengthValues").on("click",function(){a.showLengthValues=!a.showLengthValues;ba()});d3.select("#supportValues").on("click",function(){a.showSupportValues=!a.showSupportValues;aa();H()});d3.select("#nodeNames").on("click",function(){a.showNodeNames=
!a.showNodeNames;R();z()});d3.select("#nodeLabels").on("click",function(){a.showLabels=!a.showLabels;ga()});d3.select("#taxonomy").on("click",function(){a.showTaxonomy=!a.showTaxonomy;R();z()});d3.select("#sequences").on("click",function(){a.showSequences=!a.showSequences;R();z()});d3.select("#nodesType").on("change",function(){a.showNodesType=$(this).val();O();R()});d3.select("#taxonomyColors").on("click",function(){a.showTaxonomyColors=!a.showTaxonomyColors;W()});d3.select("#nodeHeightLower").on("click",
function(){a.nodeHeight-=a.nodeHeightStep;a.nodeHeight<a.nodeHeightStep&&(a.nodeHeight=a.nodeHeightStep);E(!0);z();H()});d3.select("#nodeHeightHigher").on("click",function(){a.nodeHeight+=a.nodeHeightStep;E(!0);z();H()});d3.select("#resetZoom").on("click",function(){a.domainWidth=a.domainWidthStep;a.scaleX=1;a.scaleY=1;a.translateX=0;a.translateY=0;E(!0);Y.translate([0,0]);T();z()});d3.select("#zoominY").on("click",function(){a.scaleY+=a.scaleStep;a.translateY+=M*a.scaleStep/2;a.lastScale=a.scaleStep;
requestAnimFrame(O)});d3.select("#zoomoutY").on("click",function(){a.scaleY-=a.scaleStep;a.scaleY<a.scaleStep?a.scaleY=a.scaleStep:a.translateY-=M*a.scaleStep/2;a.lastScale=-1*a.scaleStep;requestAnimFrame(O)});d3.select("#zoominX").on("click",function(){a.scaleX+=a.scaleStep;a.translateX+=F*a.scaleStep/2;a.lastScale=a.scaleStep;requestAnimFrame(O)});d3.select("#zoomoutX").on("click",function(){a.scaleX-=a.scaleStep;a.scaleX<a.scaleStep?a.scaleX=a.scaleStep:a.translateX-=F*a.scaleStep/2;a.lastScale=
-1*a.scaleStep;requestAnimFrame(O)});d3.select("#domains").on("click",function(){a.showDomains=!a.showDomains;a.showDomains?(d3.select("#domainNames").attr("disabled",null),d3.select("#domainColors").attr("disabled",null),d3.select("#domainWidthLower").attr("disabled",null),d3.select("#domainWidthHigher").attr("disabled",null),d3.select("#domainLevelLower").attr("disabled",null),d3.select("#domainLevelHigher").attr("disabled",null)):(d3.select("#domainNames").attr("disabled","disabled"),d3.select("#domainColors").attr("disabled",
"disabled"),d3.select("#domainWidthLower").attr("disabled","disabled"),d3.select("#domainWidthHigher").attr("disabled","disabled"),d3.select("#domainLevelLower").attr("disabled","disabled"),d3.select("#domainLevelHigher").attr("disabled","disabled"));p();k()});d3.select("#domainColors").on("click",function(){a.showDomainColors=!a.showDomainColors;w()});d3.select("#domainNames").on("click",function(){a.showDomainNames=!a.showDomainNames;k()});d3.select("#domainWidthLower").on("click",function(){a.domainWidth-=
a.domainWidthStep;a.domainWidth<a.domainWidthStep&&(a.domainWidth=a.domainWidthStep);G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth);D()});d3.select("#domainWidthHigher").on("click",function(){a.domainWidth+=a.domainWidthStep;G=phyd3.phylogram.scaledomainWidths(B,a.domainWidth);D()});d3.select("#domainLevelLower").on("click",function(){a.domainLevel/=a.domainLevelStep;r()});d3.select("#domainLevelHigher").on("click",function(){a.domainLevel*=a.domainLevelStep;r()});d3.select("#graphLegend").on("click",
function(){a.showGraphLegend=!a.showGraphLegend;a.marginY=a.margin+(a.showGraphs?P:0);K();T()});d3.select("#graphs").on("click",function(){a.showGraphs=!a.showGraphs;a.showGraphs?(d3.select("#graphLegend").attr("disabled",null),d3.select("#graphWidthLower").attr("disabled",null),d3.select("#graphWidthHigher").attr("disabled",null)):(d3.select("#graphLegend").attr("disabled","disabled"),d3.select("#graphWidthLower").attr("disabled","disabled"),d3.select("#graphWidthHigher").attr("disabled","disabled"));
ha()});d3.select("#graphWidthLower").on("click",function(){a.graphWidth-=a.graphWidthStep;a.graphWidth<a.graphWidthStep&&(a.graphWidth=a.graphWidthStep);z()});d3.select("#graphWidthHigher").on("click",function(){a.graphWidth+=a.graphWidthStep;z()});d3.select("#linkSVG").on("click",function(){var a=g();saveAs(new Blob([unescape(encodeURIComponent(a))],{type:"application/svg+xml"}),"phylogram.svg")});d3.select("#linkPNG").on("click",function(){var a=g(),b=document.createElement("canvas");canvg(b,a);
b.toBlob(function(a){saveAs(a,"phylogram.png")})})}})();
(function(){"undefined"==typeof phyd3&&(phyd3={});phyd3.phyloxml={};phyd3.phyloxml.cid=0;phyd3.phyloxml.parseConfidence=function(d){return{type:d.getAttribute("type"),stddev:parseFloat(d.getAttribute("stddev")),value:parseFloat(d.textContent)}};phyd3.phyloxml.parseProperty=function(d){return{ref:d.getAttribute("ref"),unit:d.getAttribute("unit"),datatype:d.getAttribute("datatype"),appliesTo:d.getAttribute("applies_to"),idRef:d.getAttribute("id_ref"),value:d.textContent}};phyd3.phyloxml.parseUri=function(d){return{desc:d.getAttribute("desc"),
type:d.getAttribute("type"),value:d.textContent}};phyd3.phyloxml.parseReference=function(d){return{doi:d.getAttribute("doi"),desc:d.getElementsByTagName("desc")[0]?d.getElementsByTagName("desc")[0].textContent:""}};phyd3.phyloxml.parseAccession=function(d){return{source:d.getAttribute("source"),comment:d.getAttribute("comment"),value:d.textContent}};phyd3.phyloxml.parseMolSeq=function(d){return{isAligned:d.getAttribute("is_aligned"),value:d.textContent}};phyd3.phyloxml.parseColor=function(d){var b=
d.getElementsByTagName("red")[0],b=b?parseInt(b.textContent):0,a=d.getElementsByTagName("greeen")[0],a=a?parseInt(a.textContent):0,e=d.getElementsByTagName("blue")[0],e=e?parseInt(e.textContent):0;d=(d=d.getElementsByTagName("alpha")[0])?parseInt(d.textContent):255;return"rgba("+b+","+a+","+e+", "+parseFloat(d/255)+")"};phyd3.phyloxml.parseDomainArchitecture=function(d){var b={sequenceLength:parseInt(d.getAttribute("length")),domains:[]};d=d.getElementsByTagName("domain");for(var a=0;a<d.length;a++){var e=
d[a];b.domains.push({confidence:parseFloat(e.getAttribute("confidence")),from:parseInt(e.getAttribute("from")),to:parseInt(e.getAttribute("to")),id:e.getAttribute("id"),name:e.textContent})}return b};phyd3.phyloxml.parseCrossReference=function(d){var b=[];d=d.getElementsByTagName("accession");for(var a=0;a<d.length;a++)b.push(phyd3.phyloxml.parseAccession(d[a]));return b};phyd3.phyloxml.parseEvents=function(d){for(var b={},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "type":b.type=
e.textContent;break;case "duplications":case "speciations":case "losses":b[e.nodeName]=parseInt(e.textContent);break;case "confidence":b.confidence=phyd3.phyloxml.parseConfidence(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseTaxonomy=function(d){for(var b={uris:[],synonyms:[]},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "id":case "code":case "authority":case "rank":b[e.nodeName]=
e.textContent;break;case "scientific_name":b.scientificName=e.textContent;break;case "common_name":b.commonName=e.textContent;break;case "synonym":b.synonyms.push(e.textContent);case "uri":b.uris.push(phyd3.phyloxml.parseUri(e));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseAnnotation=function(d){for(var b={ref:d.getAttribute("ref"),source:d.getAttribute("source"),evidence:d.getAttribute("evidence"),
type:d.getAttribute("type"),properties:[],uris:[]},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "desc":b.desc=e.textContent;break;case "confidence":b.confidence=phyd3.phyloxml.parseConfidence(e);break;case "property":b.properties.push(phyd3.phyloxml.parseProperty(e));break;case "uri":b.uris.push(phyd3.phyloxml.parseUri(e));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseSequence=
function(d){for(var b={type:d.getAttribute("type"),idSource:d.getAttribute("id_source"),idRef:d.getAttribute("id_ref"),uris:[],annotations:[]},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "symbol":case "name":case "location":b[e.nodeName]=e.textContent;break;case "gene_name":b.geneName=e.textContent;break;case "accession":b.accession=phyd3.phyloxml.parseAccession(e);break;case "cross_reference":b.crossReference=phyd3.phyloxml.parseCrossReference(e);break;case "mol_seq":b.molSeq=
phyd3.phyloxml.parseMolSeq(e);break;case "annotation":b.annotations.push(phyd3.phyloxml.parseAnnotation(e));break;case "uri":b.uris.push(phyd3.phyloxml.parseUri(e));break;case "domain_architecture":b.domainArchitecture=phyd3.phyloxml.parseDomainArchitecture(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseClade=function(d){for(var b={branchset:[],properties:[],taxonomies:[],sequences:[],
confidences:[],references:[],branchLength:parseFloat(d.getAttribute("branch_length"))},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "branch_length":b.branchLength=parseFloat(e.textContent);break;case "width":b.width=parseFloat(e.textContent);break;case "clade":b.branchset.push(phyd3.phyloxml.parseClade(e));break;case "property":b.properties.push(phyd3.phyloxml.parseProperty(e));break;case "taxonomy":b.taxonomies.push(phyd3.phyloxml.parseTaxonomy(e));break;case "reference":b.references.push(phyd3.phyloxml.parseReference(e));
break;case "confidence":b.confidences.push(phyd3.phyloxml.parseConfidence(e));break;case "sequence":b.sequences.push(phyd3.phyloxml.parseSequence(e));break;case "color":b.color=phyd3.phyloxml.parseColor(e);break;case "events":b.events=phyd3.phyloxml.parseEvents(e);break;case "id":case "name":b[e.nodeName]=e.textContent;break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}b.id||(phyd3.phyloxml.cid++,b.id="_"+phyd3.phyloxml.cid);
return b};phyd3.phyloxml.parseLegend=function(d){for(var b={show:parseInt(d.getAttribute("show")),fields:[],gradient:{}},a=d.getElementsByTagName("field"),e=0;e<a.length;e++){var g=a[e],p=g.getElementsByTagName("name")[0],p=p?p.textContent:"",k=g.getElementsByTagName("color")[0],k=k?k.textContent:"",r=g.getElementsByTagName("background")[0],r=r?r.textContent:"",w=g.getElementsByTagName("shape")[0],w=w?w.textContent:"",g=(g=g.getElementsByTagName("url")[0])?g.textContent:"";b.fields.push({name:p,color:k,
background:r,shape:w,url:g})}if(d=d.getElementsByTagName("gradient")[0])p=(p=d.getElementsByTagName("name")[0])?p.textContent:"",d=(d=d.getElementsByTagName("classes")[0])?parseInt(d.textContent):0,b.gradient={name:p,classes:d};return b};phyd3.phyloxml.parseData=function(d){var b={tag:d.getAttribute("tag"),ref:d.getAttribute("ref")},a=d.getElementsByTagName("min")[0];b.min=a?a.textContent:void 0;a=d.getElementsByTagName("max")[0];b.max=a?a.textContent:void 0;d=d.getElementsByTagName("values");for(a=
0;a<d.length;a++){var e=d[a].getAttribute("for"),g=d[a].getElementsByTagName("value");b[e]=[];for(var p=0;p<g.length;p++)b[e].push(parseFloat(g[p].textContent))}return b};phyd3.phyloxml.parseGraph=function(d){for(var b={name:"",legend:{},data:{},type:d.getAttribute("type")},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "name":b.name=e.textContent;break;case "legend":b.legend=phyd3.phyloxml.parseLegend(e);break;case "data":b.data=phyd3.phyloxml.parseData(e);break;case "#text":case "#comment":break;
default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parseLabel=function(d){for(var b={name:"",data:{},type:d.getAttribute("type")},a=0;a<d.childNodes.length;a++){var e=d.childNodes[a];switch(e.nodeName){case "name":b.name=e.textContent;break;case "data":b.data=phyd3.phyloxml.parseData(e);break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+e.nodeName+" "+e.textContent+" - skipping...")}}return b};phyd3.phyloxml.parse=
function(d){var b={branchset:[],properties:[],confidence:[]},a=d.getElementsByTagName("phylogeny"),a=a[0];b.rooted=a.getAttribute("rooted");b.rerootable=a.getAttribute("rerootable");b.branch_length_unit=a.getAttribute("branch_length_unit");b.type=a.getAttribute("type");if(a&&a.childNodes)for(var e=0;e<a.childNodes.length;e++){var g=a.childNodes[e];switch(g.nodeName){case "clade":b.branchset.push(phyd3.phyloxml.parseClade(g));break;case "confidence":b.confidence.push(phyd3.phyloxml.parseConfidence(g));
break;case "date":b.date=g.textContent;break;case "description":b.description=g.textContent;break;case "id":b.id=g.textContent;break;case "name":b.name=g.textContent;break;case "property":b.properties.push(phyd3.phyloxml.parseProperty(g));break;case "#text":case "#comment":break;default:console.log("Undefined tag: "+g.nodeName+" "+g.textContent+" - skipping...")}}var a=d.getElementsByTagName("taxonomies"),a=a[0],p={};if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++){var k=a.childNodes[e];if("color"==
k.nodeName){var g=k.getElementsByTagName("code")[0].textContent,r=k.getElementsByTagName("value")[0].textContent;p[g]={color:r}}if("taxonomy"==k.nodeName){var g=k.getAttribute("code"),r=(r=k.getElementsByTagName("color")[0])?r.textContent:r,w=k.getElementsByTagName("name")[0],w=w?w.textContent:w,k=(k=k.getElementsByTagName("url")[0])?k.textContent:k;p[g]={color:r,name:w,url:k}}}b.taxcolors=p;a=d.getElementsByTagName("domains");a=a[0];p={};if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)k=a.childNodes[e],
"color"==k.nodeName&&(g=k.getElementsByTagName("code")[0].textContent,r=k.getElementsByTagName("value")[0].textContent,p[g]={color:r}),"domain"==k.nodeName&&(g=k.getAttribute("name"),r=(r=k.getElementsByTagName("color")[0])?r.textContent:r,w=(w=k.getElementsByTagName("description")[0])?w.textContent:w,k=(k=k.getElementsByTagName("url")[0])?k.textContent:k,p[g]={color:r,description:w,url:k});b.domcolors=p;a=d.getElementsByTagName("graphs");a=a[0];g=[];if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)r=
a.childNodes[e],"graph"==r.nodeName&&g.push(phyd3.phyloxml.parseGraph(r));b.graphs=g;a=d.getElementsByTagName("labels");a=a[0];d=[];if(a&&a.childNodes)for(e=0;e<a.childNodes.length;e++)g=a.childNodes[e],"label"==g.nodeName&&d.push(phyd3.phyloxml.parseLabel(g));b.labels=d;return b}})();